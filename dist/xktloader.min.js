!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).xktloader=t()}(this,(function(){"use strict";class e{constructor(e,t){this.items=e||[],this._lastUniqueId=(t||0)+1}addItem(){let e;if(2===arguments.length){const t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){const t=this._lastUniqueId++;if(!this.items[t])return this.items[t]=e,t}}removeItem(e){const t=this.items[e];return delete this.items[e],t}}const t={},i=new e,s=new class{constructor(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}const e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e}push(e){return this._length++,this._tail.push(e),this}unshift(e){return this._head[--this._index]=e,this._length++,this}},r={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null};const n=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(n.scenes[e.id])return void console.error(`[ERROR] Scene ${d.inQuotes(e.id)} already exists`)}else e.id=i.addItem({});n.scenes[e.id]=e;const s=e.ticksPerOcclusionTest,r=e.ticksPerRender;t[e.id]={ticksPerOcclusionTest:s,ticksPerRender:r,renderCountdown:r},e.once("destroyed",(()=>{i.removeItem(e.id),delete n.scenes[e.id],delete t[e.id]}))},this.clear=function(){let e;for(const t in n.scenes)n.scenes.hasOwnProperty(t)&&(e=n.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete n.scenes[e.id]))},this.scheduleTask=function(e,t=null){s.push(e),s.push(t)},this.runTasks=function(e=-1){let t,i,r=(new Date).getTime(),n=0;for(;s.length>0&&(e<0||r<e);)t=s.shift(),i=s.shift(),i?t.call(i):t(),r=(new Date).getTime(),n++;return n},this.getNumTasks=function(){return s.length}},o=function(){let e=Date.now();for(let e in n.scenes)n.scenes[e].compile();l(e)};!function(e,t){let i=Date.now()+t;(function s(){const r=Date.now()-i;e(),i+=t,setTimeout(s,Math.max(0,t-r))})()}((()=>{o()}),100);const a=function(){let e=Date.now();l(e),function(e){for(var t in r.time=e,n.scenes)if(n.scenes.hasOwnProperty(t)){var i=n.scenes[t];r.sceneId=t,r.startTime=i.startTime,r.deltaTime=null!=r.prevTime?r.time-r.prevTime:0,i.fire("tick",r,!0)}r.prevTime=e}(e),function(){const e=n.scenes,i=!1;let s,r,o,a,l;for(l in e)e.hasOwnProperty(l)&&(s=e[l],r=t[l],r||(r=t[l]={}),o=s.ticksPerOcclusionTest,r.ticksPerOcclusionTest!==o&&(r.ticksPerOcclusionTest=o,r.renderCountdown=o),--s.occlusionTestCountdown<=0&&(s.doOcclusionTest(),s.occlusionTestCountdown=o),a=s.ticksPerRender,r.ticksPerRender!==a&&(r.ticksPerRender=a,r.renderCountdown=a),0==--r.renderCountdown&&(s.render(i),r.renderCountdown=a))}(),void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(o):requestAnimationFrame(a)};function l(e){n.runTasks(e+10),n.getNumTasks()}a();var c=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],i=e[0].charCodeAt(0),s=i+e[1],r=i;r<s;++r)t.push(r);return String.fromCharCode.apply(null,t)})).join("");function h(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return c.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}const d={xmlToJson:function e(t,i){if(t.nodeType===t.TEXT_NODE){var s=t.nodeValue;if(null===s.match(/^\s+$/))return s}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var r={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];r[i[o.nodeName]||o.nodeName]=o.nodeValue}for(var a=0;a<t.childNodes.length;a++){(n=e(t.childNodes[a],i))&&r.children.push(n)}return r}},clone:function(e){return JSON.parse(JSON.stringify(e))},compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return h(t[0],2)+[1,4,7,10,13].map((function(e){return h((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")},findNodeOfType:function(e,t){var i=[],s=function(e){e.type===t&&i.push(e),(e.children||[]).forEach((function(e){s(e)}))};return s(e),i},timeout:function(e){return new Promise((function(t,i){setTimeout(t,e)}))},httpRequest:function(e){return new Promise((function(t,i){var s=new XMLHttpRequest;s.open(e.method||"GET",e.url,!0),s.onload=function(e){4===s.readyState&&(200===s.status?t(s.responseXML):i(s.statusText))},s.send(null)}))},loadJSON:function(e,t,i){var s=e=>{};t=t||s,i=i||s;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.addEventListener("load",(function(e){var s=e.target.response;if(200===this.status){var r;try{r=JSON.parse(s)}catch(e){i(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}t(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(s))}catch(e){i(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}}else i(e)}),!1),r.addEventListener("error",(function(e){i(e)}),!1),r.send(null)},loadArraybuffer:function(e,t,i){var s=e=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),i=new Uint8Array(e);for(var a=0;a<o.length;a++)i[a]=o.charCodeAt(a);n.scheduleTask((()=>{t(e)}))}catch(e){n.scheduleTask((()=>{i(e)}))}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("loadArrayBuffer error : "+s.response))},s.send(null)}},queryString:function(){for(var e={},t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if(void 0===e[s[0]])e[s[0]]=decodeURIComponent(s[1]);else if("string"==typeof e[s[0]]){var r=[e[s[0]],decodeURIComponent(s[1])];e[s[0]]=r}else e[s[0]].push(decodeURIComponent(s[1]))}return e}(),isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},isString:function(e){return"string"==typeof e||e instanceof String},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isID:function(e){return d.isString(e)||d.isNumeric(e)},isSameComponent:function(e,t){return!(!e||!t)&&(d.isNumeric(e)||d.isString(e)?`${e}`:e.id)===(d.isNumeric(t)||d.isString(t)?`${t}`:t.id)},isFunction:function(e){return"function"==typeof e},isObject:function(e){const t={}.constructor;return!!e&&e.constructor===t},copy:function(e){return d.apply(e,{})},apply:function(e,t){for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},apply2:function(e,t){for(const i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&null!==e[i]&&(t[i]=e[i]);return t},applyIf:function(e,t){for(const i in e)e.hasOwnProperty(i)&&(void 0!==t[i]&&null!==t[i]||(t[i]=e[i]));return t},isEmptyObject:function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:function(e){return d.isNumeric(e)?`${e}`:`'${e}'`},concat:function(e,t){const i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i},flattenParentChildHierarchy:function(e){var t=[];return function e(i){i.id=i.uuid,delete i.oid,t.push(i);var s=i.children;if(s)for(var r=0,n=s.length;r<n;r++){s[r].parent=i.id,e(s[r])}i.children=[]}(e),t}};class u{get type(){return"Component"}get isComponent(){return!0}constructor(e={}){this._dontClear=!!e.dontClear,this.meta=e.meta||{},this.id=e.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}glRedraw(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}glResort(){this._renderer&&this._renderer.needStateSort()}isType(e){return this.type===e}fire(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==i&&(this._events[e]=t||!0);const s=this._eventSubs[e];let r;if(s)for(const i in s)s.hasOwnProperty(i)&&(r=s[i],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,i,s){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const n=this._subIdMap.addItem();r[n]={callback:i,scope:s||this},this._subIdEvents[n]=t;const o=this._events[t];return void 0!==o&&i.call(s||this,o),n}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const i=this._eventSubs[t];i&&(delete i[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,i){const s=this,r=this.on(e,(function(e){s.off(r),t.call(i||this,e)}),i)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){e="[LOG]"+this._message(e),window.console.log(e)}_message(e){return" ["+this.type+" "+d.inQuotes(this.id)+"]: "+e}warn(e){e="[WARN]"+this._message(e),window.console.warn(e)}error(e){e="[ERROR]"+this._message(e),window.console.error(e)}_attach(e){const t=e.name;if(!t)return void this.error("Component 'name' expected");let i=e.component;e.sceneDefault,e.sceneSingleton,e.type;const s=e.on,r=!1!==e.recompiles;this._attachments||(this._attachments={});const n=this._attached[t];let o,a,l;if(n){if(i&&n.id===i.id)return;const e=this._attachments[n.id];for(o=e.subs,a=0,l=o.length;a<l;a++)n.off(o[a]);delete this._attached[t],delete this._attachments[n.id];const s=e.params.onDetached;s&&(d.isFunction(s)?s(n):s.scope?s.callback.call(s.scope,n):s.callback(n)),e.managingLifecycle&&n.destroy()}if(i){const n={params:e,component:i,subs:[],managingLifecycle:false};n.subs.push(i.once("destroyed",(function(){n.params.component=null,this._attach(n.params)}),this)),r&&n.subs.push(i.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=i,this._attachments[i.id]=n;const o=e.onAttached;if(o&&(d.isFunction(o)?o(i):o.scope?o.callback.call(o.scope,i):o.callback(i)),s){let e,t,r,o;for(e in s)if(s.hasOwnProperty(e)){if(t=s[e],d.isFunction(t)?(r=t,o=null):(r=t.callback,o=t.scope),!r)continue;n.subs.push(i.on(e,r,o))}}}return r&&this.fire("dirty",this),this.fire(t,i),i}_checkComponent(e,t){if(e===t.type)return t;this.error("Expected a "+e+" Component")}_checkComponent2(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]===t.type)return t;return this.error("Expected component types: "+e),null}_own(e){this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(()=>{delete this._ownedComponents[e.id]}),this)}_needUpdate(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():n.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}scheduleTask(e){n.scheduleTask(e,null)}_update(){}clear(){if(this._ownedComponents)for(var e in this._ownedComponents)if(this._ownedComponents.hasOwnProperty(e)){this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}destroy(){if(this.destroyed)return;let e,t,i,s,r,n;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(t=this._attachments[e],i=t.component,s=t.subs,r=0,n=s.length;r<n;r++)i.off(s[r]);t.managingLifecycle&&i.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&(i=this._ownedComponents[e],i.destroy(),delete this._ownedComponents[e]);this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}let m=!0,p=m?Float64Array:Float32Array;const f=new p(3),g=new p(16),y=new p(16),_=new p(4),b={setDoublePrecisionEnabled(e){m=e,p=m?Float64Array:Float32Array},getDoublePrecisionEnabled:()=>m,MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,MAX_INT:1e7,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId(e,t){const i=t.indexOf("#");return i===e.length&&t.startsWith(e)?t.substring(i+1):t},globalizeObjectId:(e,t)=>e+"#"+t,safeInv(e){const t=1/e;return isNaN(t)||!isFinite(t)?1:t},vec2:e=>new p(e||2),vec3:e=>new p(e||3),vec4:e=>new p(e||4),mat3:e=>new p(e||9),mat3ToMat4:(e,t=new p(16))=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),mat4:e=>new p(e||16),mat4ToMat3(e,t){},doublesToFloats(e,t,i){const s=new p(2);for(let r=0,n=e.length;r<n;r++)b.splitDouble(e[r],s),t[r]=s[0],i[r]=s[1]},splitDouble(e,t){const i=p.from([e])[0],s=e-i;t[0]=i,t[1]=s},createUUID:(()=>{const e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return()=>{const t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return`${e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]}-${e[255&i]}${e[i>>8&255]}-${e[i>>16&15|64]}${e[i>>24&255]}-${e[63&s|128]}${e[s>>8&255]}-${e[s>>16&255]}${e[s>>24&255]}${e[255&r]}${e[r>>8&255]}${e[r>>16&255]}${e[r>>24&255]}`}})(),clamp:(e,t,i)=>Math.max(t,Math.min(i,e)),fmod(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2],negateVec3:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t),negateVec4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t),addVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i),addVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i),addVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i),addVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i),subVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i),subVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i),subVec2:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i),geometricMeanVec2(...e){const t=new p(e[0]);for(let i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t},subVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i),subScalarVec4:(e,t,i)=>(i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i),mulVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i),mulVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i),mulVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i),mulVec2Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i),divVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i),divVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i),divScalarVec3:(e,t,i)=>(i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i),divVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i),divVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i),divScalarVec4:(e,t,i)=>(i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i),dotVec4:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],cross3Vec4(e,t){const i=e[0],s=e[1],r=e[2],n=t[0],o=t[1],a=t[2];return[s*a-r*o,r*n-i*a,i*o-s*n,0]},cross3Vec3(e,t,i){i||(i=e);const s=e[0],r=e[1],n=e[2],o=t[0],a=t[1],l=t[2];return i[0]=r*l-n*a,i[1]=n*o-s*l,i[2]=s*a-r*o,i},sqLenVec4:e=>b.dotVec4(e,e),lenVec4:e=>Math.sqrt(b.sqLenVec4(e)),dotVec3:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],dotVec2:(e,t)=>e[0]*t[0]+e[1]*t[1],sqLenVec3:e=>b.dotVec3(e,e),sqLenVec2:e=>b.dotVec2(e,e),lenVec3:e=>Math.sqrt(b.sqLenVec3(e)),distVec3:(()=>{const e=new p(3);return(t,i)=>b.lenVec3(b.subVec3(t,i,e))})(),lenVec2:e=>Math.sqrt(b.sqLenVec2(e)),distVec2:(()=>{const e=new p(2);return(t,i)=>b.lenVec2(b.subVec2(t,i,e))})(),rcpVec3:(e,t)=>b.divScalarVec3(1,e,t),normalizeVec4(e,t){const i=1/b.lenVec4(e);return b.mulVec4Scalar(e,i,t)},normalizeVec3(e,t){const i=1/b.lenVec3(e);return b.mulVec3Scalar(e,i,t)},normalizeVec2(e,t){const i=1/b.lenVec2(e);return b.mulVec2Scalar(e,i,t)},angleVec3(e,t){let i=b.dotVec3(e,t)/Math.sqrt(b.sqLenVec3(e)*b.sqLenVec3(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:(()=>{const e=new p(3);return(t,i)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=b.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=b.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=b.lenVec3(e),i)})(),vecToArray:(()=>{function e(e){return Math.round(1e5*e)/1e5}return t=>{for(let i=0,s=(t=Array.prototype.slice.call(t)).length;i<s;i++)t[i]=e(t[i]);return t}})(),xyzArrayToObject:e=>({x:e[0],y:e[1],z:e[2]}),xyzObjectToArray:(e,t)=>((t=t||b.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t),dupMat4:e=>e.slice(0,16),mat4To3:e=>[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]],m4s:e=>[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],setMat4ToZeroes:()=>b.m4s(0),setMat4ToOnes:()=>b.m4s(1),diagonalMat4v:e=>new p([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]),diagonalMat4c:(e,t,i,s)=>b.diagonalMat4v([e,t,i,s]),diagonalMat4s:e=>b.diagonalMat4c(e,e,e,e),identityMat4:(e=new p(16))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),identityMat3:(e=new p(9))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e),isIdentityMat4:e=>1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15],negateMat4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t),addMat4:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i[9]=e[9]+t[9],i[10]=e[10]+t[10],i[11]=e[11]+t[11],i[12]=e[12]+t[12],i[13]=e[13]+t[13],i[14]=e[14]+t[14],i[15]=e[15]+t[15],i),addMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i[4]=e[4]+t,i[5]=e[5]+t,i[6]=e[6]+t,i[7]=e[7]+t,i[8]=e[8]+t,i[9]=e[9]+t,i[10]=e[10]+t,i[11]=e[11]+t,i[12]=e[12]+t,i[13]=e[13]+t,i[14]=e[14]+t,i[15]=e[15]+t,i),addScalarMat4:(e,t,i)=>b.addMat4Scalar(t,e,i),subMat4:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i[9]=e[9]-t[9],i[10]=e[10]-t[10],i[11]=e[11]-t[11],i[12]=e[12]-t[12],i[13]=e[13]-t[13],i[14]=e[14]-t[14],i[15]=e[15]-t[15],i),subMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i[4]=e[4]-t,i[5]=e[5]-t,i[6]=e[6]-t,i[7]=e[7]-t,i[8]=e[8]-t,i[9]=e[9]-t,i[10]=e[10]-t,i[11]=e[11]-t,i[12]=e[12]-t,i[13]=e[13]-t,i[14]=e[14]-t,i[15]=e[15]-t,i),subScalarMat4:(e,t,i)=>(i||(i=t),i[0]=e-t[0],i[1]=e-t[1],i[2]=e-t[2],i[3]=e-t[3],i[4]=e-t[4],i[5]=e-t[5],i[6]=e-t[6],i[7]=e-t[7],i[8]=e-t[8],i[9]=e-t[9],i[10]=e-t[10],i[11]=e-t[11],i[12]=e-t[12],i[13]=e-t[13],i[14]=e-t[14],i[15]=e-t[15],i),mulMat4(e,t,i){i||(i=e);const s=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],m=e[10],p=e[11],f=e[12],g=e[13],y=e[14],_=e[15],b=t[0],w=t[1],v=t[2],M=t[3],x=t[4],A=t[5],I=t[6],P=t[7],T=t[8],k=t[9],D=t[10],E=t[11],S=t[12],B=t[13],U=t[14],O=t[15];return i[0]=b*s+w*a+v*d+M*f,i[1]=b*r+w*l+v*u+M*g,i[2]=b*n+w*c+v*m+M*y,i[3]=b*o+w*h+v*p+M*_,i[4]=x*s+A*a+I*d+P*f,i[5]=x*r+A*l+I*u+P*g,i[6]=x*n+A*c+I*m+P*y,i[7]=x*o+A*h+I*p+P*_,i[8]=T*s+k*a+D*d+E*f,i[9]=T*r+k*l+D*u+E*g,i[10]=T*n+k*c+D*m+E*y,i[11]=T*o+k*h+D*p+E*_,i[12]=S*s+B*a+U*d+O*f,i[13]=S*r+B*l+U*u+O*g,i[14]=S*n+B*c+U*m+O*y,i[15]=S*o+B*h+U*p+O*_,i},mulMat3(e,t,i){i||(i=new p(9));const s=e[0],r=e[3],n=e[6],o=e[1],a=e[4],l=e[7],c=e[2],h=e[5],d=e[8],u=t[0],m=t[3],f=t[6],g=t[1],y=t[4],_=t[7],b=t[2],w=t[5],v=t[8];return i[0]=s*u+r*g+n*b,i[3]=s*m+r*y+n*w,i[6]=s*f+r*_+n*v,i[1]=o*u+a*g+l*b,i[4]=o*m+a*y+l*w,i[7]=o*f+a*_+l*v,i[2]=c*u+h*g+d*b,i[5]=c*m+h*y+d*w,i[8]=c*f+h*_+d*v,i},mulMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i),mulMat4v4(e,t,i=b.vec4()){const s=t[0],r=t[1],n=t[2],o=t[3];return i[0]=e[0]*s+e[4]*r+e[8]*n+e[12]*o,i[1]=e[1]*s+e[5]*r+e[9]*n+e[13]*o,i[2]=e[2]*s+e[6]*r+e[10]*n+e[14]*o,i[3]=e[3]*s+e[7]*r+e[11]*n+e[15]*o,i},transposeMat4(e,t){const i=e[4],s=e[14],r=e[8],n=e[13],o=e[12],a=e[9];if(!t||e===t){const t=e[1],l=e[2],c=e[3],h=e[6],d=e[7],u=e[11];return e[1]=i,e[2]=r,e[3]=o,e[4]=t,e[6]=a,e[7]=n,e[8]=l,e[9]=h,e[11]=s,e[12]=c,e[13]=d,e[14]=u,e}return t[0]=e[0],t[1]=i,t[2]=r,t[3]=o,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=n,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=s,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3(e,t){if(t===e){const i=e[1],s=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4(e){const t=e[0],i=e[1],s=e[2],r=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],m=e[12],p=e[13],f=e[14],g=e[15];return m*h*a*r-c*p*a*r-m*o*d*r+n*p*d*r+c*o*f*r-n*h*f*r-m*h*s*l+c*p*s*l+m*i*d*l-t*p*d*l-c*i*f*l+t*h*f*l+m*o*s*u-n*p*s*u-m*i*a*u+t*p*a*u+n*i*f*u-t*o*f*u-c*o*s*g+n*h*s*g+c*i*a*g-t*h*a*g-n*i*d*g+t*o*d*g},inverseMat4(e,t){t||(t=e);const i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],m=e[11],p=e[12],f=e[13],g=e[14],y=e[15],_=i*a-s*o,b=i*l-r*o,w=i*c-n*o,v=s*l-r*a,M=s*c-n*a,x=r*c-n*l,A=h*f-d*p,I=h*g-u*p,P=h*y-m*p,T=d*g-u*f,k=d*y-m*f,D=u*y-m*g,E=1/(_*D-b*k+w*T+v*P-M*I+x*A);return t[0]=(a*D-l*k+c*T)*E,t[1]=(-s*D+r*k-n*T)*E,t[2]=(f*x-g*M+y*v)*E,t[3]=(-d*x+u*M-m*v)*E,t[4]=(-o*D+l*P-c*I)*E,t[5]=(i*D-r*P+n*I)*E,t[6]=(-p*x+g*w-y*b)*E,t[7]=(h*x-u*w+m*b)*E,t[8]=(o*k-a*P+c*A)*E,t[9]=(-i*k+s*P-n*A)*E,t[10]=(p*M-f*w+y*_)*E,t[11]=(-h*M+d*w-m*_)*E,t[12]=(-o*T+a*I-l*A)*E,t[13]=(i*T-s*I+r*A)*E,t[14]=(-p*v+f*b-g*_)*E,t[15]=(h*v-d*b+u*_)*E,t},traceMat4:e=>e[0]+e[5]+e[10]+e[15],translationMat4v(e,t){const i=t||b.identityMat4();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i},translationMat3v(e,t){const i=t||b.identityMat3();return i[6]=e[0],i[7]=e[1],i},translationMat4c:(()=>{const e=new p(3);return(t,i,s,r)=>(e[0]=t,e[1]=i,e[2]=s,b.translationMat4v(e,r))})(),translationMat4s:(e,t)=>b.translationMat4c(e,e,e,t),translateMat4v:(e,t)=>b.translateMat4c(e[0],e[1],e[2],t),translateMat4c(e,t,i,s){const r=s[3];s[0]+=r*e,s[1]+=r*t,s[2]+=r*i;const n=s[7];s[4]+=n*e,s[5]+=n*t,s[6]+=n*i;const o=s[11];s[8]+=o*e,s[9]+=o*t,s[10]+=o*i;const a=s[15];return s[12]+=a*e,s[13]+=a*t,s[14]+=a*i,s},setMat4Translation:(e,t,i)=>(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i),rotationMat4v(e,t,i){const s=b.normalizeVec4([t[0],t[1],t[2],0],[]),r=Math.sin(e),n=Math.cos(e),o=1-n,a=s[0],l=s[1],c=s[2];let h,d,u,m,p,f;return h=a*l,d=l*c,u=c*a,m=a*r,p=l*r,f=c*r,(i=i||b.mat4())[0]=o*a*a+n,i[1]=o*h+f,i[2]=o*u-p,i[3]=0,i[4]=o*h-f,i[5]=o*l*l+n,i[6]=o*d+m,i[7]=0,i[8]=o*u+p,i[9]=o*d-m,i[10]=o*c*c+n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},rotationMat4c:(e,t,i,s,r)=>b.rotationMat4v(e,[t,i,s],r),scalingMat4v:(e,t=b.identityMat4())=>(t[0]=e[0],t[5]=e[1],t[10]=e[2],t),scalingMat3v:(e,t=b.identityMat3())=>(t[0]=e[0],t[4]=e[1],t),scalingMat4c:(()=>{const e=new p(3);return(t,i,s,r)=>(e[0]=t,e[1]=i,e[2]=s,b.scalingMat4v(e,r))})(),scaleMat4c:(e,t,i,s)=>(s[0]*=e,s[4]*=t,s[8]*=i,s[1]*=e,s[5]*=t,s[9]*=i,s[2]*=e,s[6]*=t,s[10]*=i,s[3]*=e,s[7]*=t,s[11]*=i,s),scaleMat4v(e,t){const i=e[0],s=e[1],r=e[2];return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,t},scalingMat4s:e=>b.scalingMat4c(e,e,e),rotationTranslationMat4(e,t,i=b.mat4()){const s=e[0],r=e[1],n=e[2],o=e[3],a=s+s,l=r+r,c=n+n,h=s*a,d=s*l,u=s*c,m=r*l,p=r*c,f=n*c,g=o*a,y=o*l,_=o*c;return i[0]=1-(m+f),i[1]=d+_,i[2]=u-y,i[3]=0,i[4]=d-_,i[5]=1-(h+f),i[6]=p+g,i[7]=0,i[8]=u+y,i[9]=p-g,i[10]=1-(h+m),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},mat4ToEuler(e,t,i=b.vec4()){const s=b.clamp,r=e[0],n=e[4],o=e[8],a=e[1],l=e[5],c=e[9],h=e[2],d=e[6],u=e[10];return"XYZ"===t?(i[1]=Math.asin(s(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-c,u),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(d,l),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-s(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(o,u),i[2]=Math.atan2(a,l)):(i[1]=Math.atan2(-h,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(s(d,-1,1)),Math.abs(d)<.99999?(i[1]=Math.atan2(-h,u),i[2]=Math.atan2(-n,l)):(i[1]=0,i[2]=Math.atan2(a,r))):"ZYX"===t?(i[1]=Math.asin(-s(h,-1,1)),Math.abs(h)<.99999?(i[0]=Math.atan2(d,u),i[2]=Math.atan2(a,r)):(i[0]=0,i[2]=Math.atan2(-n,l))):"YZX"===t?(i[2]=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(i[0]=Math.atan2(-c,l),i[1]=Math.atan2(-h,r)):(i[0]=0,i[1]=Math.atan2(o,u))):"XZY"===t&&(i[2]=Math.asin(-s(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(d,l),i[1]=Math.atan2(o,r)):(i[0]=Math.atan2(-c,u),i[1]=0)),i},composeMat4:(e,t,i,s=b.mat4())=>(b.quaternionToRotationMat4(t,s),b.scaleMat4v(i,s),b.translateMat4v(e,s),s),decomposeMat4:(()=>{const e=new p(3),t=new p(16);return function(i,s,r,n){e[0]=i[0],e[1]=i[1],e[2]=i[2];let o=b.lenVec3(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];const a=b.lenVec3(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];const l=b.lenVec3(e);b.determinantMat4(i)<0&&(o=-o),s[0]=i[12],s[1]=i[13],s[2]=i[14],t.set(i);const c=1/o,h=1/a,d=1/l;return t[0]*=c,t[1]*=c,t[2]*=c,t[4]*=h,t[5]*=h,t[6]*=h,t[8]*=d,t[9]*=d,t[10]*=d,b.mat4ToQuaternion(t,r),n[0]=o,n[1]=a,n[2]=l,this}})(),getColMat4(e,t){const i=4*t;return[e[i],e[i+1],e[i+2],e[i+3]]},setRowMat4(e,t,i){e[t]=i[0],e[t+4]=i[1],e[t+8]=i[2],e[t+12]=i[3]},lookAtMat4v(e,t,i,s){s||(s=b.mat4());const r=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2],h=t[0],d=t[1],u=t[2];if(r===h&&n===d&&o===u)return b.identityMat4();let m,p,f,g,y,_,w,v,M,x;return m=r-h,p=n-d,f=o-u,x=1/Math.sqrt(m*m+p*p+f*f),m*=x,p*=x,f*=x,g=l*f-c*p,y=c*m-a*f,_=a*p-l*m,x=Math.sqrt(g*g+y*y+_*_),x?(x=1/x,g*=x,y*=x,_*=x):(g=0,y=0,_=0),w=p*_-f*y,v=f*g-m*_,M=m*y-p*g,x=Math.sqrt(w*w+v*v+M*M),x?(x=1/x,w*=x,v*=x,M*=x):(w=0,v=0,M=0),s[0]=g,s[1]=w,s[2]=m,s[3]=0,s[4]=y,s[5]=v,s[6]=p,s[7]=0,s[8]=_,s[9]=M,s[10]=f,s[11]=0,s[12]=-(g*r+y*n+_*o),s[13]=-(w*r+v*n+M*o),s[14]=-(m*r+p*n+f*o),s[15]=1,s},lookAtMat4c:(e,t,i,s,r,n,o,a,l)=>b.lookAtMat4v([e,t,i],[s,r,n],[o,a,l],[]),orthoMat4c(e,t,i,s,r,n,o){o||(o=b.mat4());const a=t-e,l=s-i,c=n-r;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(e+t)/a,o[13]=-(s+i)/l,o[14]=-(n+r)/c,o[15]=1,o},frustumMat4v(e,t,i){i||(i=b.mat4());const s=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0];b.addVec4(r,s,g),b.subVec4(r,s,y);const n=2*s[2],o=y[0],a=y[1],l=y[2];return i[0]=n/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n/a,i[6]=0,i[7]=0,i[8]=g[0]/o,i[9]=g[1]/a,i[10]=-g[2]/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-n*r[2]/l,i[15]=0,i},frustumMat4(e,t,i,s,r,n,o){o||(o=b.mat4());const a=t-e,l=s-i,c=n-r;return o[0]=2*r/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*r/l,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(s+i)/l,o[10]=-(n+r)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-n*r*2/c,o[15]=0,o},perspectiveMat4(e,t,i,s,r){const n=[],o=[];return n[2]=i,o[2]=s,o[1]=n[2]*Math.tan(e/2),n[1]=-o[1],o[0]=o[1]*t,n[0]=-o[0],b.frustumMat4v(n,o,r)},compareMat4:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15],transformPoint3(e,t,i=b.vec3()){const s=t[0],r=t[1],n=t[2];return i[0]=e[0]*s+e[4]*r+e[8]*n+e[12],i[1]=e[1]*s+e[5]*r+e[9]*n+e[13],i[2]=e[2]*s+e[6]*r+e[10]*n+e[14],i},transformPoint4:(e,t,i=b.vec4())=>(i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i),transformPoints3(e,t,i){const s=i||[],r=t.length;let n,o,a,l;const c=e[0],h=e[1],d=e[2],u=e[3],m=e[4],p=e[5],f=e[6],g=e[7],y=e[8],_=e[9],b=e[10],w=e[11],v=e[12],M=e[13],x=e[14],A=e[15];let I;for(let e=0;e<r;++e)l=t[e],n=l[0],o=l[1],a=l[2],I=s[e]||(s[e]=[0,0,0]),I[0]=c*n+m*o+y*a+v,I[1]=h*n+p*o+_*a+M,I[2]=d*n+f*o+b*a+x,I[3]=u*n+g*o+w*a+A;return s.length=r,s},transformPositions3(e,t,i=t){let s;const r=t.length;let n,o,a;const l=e[0],c=e[1],h=e[2];e[3];const d=e[4],u=e[5],m=e[6];e[7];const p=e[8],f=e[9],g=e[10];e[11];const y=e[12],_=e[13],b=e[14];for(e[15],s=0;s<r;s+=3)n=t[s+0],o=t[s+1],a=t[s+2],i[s+0]=l*n+d*o+p*a+y,i[s+1]=c*n+u*o+f*a+_,i[s+2]=h*n+m*o+g*a+b;return i},transformPositions4(e,t,i=t){let s;const r=t.length;let n,o,a;const l=e[0],c=e[1],h=e[2],d=e[3],u=e[4],m=e[5],p=e[6],f=e[7],g=e[8],y=e[9],_=e[10],b=e[11],w=e[12],v=e[13],M=e[14],x=e[15];for(s=0;s<r;s+=4)n=t[s+0],o=t[s+1],a=t[s+2],i[s+0]=l*n+u*o+g*a+w,i[s+1]=c*n+m*o+y*a+v,i[s+2]=h*n+p*o+_*a+M,i[s+3]=d*n+f*o+b*a+x;return i},transformVec3(e,t,i){const s=t[0],r=t[1],n=t[2];return(i=i||this.vec3())[0]=e[0]*s+e[4]*r+e[8]*n,i[1]=e[1]*s+e[5]*r+e[9]*n,i[2]=e[2]*s+e[6]*r+e[10]*n,i},transformVec4(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3];return(i=i||b.vec4())[0]=e[0]*s+e[4]*r+e[8]*n+e[12]*o,i[1]=e[1]*s+e[5]*r+e[9]*n+e[13]*o,i[2]=e[2]*s+e[6]*r+e[10]*n+e[14]*o,i[3]=e[3]*s+e[7]*r+e[11]*n+e[15]*o,i},rotateVec2(e,t,i,s=e){const r=Math.cos(i),n=Math.sin(i),o=e[0]-t[0],a=e[1]-t[1];return s[0]=o*r-a*n+t[0],s[1]=o*n+a*r+t[1],e},rotateVec3X(e,t,i,s){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},rotateVec3Y(e,t,i,s){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},rotateVec3Z(e,t,i,s){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},projectVec4(e,t){const i=1/e[3];return(t=t||b.vec2())[0]=e[0]*i,t[1]=e[1]*i,t},unprojectVec3:(()=>{const e=new p(16),t=new p(16),i=new p(16);return function(s,r,n,o){return this.transformVec3(this.mulMat4(this.inverseMat4(r,e),this.inverseMat4(n,t),i),s,o)}})(),lerpVec3(e,t,i,s,r,n){const o=n||b.vec3(),a=(e-t)/(i-t);return o[0]=s[0]+a*(r[0]-s[0]),o[1]=s[1]+a*(r[1]-s[1]),o[2]=s[2]+a*(r[2]-s[2]),o},lerpMat4(e,t,i,s,r,n){const o=n||b.mat4(),a=(e-t)/(i-t);return o[0]=s[0]+a*(r[0]-s[0]),o[1]=s[1]+a*(r[1]-s[1]),o[2]=s[2]+a*(r[2]-s[2]),o[3]=s[3]+a*(r[3]-s[3]),o[4]=s[4]+a*(r[4]-s[4]),o[5]=s[5]+a*(r[5]-s[5]),o[6]=s[6]+a*(r[6]-s[6]),o[7]=s[7]+a*(r[7]-s[7]),o[8]=s[8]+a*(r[8]-s[8]),o[9]=s[9]+a*(r[9]-s[9]),o[10]=s[10]+a*(r[10]-s[10]),o[11]=s[11]+a*(r[11]-s[11]),o[12]=s[12]+a*(r[12]-s[12]),o[13]=s[13]+a*(r[13]-s[13]),o[14]=s[14]+a*(r[14]-s[14]),o[15]=s[15]+a*(r[15]-s[15]),o},flatten(e){const t=[];let i,s,r,n,o;for(i=0,s=e.length;i<s;i++)for(o=e[i],r=0,n=o.length;r<n;r++)t.push(o[r]);return t},identityQuaternion:(e=b.vec4())=>(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e),eulerToQuaternion(e,t,i=b.vec4()){const s=e[0]*b.DEGTORAD/2,r=e[1]*b.DEGTORAD/2,n=e[2]*b.DEGTORAD/2,o=Math.cos(s),a=Math.cos(r),l=Math.cos(n),c=Math.sin(s),h=Math.sin(r),d=Math.sin(n);return"XYZ"===t?(i[0]=c*a*l+o*h*d,i[1]=o*h*l-c*a*d,i[2]=o*a*d+c*h*l,i[3]=o*a*l-c*h*d):"YXZ"===t?(i[0]=c*a*l+o*h*d,i[1]=o*h*l-c*a*d,i[2]=o*a*d-c*h*l,i[3]=o*a*l+c*h*d):"ZXY"===t?(i[0]=c*a*l-o*h*d,i[1]=o*h*l+c*a*d,i[2]=o*a*d+c*h*l,i[3]=o*a*l-c*h*d):"ZYX"===t?(i[0]=c*a*l-o*h*d,i[1]=o*h*l+c*a*d,i[2]=o*a*d-c*h*l,i[3]=o*a*l+c*h*d):"YZX"===t?(i[0]=c*a*l+o*h*d,i[1]=o*h*l+c*a*d,i[2]=o*a*d-c*h*l,i[3]=o*a*l-c*h*d):"XZY"===t&&(i[0]=c*a*l-o*h*d,i[1]=o*h*l-c*a*d,i[2]=o*a*d+c*h*l,i[3]=o*a*l+c*h*d),i},mat4ToQuaternion(e,t=b.vec4()){const i=e[0],s=e[4],r=e[8],n=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10];let d;const u=i+o+h;return u>0?(d=.5/Math.sqrt(u+1),t[3]=.25/d,t[0]=(c-a)*d,t[1]=(r-l)*d,t[2]=(n-s)*d):i>o&&i>h?(d=2*Math.sqrt(1+i-o-h),t[3]=(c-a)/d,t[0]=.25*d,t[1]=(s+n)/d,t[2]=(r+l)/d):o>h?(d=2*Math.sqrt(1+o-i-h),t[3]=(r-l)/d,t[0]=(s+n)/d,t[1]=.25*d,t[2]=(a+c)/d):(d=2*Math.sqrt(1+h-i-o),t[3]=(n-s)/d,t[0]=(r+l)/d,t[1]=(a+c)/d,t[2]=.25*d),t},vec3PairToQuaternion(e,t,i=b.vec4()){const s=Math.sqrt(b.dotVec3(e,e)*b.dotVec3(t,t));let r=s+b.dotVec3(e,t);return r<1e-8*s?(r=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):b.cross3Vec3(e,t,i),i[3]=r,b.normalizeQuaternion(i)},angleAxisToQuaternion(e,t=b.vec4()){const i=e[3]/2,s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t},quaternionToEuler:(()=>{const e=new p(16);return(t,i,s)=>(s=s||b.vec3(),b.quaternionToRotationMat4(t,e),b.mat4ToEuler(e,i,s),s)})(),mulQuaternions(e,t,i=b.vec4()){const s=e[0],r=e[1],n=e[2],o=e[3],a=t[0],l=t[1],c=t[2],h=t[3];return i[0]=o*a+s*h+r*c-n*l,i[1]=o*l+r*h+n*a-s*c,i[2]=o*c+n*h+s*l-r*a,i[3]=o*h-s*a-r*l-n*c,i},vec3ApplyQuaternion(e,t,i=b.vec3()){const s=t[0],r=t[1],n=t[2],o=e[0],a=e[1],l=e[2],c=e[3],h=c*s+a*n-l*r,d=c*r+l*s-o*n,u=c*n+o*r-a*s,m=-o*s-a*r-l*n;return i[0]=h*c+m*-o+d*-l-u*-a,i[1]=d*c+m*-a+u*-o-h*-l,i[2]=u*c+m*-l+h*-a-d*-o,i},quaternionToMat4(e,t){t=b.identityMat4(t);const i=e[0],s=e[1],r=e[2],n=e[3],o=2*i,a=2*s,l=2*r,c=o*n,h=a*n,d=l*n,u=o*i,m=a*i,p=l*i,f=a*s,g=l*s,y=l*r;return t[0]=1-(f+y),t[1]=m+d,t[2]=p-h,t[4]=m-d,t[5]=1-(u+y),t[6]=g+c,t[8]=p+h,t[9]=g-c,t[10]=1-(u+f),t},quaternionToRotationMat4(e,t){const i=e[0],s=e[1],r=e[2],n=e[3],o=i+i,a=s+s,l=r+r,c=i*o,h=i*a,d=i*l,u=s*a,m=s*l,p=r*l,f=n*o,g=n*a,y=n*l;return t[0]=1-(u+p),t[4]=h-y,t[8]=d+g,t[1]=h+y,t[5]=1-(c+p),t[9]=m-f,t[2]=d-g,t[6]=m+f,t[10]=1-(c+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion(e,t=e){const i=b.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t},conjugateQuaternion:(e,t=e)=>(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t),inverseQuaternion:(e,t)=>b.normalizeQuaternion(b.conjugateQuaternion(e,t)),quaternionToAngleAxis(e,t=b.vec4()){const i=(e=b.normalizeQuaternion(e,_))[3],s=2*Math.acos(i),r=Math.sqrt(1-i*i);return r<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r),t[3]=s,t},AABB3:e=>new p(e||6),AABB2:e=>new p(e||4),OBB3:e=>new p(e||32),OBB2:e=>new p(e||16),Sphere3:(e,t,i,s)=>new p([e,t,i,s]),transformOBB3(e,t,i=t){let s;const r=t.length;let n,o,a;const l=e[0],c=e[1],h=e[2],d=e[3],u=e[4],m=e[5],p=e[6],f=e[7],g=e[8],y=e[9],_=e[10],b=e[11],w=e[12],v=e[13],M=e[14],x=e[15];for(s=0;s<r;s+=4)n=t[s+0],o=t[s+1],a=t[s+2],i[s+0]=l*n+u*o+g*a+w,i[s+1]=c*n+m*o+y*a+v,i[s+2]=h*n+p*o+_*a+M,i[s+3]=d*n+f*o+b*a+x;return i},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:(()=>{const e=new p(3),t=new p(3),i=new p(3);return s=>(e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5],b.subVec3(t,e,i),Math.abs(b.lenVec3(i)))})(),getAABB3DiagPoint:(()=>{const e=new p(3),t=new p(3),i=new p(3);return(s,r)=>{e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5];const n=b.subVec3(t,e,i),o=r[0]-s[0],a=s[3]-r[0],l=r[1]-s[1],c=s[4]-r[1],h=r[2]-s[2],d=s[5]-r[2];return n[0]+=o>a?o:a,n[1]+=l>c?l:c,n[2]+=h>d?h:d,Math.abs(b.lenVec3(n))}})(),getAABB3Area:e=>(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2]),getAABB3Center(e,t){const i=t||b.vec3();return i[0]=(e[0]+e[3])/2,i[1]=(e[1]+e[4])/2,i[2]=(e[2]+e[5])/2,i},getAABB2Center(e,t){const i=t||b.vec2();return i[0]=(e[2]+e[0])/2,i[1]=(e[3]+e[1])/2,i},collapseAABB3:(e=b.AABB3())=>(e[0]=b.MAX_DOUBLE,e[1]=b.MAX_DOUBLE,e[2]=b.MAX_DOUBLE,e[3]=b.MIN_DOUBLE,e[4]=b.MIN_DOUBLE,e[5]=b.MIN_DOUBLE,e),AABB3ToOBB3:(e,t=b.OBB3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t),positions3ToAABB3:(()=>{const e=new p(3);return(t,i,s)=>{i=i||b.AABB3();let r,n,o,a=b.MAX_DOUBLE,l=b.MAX_DOUBLE,c=b.MAX_DOUBLE,h=b.MIN_DOUBLE,d=b.MIN_DOUBLE,u=b.MIN_DOUBLE;for(let i=0,m=t.length;i<m;i+=3)s?(e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2],b.decompressPosition(e,s,e),r=e[0],n=e[1],o=e[2]):(r=t[i+0],n=t[i+1],o=t[i+2]),r<a&&(a=r),n<l&&(l=n),o<c&&(c=o),r>h&&(h=r),n>d&&(d=n),o>u&&(u=o);return i[0]=a,i[1]=l,i[2]=c,i[3]=h,i[4]=d,i[5]=u,i}})(),OBB3ToAABB3(e,t=b.AABB3()){let i,s,r,n=b.MAX_DOUBLE,o=b.MAX_DOUBLE,a=b.MAX_DOUBLE,l=b.MIN_DOUBLE,c=b.MIN_DOUBLE,h=b.MIN_DOUBLE;for(let t=0,d=e.length;t<d;t+=4)i=e[t+0],s=e[t+1],r=e[t+2],i<n&&(n=i),s<o&&(o=s),r<a&&(a=r),i>l&&(l=i),s>c&&(c=s),r>h&&(h=r);return t[0]=n,t[1]=o,t[2]=a,t[3]=l,t[4]=c,t[5]=h,t},points3ToAABB3(e,t=b.AABB3()){let i,s,r,n=b.MAX_DOUBLE,o=b.MAX_DOUBLE,a=b.MAX_DOUBLE,l=b.MIN_DOUBLE,c=b.MIN_DOUBLE,h=b.MIN_DOUBLE;for(let t=0,d=e.length;t<d;t++)i=e[t][0],s=e[t][1],r=e[t][2],i<n&&(n=i),s<o&&(o=s),r<a&&(a=r),i>l&&(l=i),s>c&&(c=s),r>h&&(h=r);return t[0]=n,t[1]=o,t[2]=a,t[3]=l,t[4]=c,t[5]=h,t},points3ToSphere3:(()=>{const e=new p(3);return(t,i)=>{i=i||b.vec4();let s,r=0,n=0,o=0;const a=t.length;for(s=0;s<a;s++)r+=t[s][0],n+=t[s][1],o+=t[s][2];i[0]=r/a,i[1]=n/a,i[2]=o/a;let l,c=0;for(s=0;s<a;s++)l=Math.abs(b.lenVec3(b.subVec3(t[s],i,e))),l>c&&(c=l);return i[3]=c,i}})(),positions3ToSphere3:(()=>{const e=new p(3),t=new p(3);return(i,s)=>{s=s||b.vec4();let r,n=0,o=0,a=0;const l=i.length;let c=0;for(r=0;r<l;r+=3)n+=i[r],o+=i[r+1],a+=i[r+2];const h=l/3;let d;for(s[0]=n/h,s[1]=o/h,s[2]=a/h,r=0;r<l;r+=3)e[0]=i[r],e[1]=i[r+1],e[2]=i[r+2],d=Math.abs(b.lenVec3(b.subVec3(e,s,t))),d>c&&(c=d);return s[3]=c,s}})(),OBB3ToSphere3:(()=>{const e=new p(3),t=new p(3);return(i,s)=>{s=s||b.vec4();let r,n=0,o=0,a=0;const l=i.length,c=l/4;for(r=0;r<l;r+=4)n+=i[r+0],o+=i[r+1],a+=i[r+2];s[0]=n/c,s[1]=o/c,s[2]=a/c;let h,d=0;for(r=0;r<l;r+=4)e[0]=i[r+0],e[1]=i[r+1],e[2]=i[r+2],h=Math.abs(b.lenVec3(b.subVec3(e,s,t))),h>d&&(d=h);return s[3]=d,s}})(),getSphere3Center:(e,t=b.vec3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),getPositionsCenter(e,t=b.vec3()){let i=0,s=0,r=0;for(var n=0,o=e.length;n<o;n+=3)i+=e[n+0],s+=e[n+1],r+=e[n+2];const a=e.length/3;return t[0]=i/a,t[1]=s/a,t[2]=r/a,t},expandAABB3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e),expandAABB3Point3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e),expandAABB3Points3(e,t){for(var i,s,r,n=0,o=t.length;n<o;n+=3)i=t[n],s=t[n+1],r=t[n+2],e[0]>i&&(e[0]=i),e[1]>s&&(e[1]=s),e[2]>r&&(e[2]=r),e[3]<i&&(e[3]=i),e[4]<s&&(e[4]=s),e[5]<r&&(e[5]=r);return e},collapseAABB2:(e=b.AABB2())=>(e[0]=b.MAX_DOUBLE,e[1]=b.MAX_DOUBLE,e[2]=b.MIN_DOUBLE,e[3]=b.MIN_DOUBLE,e),point3AABB3Intersect:(e,t)=>e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2],planeAABB3Intersect(e,t,i){let s,r;e[0]>0?(s=e[0]*i[0],r=e[0]*i[3]):(s=e[0]*i[3],r=e[0]*i[0]),e[1]>0?(s+=e[1]*i[1],r+=e[1]*i[4]):(s+=e[1]*i[4],r+=e[1]*i[1]),e[2]>0?(s+=e[2]*i[2],r+=e[2]*i[5]):(s+=e[2]*i[5],r+=e[2]*i[2]);if(s<=-t&&r<=-t)return-1;return s>=-t&&r>=-t?1:0},OBB3ToAABB2(e,t=b.AABB2()){let i,s,r,n,o=b.MAX_DOUBLE,a=b.MAX_DOUBLE,l=b.MIN_DOUBLE,c=b.MIN_DOUBLE;for(let t=0,h=e.length;t<h;t+=4)i=e[t+0],s=e[t+1],r=e[t+3]||1,n=1/r,i*=n,s*=n,i<o&&(o=i),s<a&&(a=s),i>l&&(l=i),s>c&&(c=s);return t[0]=o,t[1]=a,t[2]=l,t[3]=c,t},expandAABB2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e),expandAABB2Point2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e),AABB2ToCanvas(e,t,i,s=e){const r=.5*(e[0]+1),n=.5*(e[1]+1),o=.5*(e[2]+1),a=.5*(e[3]+1);return s[0]=Math.floor(r*t),s[1]=i-Math.floor(a*i),s[2]=Math.floor(o*t),s[3]=i-Math.floor(n*i),s},tangentQuadraticBezier:(e,t,i,s)=>2*(1-e)*(i-t)+2*e*(s-i),tangentQuadraticBezier3:(e,t,i,s,r)=>-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*s*(1-e)-3*e*e*s+3*e*e*r,tangentSpline:e=>6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e),catmullRomInterpolate(e,t,i,s,r){const n=.5*(i-e),o=.5*(s-t),a=r*r;return(2*t-2*i+n+o)*(r*a)+(-3*t+3*i-2*n-o)*a+n*r+t},b2p0(e,t){const i=1-e;return i*i*t},b2p1:(e,t)=>2*(1-e)*e*t,b2p2:(e,t)=>e*e*t,b2(e,t,i,s){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,s)},b3p0(e,t){const i=1-e;return i*i*i*t},b3p1(e,t){const i=1-e;return 3*i*i*e*t},b3p2:(e,t)=>3*(1-e)*e*e*t,b3p3:(e,t)=>e*e*e*t,b3(e,t,i,s,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,s)+this.b3p3(e,r)},triangleNormal(e,t,i,s=b.vec3()){const r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],a=i[0]-e[0],l=i[1]-e[1],c=i[2]-e[2],h=n*c-o*l,d=o*a-r*c,u=r*l-n*a,m=Math.sqrt(h*h+d*d+u*u);return 0===m?(s[0]=0,s[1]=0,s[2]=0):(s[0]=h/m,s[1]=d/m,s[2]=u/m),s},rayTriangleIntersect:(()=>{const e=new p(3),t=new p(3),i=new p(3),s=new p(3),r=new p(3);return(n,o,a,l,c,h)=>{h=h||b.vec3();const d=b.subVec3(l,a,e),u=b.subVec3(c,a,t),m=b.cross3Vec3(o,u,i),p=b.dotVec3(d,m);if(p<1e-6)return null;const f=b.subVec3(n,a,s),g=b.dotVec3(f,m);if(g<0||g>p)return null;const y=b.cross3Vec3(f,d,r),_=b.dotVec3(o,y);if(_<0||g+_>p)return null;const w=b.dotVec3(u,y)/p;return h[0]=n[0]+w*o[0],h[1]=n[1]+w*o[1],h[2]=n[2]+w*o[2],h}})(),rayPlaneIntersect:(()=>{const e=new p(3),t=new p(3),i=new p(3),s=new p(3);return(r,n,o,a,l,c)=>{c=c||b.vec3(),n=b.normalizeVec3(n,e);const h=b.subVec3(a,o,t),d=b.subVec3(l,o,i),u=b.cross3Vec3(h,d,s);b.normalizeVec3(u,u);const m=-b.dotVec3(o,u),p=-(b.dotVec3(r,u)+m)/b.dotVec3(n,u);return c[0]=r[0]+p*n[0],c[1]=r[1]+p*n[1],c[2]=r[2]+p*n[2],c}})(),cartesianToBarycentric:(()=>{const e=new p(3),t=new p(3),i=new p(3);return(s,r,n,o,a)=>{const l=b.subVec3(o,r,e),c=b.subVec3(n,r,t),h=b.subVec3(s,r,i),d=b.dotVec3(l,l),u=b.dotVec3(l,c),m=b.dotVec3(l,h),p=b.dotVec3(c,c),f=b.dotVec3(c,h),g=d*p-u*u;if(0===g)return null;const y=1/g,_=(p*m-u*f)*y,w=(d*f-u*m)*y;return a[0]=1-_-w,a[1]=w,a[2]=_,a}})(),barycentricInsideTriangle(e){const t=e[1],i=e[2];return i>=0&&t>=0&&i+t<1},barycentricToCartesian(e,t,i,s,r=b.vec3()){const n=e[0],o=e[1],a=e[2];return r[0]=t[0]*n+i[0]*o+s[0]*a,r[1]=t[1]*n+i[1]*o+s[1]*a,r[2]=t[2]*n+i[2]*o+s[2]*a,r},mergeVertices(e,t,i,s){const r={},n=[],o=[],a=t?[]:null,l=i?[]:null,c=[];let h,d,u,m;const p=1e4;let f,g,y=0;for(f=0,g=e.length;f<g;f+=3)h=e[f],d=e[f+1],u=e[f+2],m=`${Math.round(h*p)}_${Math.round(d*p)}_${Math.round(u*p)}`,void 0===r[m]&&(r[m]=o.length/3,o.push(h),o.push(d),o.push(u),t&&(a.push(t[f]),a.push(t[f+1]),a.push(t[f+2])),i&&(l.push(i[y]),l.push(i[y+1]))),n[f/3]=r[m],y+=2;for(f=0,g=s.length;f<g;f++)c[f]=n[s[f]];const _={positions:o,indices:c};return a&&(_.normals=a),l&&(_.uv=l),_},buildNormals:(()=>{const e=new p(3),t=new p(3),i=new p(3),s=new p(3),r=new p(3),n=new p(3);return(o,a,l)=>{let c,h;const d=new Array(o.length/3);let u,m,p,f,g,y,_;for(c=0,h=a.length;c<h;c+=3){u=a[c],m=a[c+1],p=a[c+2],e[0]=o[3*u],e[1]=o[3*u+1],e[2]=o[3*u+2],t[0]=o[3*m],t[1]=o[3*m+1],t[2]=o[3*m+2],i[0]=o[3*p],i[1]=o[3*p+1],i[2]=o[3*p+2],b.subVec3(t,e,s),b.subVec3(i,e,r);const l=b.vec3();b.normalizeVec3(b.cross3Vec3(s,r,n),l),d[u]||(d[u]=[]),d[m]||(d[m]=[]),d[p]||(d[p]=[]),d[u].push(l),d[m].push(l),d[p].push(l)}for(l=l&&l.length===o.length?l:new Float32Array(o.length),c=0,h=d.length;c<h;c++){f=d[c].length,g=0,y=0,_=0;for(let e=0;e<f;e++)g+=d[c][e][0],y+=d[c][e][1],_+=d[c][e][2];l[3*c]=g/f,l[3*c+1]=y/f,l[3*c+2]=_/f}return l}})(),buildTangents:(()=>{const e=new p(3),t=new p(3),i=new p(3),s=new p(3),r=new p(3),n=new p(3),o=new p(3);return(a,l,c)=>{const h=new Float32Array(a.length);for(let d=0;d<l.length;d+=3){let u=l[d];const m=a.subarray(3*u,3*u+3),p=c.subarray(2*u,2*u+2);u=l[d+1];const f=a.subarray(3*u,3*u+3),g=c.subarray(2*u,2*u+2);u=l[d+2];const y=a.subarray(3*u,3*u+3),_=c.subarray(2*u,2*u+2),w=b.subVec3(f,m,e),v=b.subVec3(y,m,t),M=b.subVec2(g,p,i),x=b.subVec2(_,p,s),A=1/(M[0]*x[1]-M[1]*x[0]),I=b.mulVec3Scalar(b.subVec3(b.mulVec3Scalar(w,x[1],r),b.mulVec3Scalar(v,M[1],n),o),A,n);let P;for(let e=0;e<3;e++)P=3*l[d+e],h[P]+=I[0],h[P+1]+=I[1],h[P+2]+=I[2]}return h}})(),buildPickTriangles(e,t,i){const s=t.length,r=i?new Uint16Array(9*s):new Float32Array(9*s),n=new Uint8Array(12*s);let o,a,l,c,h,d,u=0,m=0,p=0;for(let i=0;i<s;i+=3)d=u>>24&255,h=u>>16&255,c=u>>8&255,l=255&u,a=t[i],o=3*a,r[m++]=e[o],r[m++]=e[o+1],r[m++]=e[o+2],n[p++]=l,n[p++]=c,n[p++]=h,n[p++]=d,a=t[i+1],o=3*a,r[m++]=e[o],r[m++]=e[o+1],r[m++]=e[o+2],n[p++]=l,n[p++]=c,n[p++]=h,n[p++]=d,a=t[i+2],o=3*a,r[m++]=e[o],r[m++]=e[o+1],r[m++]=e[o+2],n[p++]=l,n[p++]=c,n[p++]=h,n[p++]=d,u++;return{positions:r,colors:n}},faceToVertexNormals(e,t,i={}){const s=i.smoothNormalsAngleThreshold||20,r={},n=[],o={};let a,l,c,h,d;const u=1e4;let m,p,f,g,y,_;for(p=0,g=e.length;p<g;p+=3){m=p/3,l=e[p],c=e[p+1],h=e[p+2],d=`${Math.round(l*u)}_${Math.round(c*u)}_${Math.round(h*u)}`,void 0===r[d]?r[d]=[m]:r[d].push(m);const i=b.normalizeVec3([t[p],t[p+1],t[p+2]]);n[m]=i,a=b.vec4([i[0],i[1],i[2],1]),o[m]=a}for(d in r)if(r.hasOwnProperty(d)){const e=r[d],t=e.length;for(p=0;p<t;p++){const i=e[p];for(a=o[i],f=0;f<t;f++){if(p===f)continue;const t=e[f];y=n[i],_=n[t];Math.abs(b.angleVec3(y,_)/b.DEGTORAD)<s&&(a[0]+=_[0],a[1]+=_[1],a[2]+=_[2],a[3]+=1)}}}for(p=0,g=t.length;p<g;p+=3)a=o[p/3],t[p+0]=a[0]/a[3],t[p+1]=a[1]/a[3],t[p+2]=a[2]/a[3]},transformRay:(()=>{const e=new p(4),t=new p(4);return(i,s,r,n,o)=>{e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=1,b.transformVec4(i,e,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],e[0]=r[0],e[1]=r[1],e[2]=r[2],b.transformVec3(i,e,t),b.normalizeVec3(t),o[0]=t[0],o[1]=t[1],o[2]=t[2]}})(),canvasPosToWorldRay:(()=>{const e=new p(16),t=new p(16),i=new p(4),s=new p(4),r=new p(4),n=new p(4);return(o,a,l,c,h,d)=>{const u=b.mulMat4(l,a,e),m=b.inverseMat4(u,t),p=o.width,f=o.height,g=(c[0]-p/2)/(p/2),y=-(c[1]-f/2)/(f/2);i[0]=g,i[1]=y,i[2]=-1,i[3]=1,b.transformVec4(m,i,s),b.mulVec4Scalar(s,1/s[3]),r[0]=g,r[1]=y,r[2]=1,r[3]=1,b.transformVec4(m,r,n),b.mulVec4Scalar(n,1/n[3]),h[0]=n[0],h[1]=n[1],h[2]=n[2],b.subVec3(n,s,d),b.normalizeVec3(d)}})(),canvasPosToLocalRay:(()=>{const e=new p(3),t=new p(3);return(i,s,r,n,o,a,l)=>{b.canvasPosToWorldRay(i,s,r,o,e,t),b.worldRayToLocalRay(n,e,t,a,l)}})(),worldRayToLocalRay:(()=>{const e=new p(16),t=new p(4),i=new p(4);return(s,r,n,o,a)=>{const l=b.inverseMat4(s,e);t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,b.transformVec4(l,t,i),o[0]=i[0],o[1]=i[1],o[2]=i[2],b.transformVec3(l,n,a)}})(),buildKDTree:(()=>{const e=new Float32Array;function t(i,s,r,n){const o=new p(6),a={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:o};let l,c;for(o[0]=o[1]=o[2]=Number.POSITIVE_INFINITY,o[3]=o[4]=o[5]=Number.NEGATIVE_INFINITY,l=0,c=i.length;l<c;++l){var h=3*i[l];for(let e=0;e<3;++e){const t=3*s[h+e];r[t]<o[0]&&(o[0]=r[t]),r[t]>o[3]&&(o[3]=r[t]),r[t+1]<o[1]&&(o[1]=r[t+1]),r[t+1]>o[4]&&(o[4]=r[t+1]),r[t+2]<o[2]&&(o[2]=r[t+2]),r[t+2]>o[5]&&(o[5]=r[t+2])}}if(i.length<20||n>10)return a.triangles=i,a.leaf=!0,a;e[0]=o[3]-o[0],e[1]=o[4]-o[1],e[2]=o[5]-o[2];let d=0;e[1]>e[d]&&(d=1),e[2]>e[d]&&(d=2),a.splitDim=d;const u=(o[d]+o[d+3])/2,m=new Array(i.length);let f=0;const g=new Array(i.length);let y=0;for(l=0,c=i.length;l<c;++l){const e=s[h=3*i[l]],t=3*s[h+1],n=3*s[h+2];r[3*e+d]<=u||r[t+d]<=u||r[n+d]<=u?m[f++]=i[l]:g[y++]=i[l]}return m.length=f,g.length=y,a.left=t(m,s,r,n+1),a.right=t(g,s,r,n+1),a}return(e,i)=>{const s=e.length/3,r=new Array(s);for(let e=0;e<s;++e)r[e]=e;return t(r,e,i,0)}})(),decompressPosition(e,t,i){(i=i||e)[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14]},decompressPositions(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i},decompressUV(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i},octDecodeVec2(e,t){let i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;const r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));const n=Math.sqrt(i*i+s*s+r*r);return t[0]=i/n,t[1]=s/n,t[2]=r/n,t},octDecodeVec2s(e,t){for(let i=0,s=0,r=e.length;i<r;i+=2){let r=e[i+0],n=e[i+1];r=(2*r+1)/255,n=(2*n+1)/255;const o=1-Math.abs(r)-Math.abs(n);o<0&&(r=(1-Math.abs(n))*(r>=0?1:-1),n=(1-Math.abs(r))*(n>=0?1:-1));const a=Math.sqrt(r*r+n*n+o*o);t[s+0]=r/a,t[s+1]=n/a,t[s+2]=o/a,s+=3}return t}};b.buildEdgeIndices=function(){const e=[],t=[],i=[],s=[],r=[];let n=0;const o=new Uint16Array(3),a=new Uint16Array(3),l=new Uint16Array(3),c=b.vec3(),h=b.vec3(),d=b.vec3(),u=b.vec3(),m=b.vec3(),p=b.vec3(),f=b.vec3();return function(g,y,_,w){!function(r,n){const o={};let a,l,c,h;const d=Math.pow(10,4);let u,m,p=0;for(u=0,m=r.length;u<m;u+=3)a=r[u],l=r[u+1],c=r[u+2],h=Math.round(a*d)+"_"+Math.round(l*d)+"_"+Math.round(c*d),void 0===o[h]&&(o[h]=p/3,e[p++]=a,e[p++]=l,e[p++]=c),t[u/3]=o[h];for(u=0,m=n.length;u<m;u++)s[u]=t[n[u]],i[s[u]]=n[u]}(g,y),function(t,i){n=0;for(let g=0,y=t;g<y;g+=3){const t=3*s[g],y=3*s[g+1],_=3*s[g+2];i?(o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],l[0]=e[_],l[1]=e[_+1],l[2]=e[_+2],b.decompressPosition(o,i,c),b.decompressPosition(a,i,h),b.decompressPosition(l,i,d)):(c[0]=e[t],c[1]=e[t+1],c[2]=e[t+2],h[0]=e[y],h[1]=e[y+1],h[2]=e[y+2],d[0]=e[_],d[1]=e[_+1],d[2]=e[_+2]),b.subVec3(d,h,u),b.subVec3(c,h,m),b.cross3Vec3(u,m,p),b.normalizeVec3(p,f);const w=r[n]||(r[n]={normal:b.vec3()});w.normal[0]=f[0],w.normal[1]=f[1],w.normal[2]=f[2],n++}}(y.length,_);const v=[],M=Math.cos(b.DEGTORAD*w),x={};let A,I,P,T,k,D,E,S,B,U,O,C=!1;for(let e=0,t=y.length;e<t;e+=3){const t=e/3;for(let i=0;i<3;i++)A=s[e+i],I=s[e+(i+1)%3],P=Math.min(A,I),T=Math.max(A,I),k=P+","+T,void 0===x[k]?x[k]={index1:P,index2:T,face1:t,face2:void 0}:x[k].face2=t}for(k in x)D=x[k],void 0!==D.face2&&(E=r[D.face1].normal,S=r[D.face2].normal,B=b.dotVec3(E,S),B>M)||(U=i[D.index1],O=i[D.index2],(!C&&U>65535||O>65535)&&(C=!0),v.push(U),v.push(O));return C?new Uint32Array(v):new Uint16Array(v)}}(),b.planeClipsPositions3=function(e,t,i,s=3){for(let r=0,n=i.length;r<n;r+=s){if(f[0]=i[r+0]-e[0],f[1]=i[r+1]-e[1],f[2]=i[r+2]-e[2],f[0]*t[0]+f[1]*t[1]+f[2]*t[2]<0)return!0}return!1};var w=function(){const e=[],t=[],i=[],s=[],r=[];let n=0;const o=new Uint16Array(3),a=new Uint16Array(3),l=new Uint16Array(3),c=b.vec3(),h=b.vec3(),d=b.vec3(),u=b.vec3(),m=b.vec3(),p=b.vec3(),f=b.vec3();return function(g,y,_,w){!function(r,n){const o={};let a,l,c,h;const d=Math.pow(10,4);let u,m,p=0;for(u=0,m=r.length;u<m;u+=3)a=r[u],l=r[u+1],c=r[u+2],h=Math.round(a*d)+"_"+Math.round(l*d)+"_"+Math.round(c*d),void 0===o[h]&&(o[h]=p/3,e[p++]=a,e[p++]=l,e[p++]=c),t[u/3]=o[h];for(u=0,m=n.length;u<m;u++)s[u]=t[n[u]],i[s[u]]=n[u]}(g,y),function(t,i){n=0;for(let g=0,y=t;g<y;g+=3){const t=3*s[g],y=3*s[g+1],_=3*s[g+2];i?(o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],l[0]=e[_],l[1]=e[_+1],l[2]=e[_+2],b.decompressPosition(o,i,c),b.decompressPosition(a,i,h),b.decompressPosition(l,i,d)):(c[0]=e[t],c[1]=e[t+1],c[2]=e[t+2],h[0]=e[y],h[1]=e[y+1],h[2]=e[y+2],d[0]=e[_],d[1]=e[_+1],d[2]=e[_+2]),b.subVec3(d,h,u),b.subVec3(c,h,m),b.cross3Vec3(u,m,p),b.normalizeVec3(p,f);const w=r[n]||(r[n]={normal:b.vec3()});w.normal[0]=f[0],w.normal[1]=f[1],w.normal[2]=f[2],n++}}(y.length,_);const v=[],M=Math.cos(b.DEGTORAD*w),x={};let A,I,P,T,k,D,E,S,B,U,O,C=!1;for(let e=0,t=y.length;e<t;e+=3){const t=e/3;for(let i=0;i<3;i++)A=s[e+i],I=s[e+(i+1)%3],P=Math.min(A,I),T=Math.max(A,I),k=P+","+T,void 0===x[k]?x[k]={index1:P,index2:T,face1:t,face2:void 0}:x[k].face2=t}for(k in x)D=x[k],void 0!==D.face2&&(E=r[D.face1].normal,S=r[D.face2].normal,B=b.dotVec3(E,S),B>M)||(U=i[D.index1],O=i[D.index2],(!C&&U>65535||O>65535)&&(C=!0),v.push(U),v.push(O));return C?new Uint32Array(v):new Uint16Array(v)}}();const v=b.OBB3(),M=b.OBB3(),x=b.OBB3();class A{constructor(e,t,i,s,r,n,o=null,a=0){this.model=e,this.object=null,this.parent=null,this.transform=r,this.textureSet=n,this._matrixDirty=!1,this._matrixUpdateScheduled=!1,this.id=t,this.obb=null,this._aabbLocal=null,this._aabbWorld=b.AABB3(),this._aabbWorldDirty=!1,this.portionId=a,this._color=new Uint8Array([i[0],i[1],i[2],s]),this._colorize=new Uint8Array([i[0],i[1],i[2],s]),this._colorizing=!1,this._transparent=s<255,this.numTriangles=0,this.origin=null,this.entity=null,r&&r._addMesh(this)}_sceneModelDirty(){this._aabbWorldDirty=!0}_transformDirty(){this._matrixDirty||this._matrixUpdateScheduled||(this.model._meshMatrixDirty(this),this._matrixDirty=!0,this._matrixUpdateScheduled=!0),this._aabbWorldDirty=!0,this.entity&&this.entity._transformDirty()}_updateMatrix(){this._matrixDirty=!1,this._matrixUpdateScheduled=!1}_finalize(e){}_finalize2(){}_setVisible(e){}_setColor(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2]}_setColorize(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._colorizing=!0):this._colorizing=!1}_setOpacity(e,t){const i=e<255;this._transparent,this._color[3]=e,this._colorize[3]=e,this._transparent=i}_setOffset(e){}_setHighlighted(e){}_setXRayed(e){}_setSelected(e){}_setEdges(e){}_setClippable(e){}_setCollidable(e){}_setPickable(e){}_setCulled(e){}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}precisionRayPickSurface(e,t,i,s){}canPickWorldPos(){return!0}drawPickDepths(e){this.model.drawPickDepths(e)}drawPickNormals(e){this.model.drawPickNormals(e)}delegatePickedEntity(){return this.parent}getEachVertex(e){}set aabb(e){this._aabbLocal=e}get aabb(){if(this._aabbWorldDirty){if(b.AABB3ToOBB3(this._aabbLocal,v),this.transform?(b.transformOBB3(this.transform.worldMatrix,v,M),b.transformOBB3(this.model.worldMatrix,M,x),b.OBB3ToAABB3(x,this._aabbWorld)):(b.transformOBB3(this.model.worldMatrix,v,M),b.OBB3ToAABB3(M,this._aabbWorld)),this.origin){const e=this.origin;this._aabbWorld[0]+=e[0],this._aabbWorld[1]+=e[1],this._aabbWorld[2]+=e[2],this._aabbWorld[3]+=e[0],this._aabbWorld[4]+=e[1],this._aabbWorld[5]+=e[2]}this._aabbWorldDirty=!1}return this._aabbWorld}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}const I=new class{constructor(){this._uint8Arrays={},this._float32Arrays={}}_clear(){this._uint8Arrays={},this._float32Arrays={}}getUInt8Array(e){let t=this._uint8Arrays[e];return t||(t=new Uint8Array(e),this._uint8Arrays[e]=t),t}getFloat32Array(e){let t=this._float32Arrays[e];return t||(t=new Float32Array(e),this._float32Arrays[e]=t),t}};let P=0;const T=1,k=4,D=8,E=16,S=32,B=256,U=512,O=1024,C=2048;class L{constructor(){this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}reset(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}const z=b.vec3();function N(e,t,i,s=1e3){const r=b.getPositionsCenter(e,z),n=Math.round(r[0]/s)*s,o=Math.round(r[1]/s)*s,a=Math.round(r[2]/s)*s;i[0]=n,i[1]=o,i[2]=a;const l=0!==i[0]||0!==i[1]||0!==i[2];if(l)for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]-n,t[i+1]=e[i+1]-o,t[i+2]=e[i+2]-a;return l}class R{constructor(e){this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.normalsTexture=e.normalsTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture}destroy(){}}const j=1e3,V=1001,F=1002,G=1006,$=1008,q=3e3,Z=b.mat4(),X=b.mat4();function W(e,t,i){const s=e.length,r=new Uint16Array(s),n=t[0],o=t[1],a=t[2],l=t[3]-n,c=t[4]-o,h=t[5]-a,d=65525,u=d/l,m=d/c,p=d/h,f=e=>e>=0?e:0;for(let t=0;t<s;t+=3)r[t+0]=Math.floor(f(e[t+0]-n)*u),r[t+1]=Math.floor(f(e[t+1]-o)*m),r[t+2]=Math.floor(f(e[t+2]-a)*p);return b.identityMat4(Z),b.translationMat4v(t,Z),b.identityMat4(X),b.scalingMat4v([l/d,c/d,h/d],X),b.mulMat4(Z,X,i),r}function Q(e,t){const i=e[0],s=e[1],r=e[2],n=e[3]-i,o=e[4]-s,a=e[5]-r,l=65525;return b.identityMat4(Z),b.translationMat4v(e,Z),b.identityMat4(X),b.scalingMat4v([n/l,o/l,a/l],X),b.mulMat4(Z,X,t),t}
/**
     * @author https://github.com/tmarti, with support from https://tribia.com/
     * @license MIT
     *
     * This file takes a geometry given by { positionsCompressed, indices }, and returns
     * equivalent { positionsCompressed, indices } arrays but which only contain unique
     * positionsCompressed.
     *
     * The time is O(N logN) with the number of positionsCompressed due to a pre-sorting
     * step, but is much more GC-friendly and actually faster than the classic O(N)
     * approach based in keeping a hash-based LUT to identify unique positionsCompressed.
     */let H=null;function Y(e,t){let i;for(let s=0;s<3;s++)if(0!=(i=H[3*e+s]-H[3*t+s]))return i;return 0}let J=null;function K(e){const t=e.positionsCompressed,i=e.indices,s=e.edgeIndices;!function(e){if(!(null!==J&&J.length>=e)){J=new Uint32Array(e);for(let t=0;t<e;t++)J[t]=t}}(t.length/3);const r=J.slice(0,t.length/3),n=J.slice(0,t.length/3);H=t,r.sort(Y);let o=0;n[r[0]]=0;for(let e=1,t=r.length;e<t;e++)0!==Y(r[e],r[e-1])&&o++,n[r[e]]=o;const a=new Uint16Array(3*(o+1));o=0,a[3*o+0]=t[3*r[0]+0],a[3*o+1]=t[3*r[0]+1],a[3*o+2]=t[3*r[0]+2];for(let e=1,i=r.length;e<i;e++)0!==Y(r[e],r[e-1])&&(o++,a[3*o+0]=t[3*r[e]+0],a[3*o+1]=t[3*r[e]+1],a[3*o+2]=t[3*r[e]+2]),n[r[e]]=o;H=null;const l=new Uint32Array(i.length);for(let e=0,t=i.length;e<t;e++)l[e]=n[i[e]];const c=new Uint32Array(s.length);for(let e=0,t=s.length;e<t;e++)c[e]=n[s[e]];return[a,l,c]}
/**
     * @author https://github.com/tmarti, with support from https://tribia.com/
     * @license MIT
     **/const ee=8;let te=null;function ie(e,t){const i=3*e,s=3*t;let r,n,o,a,l,c;const h=Math.min(r=te[i],n=te[i+1],o=te[i+2]),d=Math.min(a=te[s],l=te[s+1],c=te[s+2]);if(h!==d)return h-d;const u=Math.max(r,n,o),m=Math.max(a,l,c);return u!==m?u-m:0}let se=null;function re(e,t){let i=se[2*e]-se[2*t];return 0!==i?i:se[2*e+1]-se[2*t+1]}function ne(e,t,i=!1){const s=e.positionsCompressed||[],r=function(e,t){const i=new Int32Array(e.length/3);for(let e=0,t=i.length;e<t;e++)i[e]=e;te=new Int32Array(e.length);for(let i=0,s=e.length;i<s;i++)te[i]=e[i]>>t;i.sort(ie);const s=new Int32Array(e.length);for(let t=0,r=i.length;t<r;t++)s[3*t+0]=e[3*i[t]+0],s[3*t+1]=e[3*i[t]+1],s[3*t+2]=e[3*i[t]+2];return s}(e.indices||[],t),n=function(e){if(0===(e||[]).length)return[];let t=new Int32Array(e.length/2);for(let e=0,i=t.length;e<i;e++)t[e]=e;for(let t=0,i=e.length;t<i;t+=2)if(e[t]>e[t+1]){let i=e[t];e[t]=e[t+1],e[t+1]=i}se=new Int32Array(e),t.sort(re);const i=new Int32Array(e.length);for(let s=0,r=t.length;s<r;s++)i[2*s+0]=e[2*t[s]+0],i[2*s+1]=e[2*t[s]+1];return i}(e.edgeIndices||[]);function o(e,t){if(e>t){let i=e;e=t,t=i}let i=0,s=(n.length>>1)-1;for(;i<=s;){const a=s+i>>1,l=(r=n[2*a],o=n[2*a+1],r!==e?e-r:o!==t?t-o:0);if(l>0)i=a+1;else{if(!(l<0))return a;s=a-1}}var r,o;return-i-1}const a=new Int32Array(n.length/2);a.fill(0);const l=s.length/3;if(l>(1<<t)*ee)return[e];const c=new Int32Array(l);c.fill(-1);const h=[];function d(){c.fill(-1);const e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:h.length};return h.push(e),e}let u=d();for(let t=0,i=r.length;t<i;t+=3){let i=0;const l=r[t],h=r[t+1],m=r[t+2];if(-1===c[l]&&i++,-1===c[h]&&i++,-1===c[m]&&i++,i+u.numPositions>u.maxNumPositions&&(u=d()),u.bucketNumber>ee)return[e];let p;-1===c[l]&&(c[l]=u.numPositions++,u.positionsCompressed.push(s[3*l]),u.positionsCompressed.push(s[3*l+1]),u.positionsCompressed.push(s[3*l+2])),-1===c[h]&&(c[h]=u.numPositions++,u.positionsCompressed.push(s[3*h]),u.positionsCompressed.push(s[3*h+1]),u.positionsCompressed.push(s[3*h+2])),-1===c[m]&&(c[m]=u.numPositions++,u.positionsCompressed.push(s[3*m]),u.positionsCompressed.push(s[3*m+1]),u.positionsCompressed.push(s[3*m+2])),u.indices.push(c[l]),u.indices.push(c[h]),u.indices.push(c[m]),(p=o(l,h))>=0&&0===a[p]&&(a[p]=1,u.edgeIndices.push(c[n[2*p]]),u.edgeIndices.push(c[n[2*p+1]])),(p=o(l,m))>=0&&0===a[p]&&(a[p]=1,u.edgeIndices.push(c[n[2*p]]),u.edgeIndices.push(c[n[2*p+1]])),(p=o(h,m))>=0&&0===a[p]&&(a[p]=1,u.edgeIndices.push(c[n[2*p]]),u.edgeIndices.push(c[n[2*p+1]]))}const m=t/8*2,p=t/8,f=2*s.length+(r.length+n.length)*m;let g=0,y=-s.length/3;return h.forEach((e=>{g+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*p,y+=e.positionsCompressed.length/3})),g>f?[e]:(i&&function(e,t){const i={};let s=0;e.forEach((e=>{const t=e.indices,r=e.edgeIndices,n=e.positionsCompressed;for(let e=0,s=t.length;e<s;e+=3){const s=n[3*t[e]]+"_"+n[3*t[e]+1]+"_"+n[3*t[e]+2]+"/"+n[3*t[e+1]]+"_"+n[3*t[e+1]+1]+"_"+n[3*t[e+1]+2]+"/"+n[3*t[e+2]]+"_"+n[3*t[e+2]+1]+"_"+n[3*t[e+2]+2];i[s]=!0}s+=e.edgeIndices.length/2;for(let e=0,t=r.length;e<t;e+=2)n[3*r[e]],n[3*r[e]+1],n[3*r[e]+2],n[3*r[e+1]],n[3*r[e+1]+1],n[3*r[e+1]+2]}));{const e=t.indices;t.edgeIndices;const s=t.positionsCompressed;for(let t=0,r=e.length;t<r;t+=3){const r=s[3*e[t]]+"_"+s[3*e[t]+1]+"_"+s[3*e[t]+2]+"/"+s[3*e[t+1]]+"_"+s[3*e[t+1]+1]+"_"+s[3*e[t+1]+2]+"/"+s[3*e[t+2]]+"_"+s[3*e[t+2]+1]+"_"+s[3*e[t+2]+2];if(!(r in i))throw console.log("Not found "+r),"Ohhhh!"}}}(h,e),h)}const oe=new Float32Array([0,0,0]),ae=new Uint16Array([0,0,0]);b.OBB3();class le{constructor(e,t,i,s,r,n){this._isObject=t,this.model=e,this.meshes=s,this._numPrimitives=0;for(let e=0,t=this.meshes.length;e<t;e++){const t=this.meshes[e];t.parent=this,t.entity=this,this._numPrimitives+=t.numPrimitives}this.id=i,this.originalSystemId=b.unglobalizeObjectId(e.id,i),this._flags=r,this._aabb=b.AABB3(),this._aabbDirty=!0,this._offset=b.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._lodCullable=!!n,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1}_transformDirty(){this._aabbDirty=!0,this.model._transformDirty()}_sceneModelDirty(){this._aabbDirty=!0;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._sceneModelDirty()}get aabb(){if(this._aabbDirty){b.collapseAABB3(this._aabb);for(let e=0,t=this.meshes.length;e<t;e++)b.expandAABB3(this._aabb,this.meshes[e].aabb);this._aabbDirty=!1}return this._aabb}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get numPrimitives(){return this._numPrimitives}get numTriangles(){return this._numPrimitives}get visible(){return this._getFlag(T)}set visible(e){if(!!(this._flags&T)!==e){this._flags=e?this._flags|T:this._flags&~T;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setVisible(this._flags);this.model.glRedraw()}}get highlighted(){return this._getFlag(U)}set highlighted(e){if(!!(this._flags&U)!==e){this._flags=e?this._flags|U:this._flags&~U;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setHighlighted(this._flags);this.model.glRedraw()}}get xrayed(){return this._getFlag(B)}set xrayed(e){if(!!(this._flags&B)!==e){this._flags=e?this._flags|B:this._flags&~B;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setXRayed(this._flags);this.model.glRedraw()}}get selected(){return this._getFlag(O)}set selected(e){if(!!(this._flags&O)!==e){this._flags=e?this._flags|O:this._flags&~O;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setSelected(this._flags);this.model.glRedraw()}}get edges(){return this._getFlag(C)}set edges(e){if(!!(this._flags&C)!==e){this._flags=e?this._flags|C:this._flags&~C;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}get culledVFC(){return!!this._culledVFC}set culledVFC(e){this._culledVFC=e,this._setCulled()}get culledLOD(){return!!this._culledLOD}set culledLOD(e){this._culledLOD=e,this._setCulled()}get culled(){return!!this._culled}set culled(e){this._culled=e,this._setCulled()}_setCulled(){let e=!!this._culled||!(!this._culledLOD||!this._lodCullable)||!!this._culledVFC;if(!!(this._flags&k)!==e){this._flags=e?this._flags|k:this._flags&~k;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(E)}set clippable(e){if(!!(this._flags&E)!==e){this._flags=e?this._flags|E:this._flags&~E;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}get collidable(){return this._getFlag(S)}set collidable(e){if(!!(this._flags&S)!==e){this._flags=e?this._flags|S:this._flags&~S;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCollidable(this._flags)}}get pickable(){return this._getFlag(D)}set pickable(e){if(!!(this._flags&D)!==e){this._flags=e?this._flags|D:this._flags&~D;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setPickable(this._flags)}}get colorize(){if(0===this.meshes.length)return null;const e=this.meshes[0]._colorize;return oe[0]=e[0]/255,oe[1]=e[1]/255,oe[2]=e[2]/255,oe}set colorize(e){if(e){ae[0]=Math.floor(255*e[0]),ae[1]=Math.floor(255*e[1]),ae[2]=Math.floor(255*e[2]);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(ae)}else for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(null);if(this._isObject){const t=!!e;this._colorizeUpdated=t}this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set opacity(e){if(0===this.meshes.length)return;const t=null!=e,i=this.meshes[0]._colorize[3];let s=255;if(t){if(e<0?e=0:e>1&&(e=1),s=Math.floor(255*e),i===s)return}else if(s=255,i===s)return;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOpacity(s,this._flags);this._isObject&&(this._opacityUpdated=t),this.model.glRedraw()}get offset(){return this._offset}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOffset(this._offset);this._aabbDirty=!0,this.model._aabbDirty=!0,this.model.glRedraw()}get saoEnabled(){return this.model.saoEnabled}getEachVertex(e){for(let t=0,i=this.meshes.length;t<i;t++)this.meshes[t].getEachVertex(e)}_getFlag(e){return!!(this._flags&e)}_finalize(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize(this._flags)}_finalize2(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}_destroy(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._destroy()}}const ce=function(){const e=b.mat4(),t=b.mat4();return function(i,s){s=s||b.mat4();const r=i[0],n=i[1],o=i[2],a=i[3]-r,l=i[4]-n,c=i[5]-o,h=65535;return b.identityMat4(e),b.translationMat4v(i,e),b.identityMat4(t),b.scalingMat4v([a/h,l/h,c/h],t),b.mulMat4(e,t,s),s}}();var he=function(){const e=b.mat4(),t=b.mat4();return function(i,s,r){const n=new Uint16Array(i.length),o=new Float32Array([r[0]!==s[0]?65535/(r[0]-s[0]):0,r[1]!==s[1]?65535/(r[1]-s[1]):0,r[2]!==s[2]?65535/(r[2]-s[2]):0]);let a;for(a=0;a<i.length;a+=3)n[a+0]=Math.max(0,Math.min(65535,Math.floor((i[a+0]-s[0])*o[0]))),n[a+1]=Math.max(0,Math.min(65535,Math.floor((i[a+1]-s[1])*o[1]))),n[a+2]=Math.max(0,Math.min(65535,Math.floor((i[a+2]-s[2])*o[2])));b.identityMat4(e),b.translationMat4v(s,e),b.identityMat4(t),b.scalingMat4v([(r[0]-s[0])/65535,(r[1]-s[1])/65535,(r[2]-s[2])/65535],t);return{quantized:n,decodeMatrix:b.mulMat4(e,t,b.identityMat4())}}}();var de=function(){const e=b.mat3(),t=b.mat3();return function(i,s,r){const n=new Uint16Array(i.length),o=new Float32Array([65535/(r[0]-s[0]),65535/(r[1]-s[1])]);let a;for(a=0;a<i.length;a+=2)n[a+0]=Math.max(0,Math.min(65535,Math.floor((i[a+0]-s[0])*o[0]))),n[a+1]=Math.max(0,Math.min(65535,Math.floor((i[a+1]-s[1])*o[1])));b.identityMat3(e),b.translationMat3v(s,e),b.identityMat3(t),b.scalingMat3v([(r[0]-s[0])/65535,(r[1]-s[1])/65535],t);return{quantized:n,decodeMatrix:b.mulMat3(e,t,b.identityMat3())}}}();function ue(e,t,i,s){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),n=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(n))*(r>=0?1:-1),t=(1-Math.abs(r))*(n>=0?1:-1);r=e,n=t}return new Int8Array([Math[i](127.5*r+(r<0?-1:0)),Math[s](127.5*n+(n<0?-1:0))])}function me(e){let t=e[0],i=e[1];t/=t<0?127:128,i/=i<0?127:128;const s=1-Math.abs(t)-Math.abs(i);s<0&&(t=(1-Math.abs(i))*(t>=0?1:-1),i=(1-Math.abs(t))*(i>=0?1:-1));const r=Math.sqrt(t*t+i*i+s*s);return[t/r,i/r,s/r]}function pe(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}const fe={getPositionsBounds:function(e){const t=new Float32Array(3),i=new Float32Array(3);let s,r;for(s=0;s<3;s++)t[s]=Number.MAX_VALUE,i[s]=-Number.MAX_VALUE;for(s=0;s<e.length;s+=3)for(r=0;r<3;r++)t[r]=Math.min(t[r],e[s+r]),i[r]=Math.max(i[r],e[s+r]);return{min:t,max:i}},createPositionsDecodeMatrix:ce,compressPositions:he,compressPosition:function(e,t,i){const s=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);i[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*s[0]))),i[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*s[1]))),i[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*s[2])))},decompressPositions:function(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i},decompressPosition:function(e,t,i){return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i},decompressAABB:function(e,t,i=e){return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},getUVBounds:function(e){const t=new Float32Array(2),i=new Float32Array(2);let s,r;for(s=0;s<2;s++)t[s]=Number.MAX_VALUE,i[s]=-Number.MAX_VALUE;for(s=0;s<e.length;s+=2)for(r=0;r<2;r++)t[r]=Math.min(t[r],e[s+r]),i[r]=Math.max(i[r],e[s+r]);return{min:t,max:i}},compressUVs:de,decompressUVs:function(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i},decompressUV:function(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},compressNormals:function(e){const t=new Int8Array(e.length);let i,s,r,n,o;for(let a=0;a<e.length;a+=3)r=i=ue(e,a,"floor","floor"),s=me(i),n=o=pe(e,a,s),i=ue(e,a,"ceil","floor"),s=me(i),n=pe(e,a,s),n>o&&(r=i,o=n),i=ue(e,a,"floor","ceil"),s=me(i),n=pe(e,a,s),n>o&&(r=i,o=n),i=ue(e,a,"ceil","ceil"),s=me(i),n=pe(e,a,s),n>o&&(r=i,o=n),t[a]=r[0],t[a+1]=r[1];return t},decompressNormals:function(e,t){for(let i=0,s=0,r=e.length;i<r;i+=2){let r=e[i+0],n=e[i+1];r=(2*r+1)/255,n=(2*n+1)/255;const o=1-Math.abs(r)-Math.abs(n);o<0&&(r=(1-Math.abs(n))*(r>=0?1:-1),n=(1-Math.abs(r))*(n>=0?1:-1));const a=Math.sqrt(r*r+n*n+o*o);t[s+0]=r/a,t[s+1]=n/a,t[s+2]=o/a,s+=3}return t},decompressNormal:function(e,t){let i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;const r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));const n=Math.sqrt(i*i+s*s+r*r);return t[0]=i/n,t[1]=s/n,t[2]=r/n,t}};b.vec3(),b.vec3(),b.mat4();const ge=b.vec4(4),ye=b.vec4(),_e=b.vec4(),be=b.vec3([1,0,0]),we=b.vec3([0,1,0]),ve=b.vec3([0,0,1]);b.vec3(3),b.vec3(3);const Me=b.identityMat4();class xe{constructor(e){this._model=e.model,this.id=e.id,this._parentTransform=e.parent,this._childTransforms=[],this._meshes=[],this._scale=new Float32Array([1,1,1]),this._quaternion=b.identityQuaternion(new Float32Array(4)),this._rotation=new Float32Array(3),this._position=new Float32Array(3),this._localMatrix=b.identityMat4(new Float32Array(16)),this._worldMatrix=b.identityMat4(new Float32Array(16)),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,e.matrix?this.matrix=e.matrix:(this.scale=e.scale,this.position=e.position,e.quaternion||(this.rotation=e.rotation)),e.parent&&e.parent._addChildTransform(this)}_addChildTransform(e){this._childTransforms.push(e),e._parentTransform=this,e._setWorldMatrixDirty(),e._setAABBDirty()}_addMesh(e){this._meshes.push(e),e.transform=this}get parentTransform(){return this._parentTransform}get meshes(){return this._meshes}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._model.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),b.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._model.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),b.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._model.glRedraw()}get quaternion(){return this._quaternion}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._model.glRedraw()}get scale(){return this._scale}set matrix(e){this._localMatrix||(this._localMatrix=b.identityMat4()),this._localMatrix.set(e||Me),b.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._transformDirty(),this._model.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=b.identityMat4()),b.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(e,t){return ge[0]=e[0],ge[1]=e[1],ge[2]=e[2],ge[3]=t*b.DEGTORAD,b.angleAxisToQuaternion(ge,ye),b.mulQuaternions(this.quaternion,ye,_e),this.quaternion=_e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}rotateOnWorldAxis(e,t){return ge[0]=e[0],ge[1]=e[1],ge[2]=e[2],ge[3]=t*b.DEGTORAD,b.angleAxisToQuaternion(ge,ye),b.mulQuaternions(ye,this.quaternion,ye),this}rotateX(e){return this.rotate(be,e)}rotateY(e){return this.rotate(we,e)}rotateZ(e){return this.rotate(ve,e)}translate(e){return this._position[0]+=e[0],this._position[1]+=e[1],this._position[2]+=e[2],this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateX(e){return this._position[0]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateY(e){return this._position[1]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateZ(e){return this._position[2]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._transformDirty()}_transformDirty(){this._worldMatrixDirty=!0;for(let e=0,t=this._childTransforms.length;e<t;e++){const t=this._childTransforms[e];if(t._transformDirty(),t._meshes&&t._meshes.length>0){const e=t._meshes;for(let t=0,i=e.length;t<i;t++)e[t]._transformDirty()}}if(this._meshes&&this._meshes.length>0){const e=this._meshes;for(let t=0,i=e.length;t<i;t++)e[t]._transformDirty()}}_buildWorldMatrix(){const e=this.matrix;if(this._parentTransform)b.mulMat4(this._parentTransform.worldMatrix,e,this._worldMatrix);else for(let t=0,i=e.length;t<i;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(e){if(e._aabbDirty=!0,e._childTransforms)for(let t=0,i=e._childTransforms.length;t<i;t++)this._setSubtreeAABBsDirty(e._childTransforms[t])}}const Ae=b.vec3(),Ie=b.OBB3(),Pe=b.vec3([1,1,1]),Te=b.vec3([0,0,0]),ke=b.vec3([0,0,0]),De=b.identityQuaternion(),Ee=b.identityMat4(),Se=new Uint8Array([255,255,255]);class Be extends u{constructor(e={}){super(e),this._dtxEnabled=!1,this._enableVertexWelding=!1,this._enableIndexBucketing=!1,this._vboBatchingLayerScratchMemory=(P++,I),this._maxGeometryBatchSize=e.maxGeometryBatchSize,this._aabb=b.collapseAABB3(),this._aabbDirty=!0,this._quantizationRanges={},this._vboInstancingLayers={},this._vboBatchingLayers={},this._dtxLayers={},this._meshList=[],this.layerList=[],this._entityList=[],this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={},this._transforms={},this._meshes={},this._unusedMeshes={},this._entities={},this.renderFlags=new L,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._numLines=0,this._numPoints=0,this._edgeThreshold=e.edgeThreshold||10,this._origin=b.vec3(e.origin||[0,0,0]),this._position=b.vec3(e.position||[0,0,0]),this._rotation=b.vec3(e.rotation||[0,0,0]),this._quaternion=b.vec4(e.quaternion||[0,0,0,1]),this._conjugateQuaternion=b.vec4(e.quaternion||[0,0,0,1]),e.rotation&&b.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=b.vec3(e.scale||[1,1,1]),this._worldRotationMatrix=b.mat4(),this._worldRotationMatrixConjugate=b.mat4(),this._matrix=b.mat4(),this._matrixDirty=!0,this._rebuildMatrices(),this._worldNormalMatrix=b.mat4(),b.inverseMat4(this._matrix,this._worldNormalMatrix),b.transposeMat4(this._worldNormalMatrix),(e.matrix||e.position||e.rotation||e.scale||e.quaternion)&&(this._viewMatrix=b.mat4(),this._viewNormalMatrix=b.mat4(),this._viewMatrixDirty=!0,this._matrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==e.saoEnabled,this._pbrEnabled=!1!==e.pbrEnabled,this._colorTextureEnabled=!1!==e.colorTextureEnabled,this._isModel=e.isModel,this._meshesWithDirtyMatrices=[],this._numMeshesWithDirtyMatrices=0,this.visible=e.visible,this.culled=e.culled,this.pickable=e.pickable,this.clippable=e.clippable,this.collidable=e.collidable,this.castsShadow=e.castsShadow,this.receivesShadow=e.receivesShadow,this.xrayed=e.xrayed,this.highlighted=e.highlighted,this.selected=e.selected,this.edges=e.edges,this.colorize=e.colorize,this.opacity=e.opacity,this.backfaces=e.backfaces}_meshMatrixDirty(e){this._meshesWithDirtyMatrices[this._numMeshesWithDirtyMatrices++]=e}get isPerformanceModel(){return!0}get transforms(){return this._transforms}get textures(){return this._textures}get textureSets(){return this._textureSets}get meshes(){return this._meshes}get objects(){return this._entities}get origin(){return this._origin}set position(e){this._position.set(e||[0,0,0]),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),b.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),b.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(e){}get scale(){return this._scale}set matrix(e){this._matrix.set(e||Ee),b.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrix),b.conjugateQuaternion(this._quaternion,this._conjugateQuaternion),b.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrixConjugate),this._matrix.set(this._worldRotationMatrix),b.translateMat4v(this._position,this._matrix),this._matrixDirty=!1,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get matrix(){return this._matrixDirty&&this._rebuildMatrices(),this._matrix}get rotationMatrix(){return this._matrixDirty&&this._rebuildMatrices(),this._worldRotationMatrix}_rebuildMatrices(){this._matrixDirty&&(b.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrix),b.conjugateQuaternion(this._quaternion,this._conjugateQuaternion),b.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrixConjugate),this._matrix.set(this._worldRotationMatrix),b.translateMat4v(this._position,this._matrix),this._matrixDirty=!1)}get rotationMatrixConjugate(){return this._matrixDirty&&this._rebuildMatrices(),this._worldRotationMatrixConjugate}_setWorldMatrixDirty(){this._matrixDirty=!0,this._aabbDirty=!0}_transformDirty(){this._matrixDirty=!0,this._aabbDirty=!0}_sceneModelDirty(){this._aabbDirty=!0,this._matrixDirty=!0;for(let e=0,t=this._entityList.length;e<t;e++)this._entityList[e]._sceneModelDirty()}get worldMatrix(){return this.matrix}get worldNormalMatrix(){return this._worldNormalMatrix}get viewMatrix(){return this._matrixDirty&&(this._rebuildMatrices(),this._viewMatrixDirty=!0),this._viewMatrixDirty&&(this._viewMatrixDirty=!1),this._viewMatrix}get viewNormalMatrix(){return this._matrixDirty&&(this._rebuildMatrices(),this._viewMatrixDirty=!0),this._viewMatrixDirty&&(this._viewMatrixDirty=!1),b.inverseMat4(this._viewMatrix,this._viewNormalMatrix),b.transposeMat4(this._viewNormalMatrix),this._viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(e){e=!!e,this._backfaces=e,this.glRedraw()}get entityList(){return this._entityList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){if(this._aabbDirty){b.collapseAABB3(this._aabb);for(let e=0,t=this._entityList.length;e<t;e++)b.expandAABB3(this._aabb,this._entityList[e].aabb);this._aabbDirty=!1}return this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return this._numLines}get numPoints(){return this._numPoints}get visible(){return this.numVisibleLayerPortions>0}set visible(e){e=!1!==e,this._visible=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].visible=e;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].xrayed=e;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].highlighted=e;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(e){e=!!e,this._selected=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].selected=e;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(e){e=!!e,this._edges=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].edges=e;this.glRedraw()}get culled(){return this._culled}set culled(e){e=!!e,this._culled=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].culled=e;this.glRedraw()}get clippable(){return this._clippable}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].clippable=e;this.glRedraw()}get collidable(){return this._collidable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].collidable=e}get pickable(){return this.numPickableLayerPortions>0}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].pickable=e}get colorize(){return this._colorize}set colorize(e){this._colorize=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].colorize=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;for(let t=0,i=this._entityList.length;t<i;t++)this._entityList[t].opacity=e}get castsShadow(){return this._castsShadow}set castsShadow(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get colorTextureEnabled(){return this._colorTextureEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}getPickViewMatrix(e){return this._viewMatrix?this._viewMatrix:e}createQuantizationRange(e){void 0!==e.id&&null!==e.id?e.aabb?this.error("[createQuantizationRange] Config missing: aabb"):this._quantizationRanges[e.id]?this.error("[createQuantizationRange] QuantizationRange already created: "+e.id):this._quantizationRanges[e.id]={id:e.id,aabb:e.aabb,matrix:Q(e.aabb,b.mat4())}:this.error("[createQuantizationRange] Config missing: id")}createGeometry(e){if(void 0!==e.id&&null!==e.id)if(this._geometries[e.id])this.error("[createGeometry] Geometry already created: "+e.id);else if(void 0!==e.primitive&&null!==e.primitive||(e.primitive="triangles"),"points"===e.primitive||"lines"===e.primitive||"triangles"===e.primitive||"solid"===e.primitive||"surface"===e.primitive){if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("[createGeometry] Param expected: `positions`,  `positionsCompressed' or 'buckets"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("[createGeometry] Param expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.positionsDecodeMatrix&&e.positionsDecodeBoundary)return this.error("[createGeometry] Only one of these params expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("[createGeometry] Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(!(e.buckets||e.indices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive)){const t=(e.positions||e.positionsCompressed).length/3;e.indices=this._createDefaultIndices(t)}if(!e.buckets&&!e.indices&&"points"!==e.primitive)return this.error(`[createGeometry] Param expected: indices (required for '${e.primitive}' primitive type)`),null;if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=Q(e.positionsDecodeBoundary,b.mat4())),e.positions){const t=b.collapseAABB3();e.positionsDecodeMatrix=b.mat4(),b.expandAABB3Points3(t,e.positions),e.positionsCompressed=W(e.positions,t,e.positionsDecodeMatrix),e.aabb=t}else if(e.positionsCompressed){const t=b.collapseAABB3();e.positionsDecodeMatrix=new Float64Array(e.positionsDecodeMatrix),e.positionsCompressed=new Uint16Array(e.positionsCompressed),b.expandAABB3Points3(t,e.positionsCompressed),fe.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}else if(e.buckets){const t=b.collapseAABB3();this._dtxBuckets[e.id]=e.buckets;for(let i=0,s=e.buckets.length;i<s;i++){const s=e.buckets[i];s.positions?b.expandAABB3Points3(t,s.positions):s.positionsCompressed&&b.expandAABB3Points3(t,s.positionsCompressed)}e.positionsDecodeMatrix&&fe.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}if(e.colorsCompressed&&e.colorsCompressed.length>0)e.colorsCompressed=new Uint8Array(e.colorsCompressed);else if(e.colors&&e.colors.length>0){const t=e.colors,i=new Uint8Array(t.length);for(let e=0,s=t.length;e<s;e++)i[e]=255*t[e];e.colorsCompressed=i}if(e.buckets||e.edgeIndices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.positions?e.edgeIndices=w(e.positions,e.indices,null,5):e.edgeIndices=w(e.positionsCompressed,e.indices,e.positionsDecodeMatrix,2)),e.uv){const t=fe.getUVBounds(e.uv),i=fe.compressUVs(e.uv,t.min,t.max);e.uvCompressed=i.quantized,e.uvDecodeMatrix=i.decodeMatrix}else e.uvCompressed&&(e.uvCompressed=new Uint16Array(e.uvCompressed),e.uvDecodeMatrix=new Float64Array(e.uvDecodeMatrix));e.normals&&(e.normals=null),this._geometries[e.id]=e,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}else this.error(`[createGeometry] Unsupported value for 'primitive': '${e.primitive}' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`);else this.error("[createGeometry] Config missing: id")}createTexture(e){const t=e.id;if(null==t)return void this.error("[createTexture] Config missing: id");if(this._textures[t])return void this.error("[createTexture] Texture already created: "+t);if(!e.src&&!e.image&&!e.buffers)return this.error("[createTexture] Param expected: `src`, `image' or 'buffers'"),null;let i=e.minFilter||$;i!==G&&1007!==i&&i!==$&&1005!==i&&1004!==i&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),i=$);let s=e.magFilter||G;s!==G&&1003!==s&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),s=G);let r=e.wrapS||j;r!==V&&r!==F&&r!==j&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),r=j);let n=e.wrapT||j;n!==V&&n!==F&&n!==j&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),n=j);let o=e.wrapR||j;o!==V&&o!==F&&o!==j&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),o=j);let a=e.encoding||q;a!==q&&3001!==a&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),a=q),this._textures[t]=e}createTextureSet(e){const t=e.id;if(null==t)return void this.error("[createTextureSet] Config missing: id");if(this._textureSets[t])return void this.error(`[createTextureSet] Texture set already created: ${t}`);let i,s,r,n,o;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(i=this._textures[e.colorTextureId],!i)return void this.error(`[createTextureSet] Texture not found: ${e.colorTextureId} - ensure that you create it first with createTexture()`)}else i=this._textures.defaultColorTexture;if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(s=this._textures[e.metallicRoughnessTextureId],!s)return void this.error(`[createTextureSet] Texture not found: ${e.metallicRoughnessTextureId} - ensure that you create it first with createTexture()`)}else s=this._textures.defaultMetalRoughTexture;if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(r=this._textures[e.normalsTextureId],!r)return void this.error(`[createTextureSet] Texture not found: ${e.normalsTextureId} - ensure that you create it first with createTexture()`)}else r=this._textures.defaultNormalsTexture;if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(n=this._textures[e.emissiveTextureId],!n)return void this.error(`[createTextureSet] Texture not found: ${e.emissiveTextureId} - ensure that you create it first with createTexture()`)}else n=this._textures.defaultEmissiveTexture;if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(o=this._textures[e.occlusionTextureId],!o)return void this.error(`[createTextureSet] Texture not found: ${e.occlusionTextureId} - ensure that you create it first with createTexture()`)}else o=this._textures.defaultOcclusionTexture;const a=new R({id:t,model:this,colorTexture:i,metallicRoughnessTexture:s,normalsTexture:r,emissiveTexture:n,occlusionTexture:o});return this._textureSets[t]=a,a}createTransform(e){if(void 0===e.id||null===e.id)return void this.error("[createTransform] SceneModel.createTransform() config missing: id");if(this._transforms[e.id])return void this.error(`[createTransform] SceneModel already has a transform with this ID: ${e.id}`);let t;if(e.parentTransformId&&(t=this._transforms[e.parentTransformId],!t))return void this.error("[createTransform] SceneModel.createTransform() config missing: id");const i=new xe({id:e.id,model:this,parentTransform:t,matrix:e.matrix,position:e.position,scale:e.scale,rotation:e.rotation,quaternion:e.quaternion});return this._transforms[i.id]=i,i}createMesh(e){if(void 0===e.id||null===e.id)return this.error("[createMesh] SceneModel.createMesh() config missing: id"),!1;if(this._meshes[e.id])return this.error(`[createMesh] SceneModel already has a mesh with this ID: ${e.id}`),!1;if(!(void 0!==e.geometryId)){if(void 0!==e.primitive&&null!==e.primitive||(e.primitive="triangles"),"points"!==e.primitive&&"lines"!==e.primitive&&"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive)return this.error(`Unsupported value for 'primitive': '${primitive}'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'.`),!1;if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("Param expected: 'positions',  'positionsCompressed' or `buckets`  ('geometryId' is absent)"),!1;if(e.positions&&(e.positionsDecodeMatrix||e.positionsDecodeBoundary))return this.error("Illegal params: 'positions' not expected with 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("Param expected: 'positionsCompressed' should be accompanied by 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: 'uvCompressed' should be accompanied by `uvDecodeMatrix` ('geometryId' is absent)"),!1;if(!(e.buckets||e.indices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive)){const t=(e.positions||e.positionsCompressed).length/3;e.indices=this._createDefaultIndices(t)}if(!e.buckets&&!e.indices&&"points"!==e.primitive)return e.indices=this._createDefaultIndices(numIndices),this.error(`Param expected: indices (required for '${e.primitive}' primitive type)`),!1;if((e.matrix||e.position||e.rotation||e.scale)&&(e.positionsCompressed||e.positionsDecodeBoundary))return this.error("Unexpected params: 'matrix', 'rotation', 'scale', 'position' not allowed with 'positionsCompressed'"),!1;const t=!(!this._dtxEnabled||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||e.textureSetId);if(e.origin=e.origin?b.addVec3(this._origin,e.origin,b.vec3()):this._origin,e.matrix)e.meshMatrix=e.matrix;else if(e.scale||e.rotation||e.position){const t=e.scale||Pe,i=e.position||Te,s=e.rotation||ke;b.eulerToQuaternion(s,"XYZ",De),e.meshMatrix=b.composeMat4(i,De,t,b.mat4())}if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=Q(e.positionsDecodeBoundary,b.mat4())),t){if(e.type=2,e.color=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):Se,e.opacity=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,e.positions){const t=b.vec3(),i=[];N(e.positions,i,t)&&(e.positions=i,e.origin=b.addVec3(e.origin,t,t))}if(e.positions){const t=b.collapseAABB3();e.positionsDecodeMatrix=b.mat4(),b.expandAABB3Points3(t,e.positions),e.positionsCompressed=W(e.positions,t,e.positionsDecodeMatrix),e.aabb=t}else if(e.positionsCompressed){const t=b.collapseAABB3();b.expandAABB3Points3(t,e.positionsCompressed),fe.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}if(e.buckets){const t=b.collapseAABB3();for(let i=0,s=e.buckets.length;i<s;i++){const s=e.buckets[i];s.positions?b.expandAABB3Points3(t,s.positions):s.positionsCompressed&&b.expandAABB3Points3(t,s.positionsCompressed)}e.positionsDecodeMatrix&&fe.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}e.meshMatrix&&(b.AABB3ToOBB3(e.aabb,Ie),b.transformOBB3(e.meshMatrix,Ie),b.OBB3ToAABB3(Ie,e.aabb)),e.buckets||e.edgeIndices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.positions?e.edgeIndices=w(e.positions,e.indices,null,2):e.edgeIndices=w(e.positionsCompressed,e.indices,e.positionsDecodeMatrix,2)),e.buckets||(e.buckets=Ue(e,this._enableVertexWelding&&this._enableIndexBucketing))}else{if(e.type=1,e.color=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],e.opacity=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,e.metallic=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,e.roughness=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,e.positions){const t=[];N(e.positions,t,Ae)&&(e.positions=t,e.origin=b.addVec3(e.origin,Ae,b.vec3()))}if(e.positions){const t=b.collapseAABB3();e.meshMatrix&&(b.transformPositions3(e.meshMatrix,e.positions,e.positions),e.meshMatrix=null),b.expandAABB3Points3(t,e.positions),e.aabb=t}else{const t=b.collapseAABB3();b.expandAABB3Points3(t,e.positionsCompressed),fe.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t,e.positions=fe.decompressPositions(e.positionsCompressed,e.positionsDecodeMatrix,new Float64Array(e.positionsCompressed.length))}if(!e.normals&&e.normalsCompressed&&e.normalsCompressed.length>0){const t=e.normalsCompressed.length,i=new Float32Array(t+t/2);e.normals=fe.decompressNormals(e.normalsCompressed,i)}if(!e.uv&&e.uvCompressed&&e.uvCompressed.length>0&&(e.uv=fe.decompressUVs(e.uvCompressed,e.uvDecodeMatrix)),e.meshMatrix&&(b.AABB3ToOBB3(e.aabb,Ie),b.transformOBB3(e.meshMatrix,Ie),b.OBB3ToAABB3(Ie,e.aabb)),e.buckets||e.edgeIndices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.positions?e.edgeIndices=w(e.positions,e.indices,null,2):e.edgeIndices=w(e.positionsCompressed,e.indices,e.positionsDecodeMatrix,2)),e.textureSetId&&(e.textureSet=this._textureSets[e.textureSetId],!e.textureSet))return this.error(`[createMesh] Texture set not found: ${e.textureSetId} - ensure that you create it first with createTextureSet()`),!1}}else{if(e.positions||e.positionsCompressed||e.indices||e.edgeIndices||e.normals||e.normalsCompressed||e.uv||e.uvCompressed||e.positionsDecodeMatrix)return this.error("Mesh geometry parameters not expected when instancing a geometry (not expected: positions, positionsCompressed, indices, edgeIndices, normals, normalsCompressed, uv, uvCompressed, positionsDecodeMatrix)"),!1;if(e.geometry=this._geometries[e.geometryId],!e.geometry)return this.error(`[createMesh] Geometry not found: ${e.geometryId} - ensure that you create it first with createGeometry()`),!1;if(e.origin=e.origin?b.addVec3(this._origin,e.origin,b.vec3()):this._origin,e.positionsDecodeMatrix=e.geometry.positionsDecodeMatrix,e.transformId){if(e.transform=this._transforms[e.transformId],!e.transform)return this.error(`[createMesh] Transform not found: ${e.transformId} - ensure that you create it first with createTransform()`),!1;e.aabb=e.geometry.aabb}else{if(e.matrix)e.meshMatrix=e.matrix.slice();else{const t=e.scale||Pe,i=e.position||Te,s=e.rotation||ke;b.eulerToQuaternion(s,"XYZ",De),e.meshMatrix=b.composeMat4(i,De,t,b.mat4())}b.AABB3ToOBB3(e.geometry.aabb,Ie),b.transformOBB3(e.meshMatrix,Ie),e.aabb=b.OBB3ToAABB3(Ie,b.AABB3())}if(!(!this._dtxEnabled||"triangles"!==e.geometry.primitive&&"solid"!==e.geometry.primitive&&"surface"!==e.geometry.primitive||e.textureSetId)){e.type=2,e.color=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):Se,e.opacity=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255;let t=this._dtxBuckets[e.geometryId];t||(t=Ue(e.geometry,this._enableVertexWelding,this._enableIndexBucketing),this._dtxBuckets[e.geometryId]=t),e.buckets=t}else e.type=0,e.color=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):Se,e.opacity=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,e.metallic=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,e.roughness=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,e.textureSetId&&(e.textureSet=this._textureSets[e.textureSetId])}return e.numPrimitives=this._getNumPrimitives(e),this._createMesh(e)}_createMesh(e){const t=new A(this,e.id,e.color,e.opacity,e.transform,e.textureSet);return e.solid="solid"===e.primitive,t.origin=b.vec3(e.origin),e.transform&&(e.meshMatrix=e.transform.worldMatrix),t.cfg=e,this._meshes[e.id]=t,this._unusedMeshes[e.id]=t,this._meshList.push(t),t}_getNumPrimitives(e){let t=0;switch(e.geometry?e.geometry.primitive:e.primitive){case"triangles":case"solid":case"surface":switch(e.type){case 2:for(let i=0,s=e.buckets.length;i<s;i++)t+=e.buckets[i].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/3);case"points":switch(e.type){case 2:for(let i=0,s=e.buckets.length;i<s;i++)t+=e.buckets[i].positionsCompressed.length;break;case 1:t+=e.positions?e.positions.length:e.positionsCompressed.length;break;case 0:const i=e.geometry;t+=i.positions?i.positions.length:i.positionsCompressed.length}return Math.round(t);case"lines":case"line-strip":switch(e.type){case 2:for(let i=0,s=e.buckets.length;i<s;i++)t+=e.buckets[i].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/2)}return 0}_createHashStringFromMatrix(e){const t=e.join("");let i=0;for(let e=0;e<t.length;e++){i=(i<<5)-i+t.charCodeAt(e),i|=0}return(i>>>0).toString(16)}createEntity(e){if(void 0===e.id&&(e.id=b.createUUID()),void 0===e.meshIds)return void this.error("Config missing: meshIds");let t=0;this._visible&&!1!==e.visible&&(t|=T),this._pickable&&!1!==e.pickable&&(t|=D),this._culled&&!1!==e.culled&&(t|=k),this._clippable&&!1!==e.clippable&&(t|=E),this._collidable&&!1!==e.collidable&&(t|=S),this._edges&&!1!==e.edges&&(t|=C),this._xrayed&&!1!==e.xrayed&&(t|=B),this._highlighted&&!1!==e.highlighted&&(t|=U),this._selected&&!1!==e.selected&&(t|=O),e.flags=t,this._createEntity(e)}_createEntity(e){let t=[];for(let i=0,s=e.meshIds.length;i<s;i++){const s=e.meshIds[i];let r=this._meshes[s];r?r.parent?this.error(`Mesh with ID "${s}" already belongs to object with ID "${r.parent.id}" - ignoring this mesh`):(t.push(r),delete this._unusedMeshes[s]):this.error(`Mesh with this ID not found: "${s}" - ignoring this mesh`)}const i=new le(this,e.isObject,e.id,t,e.flags,!0);this._entityList.push(i),this._entities[e.id]=i,this.numEntities++}finalize(){if(!this.destroyed){this._createDummyEntityForUnusedMeshes();for(let e=0,t=this.layerList.length;e<t;e++){this.layerList[e].finalize()}this._geometries={},this._dtxBuckets={},this._dtxLayers={},this._vboInstancingLayers={},this._vboBatchingLayers={};for(let e=0,t=this._entityList.length;e<t;e++){this._entityList[e]._finalize()}for(let e=0,t=this._entityList.length;e<t;e++){this._entityList[e]._finalize2()}this.layerList.sort(((e,t)=>e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0));for(let e=0,t=this.layerList.length;e<t;e++){this.layerList[e].layerIndex=e}this.glRedraw(),this._viewMatrixDirty=!0,this._matrixDirty=!0,this._aabbDirty=!0,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.position=this._position}}stateSortCompare(e,t){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const e=this.renderFlags;e.numLayers=this.layerList.length,e.numVisibleLayers=0;for(let t=0,i=this.layerList.length;t<i;t++){const i=this.layerList[t];this._getActiveSectionPlanesForLayer(i)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}_createDummyEntityForUnusedMeshes(){const e=Object.keys(this._unusedMeshes);if(e.length>0){const t=`${this.id}-dummyEntityForUnusedMeshes`;this.warn(`Creating dummy SceneModelEntity "${t}" for unused SceneMeshes: [${e.join(",")}]`),this.createEntity({id:t,meshIds:e,isObject:!0})}this._unusedMeshes={}}_getActiveSectionPlanesForLayer(e){return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const e=this.renderFlags;e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0)}drawColorOpaque(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawColorOpaque(t,e)}}drawColorTransparent(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawColorTransparent(t,e)}}drawDepth(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawDepth(t,e)}}drawNormals(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawNormals(t,e)}}drawSilhouetteXRayed(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawSilhouetteXRayed(t,e)}}drawSilhouetteHighlighted(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawSilhouetteHighlighted(t,e)}}drawSilhouetteSelected(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawSilhouetteSelected(t,e)}}drawEdgesColorOpaque(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawEdgesColorOpaque(t,e)}}drawEdgesColorTransparent(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawEdgesColorTransparent(t,e)}}drawEdgesXRayed(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawEdgesXRayed(t,e)}}drawEdgesHighlighted(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawEdgesHighlighted(t,e)}}drawEdgesSelected(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawEdgesSelected(t,e)}}drawOcclusion(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawOcclusion(t,e)}}drawShadow(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawShadow(t,e)}}setPickMatrices(e,t){if(0===this._numVisibleLayerPortions)return;const i=this.renderFlags;for(let s=0,r=i.visibleLayers.length;s<r;s++){const r=i.visibleLayers[s],n=this.layerList[r];n.setPickMatrices&&n.setPickMatrices(e,t)}}drawPickMesh(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawPickMesh(t,e)}}drawPickDepths(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawPickDepths(t,e)}}drawPickNormals(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this.layerList[s].drawPickNormals(t,e)}}drawSnapInit(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i],r=this.layerList[s];r.drawSnapInit&&(e.snapPickOrigin=[0,0,0],e.snapPickCoordinateScale=[1,1,1],e.snapPickLayerNumber++,r.drawSnapInit(t,e),e.snapPickLayerParams[e.snapPickLayerNumber]={origin:e.snapPickOrigin.slice(),coordinateScale:e.snapPickCoordinateScale.slice()})}}drawSnap(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i],r=this.layerList[s];r.drawSnap&&(e.snapPickOrigin=[0,0,0],e.snapPickCoordinateScale=[1,1,1],e.snapPickLayerNumber++,r.drawSnap(t,e),e.snapPickLayerParams[e.snapPickLayerNumber]={origin:e.snapPickOrigin.slice(),coordinateScale:e.snapPickCoordinateScale.slice()})}}destroy(){for(let e in this._vboBatchingLayers)this._vboBatchingLayers.hasOwnProperty(e)&&this._vboBatchingLayers[e].destroy();this._vboBatchingLayers={};for(let e in this._vboInstancingLayers)this._vboInstancingLayers.hasOwnProperty(e)&&this._vboInstancingLayers[e].destroy();this._vboInstancingLayers={};for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].destroy();this.layerList=[];for(let e=0,t=this._entityList.length;e<t;e++)this._entityList[e]._destroy();this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={},this._meshes={},this._entities={},0!==P&&(P--,0===P&&I._clear()),super.destroy()}}function Ue(e,t,i){let s,r,n,o;if(t||i?[s,r,n]=K({positionsCompressed:e.positionsCompressed,indices:e.indices,edgeIndices:e.edgeIndices}):(s=e.positionsCompressed,r=e.indices,n=e.edgeIndices),i){o=ne({positionsCompressed:s,indices:r,edgeIndices:n},s.length/3>65536?16:8)}else o=[{positionsCompressed:s,indices:r,edgeIndices:n}];return o}class Oe{constructor(e,t,i,s,r){this.name=e,this.type=i,this.value=t,this.valueType=s,this.description=r}}class Ce{constructor(e){if(this.id=e.id,this.originalSystemId=e.originalSystemId,this.metaModels=[],this.name=e.name,this.type=e.type,this.properties=[],e.properties){const t=e.properties;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.properties.push(new Oe(i.name,i.value,i.type,i.valueType,i.description))}}}}class Le{constructor(e){this.metaModels=[],this.id=e.id,this.parentId=e.parentId,this.parent=null,this.originalSystemId=e.originalSystemId,this.name=e.name,this.type=e.type,this.propertySetIds=e.propertySetIds,this.propertySets=[],this.attributes=e.attributes||{},void 0!==e.external&&null!==e.external&&(this.external=e.external)}get metaModel(){return 1==this.metaModels.length?this.metaModels[0]:null}getObjectIDsInSubtree(){const e=[];return function t(i){if(!i)return;e.push(i.id);const s=i.children;if(s)for(var r=0,n=s.length;r<n;r++)t(s[r])}(this),e}withMetaObjectsInSubtree(e){!function t(i){if(!i)return;e(i);const s=i.children;if(s)for(var r=0,n=s.length;r<n;r++)t(s[r])}(this)}getObjectIDsInSubtreeByType(e){const t={};for(var i=0,s=e.length;i<s;i++)t[e[i]]=e[i];const r=[];return function e(i){if(!i)return;t[i.type]&&r.push(i.id);const s=i.children;if(s)for(var n=0,o=s.length;n<o;n++)e(s[n])}(this),r}getJSON(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}class ze{constructor(e){this.id=e.id,this.projectId=e.projectId,this.revisionId=e.revisionId,this.author=e.author,this.createdAt=e.createdAt,this.creatingApplication=e.creatingApplication,this.schema=e.schema,this.propertySets=[],this.rootMetaObjects=[],this.metaObjects=[],this.graph=e.graph||{},this.finalized=!1}get rootMetaObject(){return 1==this.rootMetaObjects.length?this.rootMetaObjects[0]:null}loadData(e,t={}){if(this.finalized)throw"MetaScene already finalized - can't add more data";this._globalizeIDs(e,t);const i=e.properties;if(e.propertySets)for(let t=0,s=e.propertySets.length;t<s;t++){const s=e.propertySets[t];let r;s.properties||(s.properties=[]),r||(i&&this._decompressProperties(i,s.properties),r=new Ce({id:s.id,originalSystemId:s.originalSystemId||s.id,type:s.type,name:s.name,properties:s.properties})),r.metaModels.push(this),this.propertySets.push(r)}if(e.metaObjects)for(let t=0,i=e.metaObjects.length;t<i;t++){const i=e.metaObjects[t],s=i.id;let r;if(!r){const e=i.type,t=i.originalSystemId,n=i.propertySets||i.propertySetIds;r=new Le({id:s,originalSystemId:t,parentId:i.parent,type:e,name:i.name,attributes:i.attributes,propertySetIds:n,external:i.external}),r.metaModels=[]}this.metaObjects.push(r),i.parent||this.rootMetaObjects.push(r)}}_decompressProperties(e,t){for(let i=0,s=t.length;i<s;i++){const s=t[i];if(Number.isInteger(s)){const r=e[s];r&&(t[i]=r)}}}finalize(){if(this.finalized)throw"MetaScene already finalized - can't re-finalize";this.finalized=!0}getJSON(){const e={id:this.id,projectId:this.projectId,author:this.author,createdAt:this.createdAt,schema:this.schema,creatingApplication:this.creatingApplication,metaObjects:[],propertySets:[]};for(let t=0,i=this.metaObjects.length;t<i;t++){const i=this.metaObjects[t],s={id:i.id,originalSystemId:i.originalSystemId,extId:i.extId,type:i.type,name:i.name};i.parent&&(s.parent=i.parent.id),i.attributes&&(s.attributes=i.attributes),i.propertySetIds&&(s.propertySetIds=i.propertySetIds),e.metaObjects.push(s)}for(let t=0,i=this.propertySets.length;t<i;t++){const i=this.propertySets[t],s={id:i.id,originalSystemId:i.originalSystemId,extId:i.extId,type:i.type,name:i.name,propertyies:[]};for(let e=0,t=i.properties.length;e<t;e++){const t=i.properties[e],r={id:t.id,description:t.description,type:t.type,name:t.name,value:t.value,valueType:t.valueType};s.properties.push(r)}e.propertySets.push(s)}return e}_globalizeIDs(e,t){const i=!!t.globalizeObjectIds;if(e.metaObjects)for(let t=0,s=e.metaObjects.length;t<s;t++){const s=e.metaObjects[t];if(s.originalSystemId=s.id,s.parent&&(s.originalParentSystemId=s.parent),i&&(s.id=b.globalizeObjectId(this.id,s.id),s.parent&&(s.parent=b.globalizeObjectId(this.id,s.parent))),i){const e=s.propertySetIds;if(e){const t=[];for(let i=0,s=e.length;i<s;i++)t.push(b.globalizeObjectId(this.id,e[i]));s.propertySetIds=t,s.originalSystemPropertySetIds=e}}else s.originalSystemPropertySetIds=s.propertySetIds}if(e.propertySets)for(let t=0,s=e.propertySets.length;t<s;t++){const s=e.propertySets[t];s.originalSystemId=s.id,i&&(s.id=b.globalizeObjectId(this.id,s.id))}}getMetaObject(e){for(let t=0,i=this.metaObjects.length;t<i;t++){const i=this.metaObjects[t];if(i.id===e)return i}}destroy(){this.destroyed||(this.propertySets.length=0,this.rootMetaObjects.length=0,this.metaObjects.length=0,this.fire("destroyed",this.destroyed=!0))}}class Ne{constructor(e,t,i){this.id=i&&i.id?i.id:e,this.viewer=t,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,t&&t.addPlugin(this)}scheduleTask(e){n.scheduleTask(e,null)}fire(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==i&&(this._events[e]=t||!0);const s=this._eventSubs[e];let r;if(s)for(const i in s)s.hasOwnProperty(i)&&(r=s[i],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,i,s){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const n=this._subIdMap.addItem();r[n]={callback:i,scope:s||this},this._subIdEvents[n]=t;const o=this._events[t];return void 0!==o&&i.call(s||this,o),n}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const i=this._eventSubs[t];i&&(delete i[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,i){const s=this,r=this.on(e,(function(e){s.off(r),t.call(i||this,e)}),i)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){console.log(`[xeokit plugin ${this.id}]: ${e}`)}warn(e){console.warn(`[xeokit plugin ${this.id}]: ${e}`)}error(e){console.error(`[xeokit plugin ${this.id}]: ${e}`)}send(e,t){}destroy(){this.viewer&&this.viewer.removePlugin(this)}}class Re{constructor(){}getManifest(e,t,i){d.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}getMetaModel(e,t,i){d.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}getXKT(e,t,i){var s=()=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var n=r[3];n=window.decodeURIComponent(n),e&&(n=window.atob(n));try{const e=new ArrayBuffer(n.length),i=new Uint8Array(e);for(var o=0;o<n.length;o++)i[o]=n.charCodeAt(o);t(e)}catch(e){i(e)}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("getXKT error : "+s.response))},s.send(null)}}}const je={DEFAULT:{}};
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */var Ve,Fe;Ve=void 0,Fe=function(e){function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),s=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);t(o);const a=new Array(60);t(a);const l=new Array(512);t(l);const c=new Array(256);t(c);const h=new Array(29);t(h);const d=new Array(30);function u(e,t,i,s,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=e&&e.length}let m,p,f;function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(d);const y=e=>e<256?l[e]:l[256+(e>>>7)],_=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},b=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,_(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},w=(e,t,i)=>{b(e,i[2*t],i[2*t+1])},v=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},M=(e,t,i)=>{const s=new Array(16);let r,n,o=0;for(r=1;r<=15;r++)o=o+i[r-1]<<1,s[r]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=v(s[t]++,t))}},x=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},A=e=>{e.bi_valid>8?_(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},I=(e,t,i,s)=>{const r=2*t,n=2*i;return e[r]<e[n]||e[r]===e[n]&&s[t]<=s[i]},P=(e,t,i)=>{const s=e.heap[i];let r=i<<1;for(;r<=e.heap_len&&(r<e.heap_len&&I(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!I(t,s,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=s},T=(e,t,r)=>{let n,o,a,l,u=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+u++],n+=(255&e.pending_buf[e.sym_buf+u++])<<8,o=e.pending_buf[e.sym_buf+u++],0===n?w(e,o,t):(a=c[o],w(e,a+256+1,t),l=i[a],0!==l&&(o-=h[a],b(e,o,l)),n--,a=y(n),w(e,a,r),l=s[a],0!==l&&(n-=d[a],b(e,n,l)))}while(u<e.sym_next);w(e,256,t)},k=(e,t)=>{const i=t.dyn_tree,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,a,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==i[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,r&&(e.static_len-=s[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)P(e,i,o);l=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,i[2*l]=i[2*o]+i[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,i[2*o+1]=i[2*a+1]=l,e.heap[1]=l++,P(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,s=t.max_code,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,h,d,u,m,p,f=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(i[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)h=e.heap[c],u=i[2*i[2*h+1]+1]+1,u>l&&(u=l,f++),i[2*h+1]=u,h>s||(e.bl_count[u]++,m=0,h>=a&&(m=o[h-a]),p=i[2*h],e.opt_len+=p*(u+m),n&&(e.static_len+=p*(r[2*h+1]+m)));if(0!==f){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(u=l;0!==u;u--)for(h=e.bl_count[u];0!==h;)d=e.heap[--c],d>s||(i[2*d+1]!==u&&(e.opt_len+=(u-i[2*d+1])*i[2*d],i[2*d+1]=u),h--)}})(e,t),M(i,c,e.bl_count)},D=(e,t,i)=>{let s,r,n=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)r=o,o=t[2*(s+1)+1],++a<l&&r===o||(a<c?e.bl_tree[2*r]+=a:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,n=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4))},E=(e,t,i)=>{let s,r,n=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),s=0;s<=i;s++)if(r=o,o=t[2*(s+1)+1],!(++a<l&&r===o)){if(a<c)do{w(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==n&&(w(e,r,e.bl_tree),a--),w(e,16,e.bl_tree),b(e,a-3,2)):a<=10?(w(e,17,e.bl_tree),b(e,a-3,3)):(w(e,18,e.bl_tree),b(e,a-11,7));a=0,n=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4)}};let S=!1;const B=(e,t,i,s)=>{b(e,0+(s?1:0),3),A(e),_(e,i),_(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var U={_tr_init:e=>{S||((()=>{let e,t,n,g,y;const _=new Array(16);for(n=0,g=0;g<28;g++)for(h[g]=n,e=0;e<1<<i[g];e++)c[n++]=g;for(c[n-1]=g,y=0,g=0;g<16;g++)for(d[g]=y,e=0;e<1<<s[g];e++)l[y++]=g;for(y>>=7;g<30;g++)for(d[g]=y<<7,e=0;e<1<<s[g]-7;e++)l[256+y++]=g;for(t=0;t<=15;t++)_[t]=0;for(e=0;e<=143;)o[2*e+1]=8,e++,_[8]++;for(;e<=255;)o[2*e+1]=9,e++,_[9]++;for(;e<=279;)o[2*e+1]=7,e++,_[7]++;for(;e<=287;)o[2*e+1]=8,e++,_[8]++;for(M(o,287,_),e=0;e<30;e++)a[2*e+1]=5,a[2*e]=v(e,5);m=new u(o,i,257,286,15),p=new u(a,s,0,30,15),f=new u(new Array(0),r,0,19,7)})(),S=!0),e.l_desc=new g(e.dyn_ltree,m),e.d_desc=new g(e.dyn_dtree,p),e.bl_desc=new g(e.bl_tree,f),e.bi_buf=0,e.bi_valid=0,x(e)},_tr_stored_block:B,_tr_flush_block:(e,t,i,s)=>{let r,l,c=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),k(e,e.l_desc),k(e,e.d_desc),c=(e=>{let t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),k(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*n[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=r&&(r=l)):r=l=i+5,i+4<=r&&-1!==t?B(e,t,i,s):4===e.strategy||l===r?(b(e,2+(s?1:0),3),T(e,o,a)):(b(e,4+(s?1:0),3),((e,t,i,s)=>{let r;for(b(e,t-257,5),b(e,i-1,5),b(e,s-4,4),r=0;r<s;r++)b(e,e.bl_tree[2*n[r]+1],3);E(e,e.dyn_ltree,t-1),E(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),T(e,e.dyn_ltree,e.dyn_dtree)),x(e),s&&A(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(c[i]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{b(e,2,3),w(e,256,o),(e=>{16===e.bi_valid?(_(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},O=(e,t,i,s)=>{let r=65535&e,n=e>>>16&65535,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{r=r+t[s++]|0,n=n+r|0}while(--o);r%=65521,n%=65521}return r|n<<16};const C=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var L=(e,t,i,s)=>{const r=C,n=s+i;e^=-1;for(let i=s;i<n;i++)e=e>>>8^r[255&(e^t[i])];return~e},z={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},N={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:R,_tr_stored_block:j,_tr_flush_block:V,_tr_tally:F,_tr_align:G}=U,{Z_NO_FLUSH:$,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:Z,Z_FINISH:X,Z_BLOCK:W,Z_OK:Q,Z_STREAM_END:H,Z_STREAM_ERROR:Y,Z_DATA_ERROR:J,Z_BUF_ERROR:K,Z_DEFAULT_COMPRESSION:ee,Z_FILTERED:te,Z_HUFFMAN_ONLY:ie,Z_RLE:se,Z_FIXED:re,Z_DEFAULT_STRATEGY:ne,Z_UNKNOWN:oe,Z_DEFLATED:ae}=N,le=258,ce=262,he=42,de=113,ue=666,me=(e,t)=>(e.msg=z[t],t),pe=e=>2*e-(e>4?9:0),fe=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ge=e=>{let t,i,s,r=e.w_size;t=e.hash_size,s=t;do{i=e.head[--s],e.head[s]=i>=r?i-r:0}while(--t);t=r,s=t;do{i=e.prev[--s],e.prev[s]=i>=r?i-r:0}while(--t)};let ye=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const _e=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},be=(e,t)=>{V(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_e(e.strm)},we=(e,t)=>{e.pending_buf[e.pending++]=t},ve=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Me=(e,t,i,s)=>{let r=e.avail_in;return r>s&&(r=s),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),i),1===e.state.wrap?e.adler=O(e.adler,t,r,i):2===e.state.wrap&&(e.adler=L(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)},xe=(e,t)=>{let i,s,r=e.max_chain_length,n=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-ce?e.strstart-(e.w_size-ce):0,c=e.window,h=e.w_mask,d=e.prev,u=e.strstart+le;let m=c[n+o-1],p=c[n+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(i=t,c[i+o]===p&&c[i+o-1]===m&&c[i]===c[n]&&c[++i]===c[n+1]){n+=2,i++;do{}while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<u);if(s=le-(u-n),n=u-le,s>o){if(e.match_start=t,o=s,s>=a)break;m=c[n+o-1],p=c[n+o]}}}while((t=d[t&h])>l&&0!=--r);return o<=e.lookahead?o:e.lookahead},Ae=e=>{const t=e.w_size;let i,s,r;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ce)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ge(e),s+=t),0===e.strm.avail_in)break;if(i=Me(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=i,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=ye(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=ye(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ce&&0!==e.strm.avail_in)},Ie=(e,t)=>{let i,s,r,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(i=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,s=e.strstart-e.block_start,i>s+e.strm.avail_in&&(i=s+e.strm.avail_in),i>r&&(i=r),i<n&&(0===i&&t!==X||t===$||i!==s+e.strm.avail_in))break;o=t===X&&i===s+e.strm.avail_in?1:0,j(e,0,0,o),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,_e(e.strm),s&&(s>i&&(s=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,i-=s),i&&(Me(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==$&&t!==X&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Me(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,n=r>e.w_size?e.w_size:r,s=e.strstart-e.block_start,(s>=n||(s||t===X)&&t!==$&&0===e.strm.avail_in&&s<=r)&&(i=s>r?r:s,o=t===X&&0===e.strm.avail_in&&i===s?1:0,j(e,e.block_start,i,o),e.block_start+=i,_e(e.strm)),o?3:1)},Pe=(e,t)=>{let i,s;for(;;){if(e.lookahead<ce){if(Ae(e),e.lookahead<ce&&t===$)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ye(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ce&&(e.match_length=xe(e,i)),e.match_length>=3)if(s=F(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ye(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ye(e,e.ins_h,e.window[e.strstart+1]);else s=F(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2},Te=(e,t)=>{let i,s,r;for(;;){if(e.lookahead<ce){if(Ae(e),e.lookahead<ce&&t===$)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ye(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ce&&(e.match_length=xe(e,i),e.match_length<=5&&(e.strategy===te||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,s=F(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=ye(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(be(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=F(e,0,e.window[e.strstart-1]),s&&be(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=F(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2};function ke(e,t,i,s,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=r}const De=[new ke(0,0,0,0,Ie),new ke(4,4,8,4,Pe),new ke(4,5,16,8,Pe),new ke(4,6,32,32,Pe),new ke(4,4,16,16,Te),new ke(8,16,32,32,Te),new ke(8,16,128,128,Te),new ke(8,32,128,256,Te),new ke(32,128,258,1024,Te),new ke(32,258,258,4096,Te)];function Ee(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ae,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),fe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Se=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==he&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==de&&t.status!==ue?1:0},Be=e=>{if(Se(e))return me(e,Y);e.total_in=e.total_out=0,e.data_type=oe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?he:de,e.adler=2===t.wrap?0:1,t.last_flush=-2,R(t),Q},Ue=e=>{const t=Be(e);var i;return t===Q&&((i=e.state).window_size=2*i.w_size,fe(i.head),i.max_lazy_match=De[i.level].max_lazy,i.good_match=De[i.level].good_length,i.nice_match=De[i.level].nice_length,i.max_chain_length=De[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},Oe=(e,t,i,s,r,n)=>{if(!e)return Y;let o=1;if(t===ee&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),r<1||r>9||i!==ae||s<8||s>15||t<0||t>9||n<0||n>re||8===s&&1!==o)return me(e,Y);8===s&&(s=9);const a=new Ee;return e.state=a,a.strm=e,a.status=he,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=n,a.method=i,Ue(e)};var Ce={deflateInit:(e,t)=>Oe(e,t,ae,15,8,ne),deflateInit2:Oe,deflateReset:Ue,deflateResetKeep:Be,deflateSetHeader:(e,t)=>Se(e)||2!==e.state.wrap?Y:(e.state.gzhead=t,Q),deflate:(e,t)=>{if(Se(e)||t>W||t<0)return e?me(e,Y):Y;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||i.status===ue&&t!==X)return me(e,0===e.avail_out?K:Y);const s=i.last_flush;if(i.last_flush=t,0!==i.pending){if(_e(e),0===e.avail_out)return i.last_flush=-1,Q}else if(0===e.avail_in&&pe(t)<=pe(s)&&t!==X)return me(e,K);if(i.status===ue&&0!==e.avail_in)return me(e,K);if(i.status===he&&0===i.wrap&&(i.status=de),i.status===he){let t=ae+(i.w_bits-8<<4)<<8,s=-1;if(s=i.strategy>=ie||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=s<<6,0!==i.strstart&&(t|=32),t+=31-t%31,ve(i,t),0!==i.strstart&&(ve(i,e.adler>>>16),ve(i,65535&e.adler)),e.adler=1,i.status=de,_e(e),0!==i.pending)return i.last_flush=-1,Q}if(57===i.status)if(e.adler=0,we(i,31),we(i,139),we(i,8),i.gzhead)we(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),we(i,255&i.gzhead.time),we(i,i.gzhead.time>>8&255),we(i,i.gzhead.time>>16&255),we(i,i.gzhead.time>>24&255),we(i,9===i.level?2:i.strategy>=ie||i.level<2?4:0),we(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(we(i,255&i.gzhead.extra.length),we(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=L(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(we(i,0),we(i,0),we(i,0),we(i,0),we(i,0),we(i,9===i.level?2:i.strategy>=ie||i.level<2?4:0),we(i,3),i.status=de,_e(e),0!==i.pending)return i.last_flush=-1,Q;if(69===i.status){if(i.gzhead.extra){let t=i.pending,s=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+s>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=L(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=r,_e(e),0!==i.pending)return i.last_flush=-1,Q;t=0,s-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending+=s,i.gzhead.hcrc&&i.pending>t&&(e.adler=L(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let t,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=L(e.adler,i.pending_buf,i.pending-s,s)),_e(e),0!==i.pending)return i.last_flush=-1,Q;s=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,we(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>s&&(e.adler=L(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let t,s=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>s&&(e.adler=L(e.adler,i.pending_buf,i.pending-s,s)),_e(e),0!==i.pending)return i.last_flush=-1,Q;s=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,we(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>s&&(e.adler=L(e.adler,i.pending_buf,i.pending-s,s))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(_e(e),0!==i.pending))return i.last_flush=-1,Q;we(i,255&e.adler),we(i,e.adler>>8&255),e.adler=0}if(i.status=de,_e(e),0!==i.pending)return i.last_flush=-1,Q}if(0!==e.avail_in||0!==i.lookahead||t!==$&&i.status!==ue){let s=0===i.level?Ie(i,t):i.strategy===ie?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Ae(e),0===e.lookahead)){if(t===$)return 1;break}if(e.match_length=0,i=F(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(i,t):i.strategy===se?((e,t)=>{let i,s,r,n;const o=e.window;for(;;){if(e.lookahead<=le){if(Ae(e),e.lookahead<=le&&t===$)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,s=o[r],s===o[++r]&&s===o[++r]&&s===o[++r])){n=e.strstart+le;do{}while(s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&r<n);e.match_length=le-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=F(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=F(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(i,t):De[i.level].func(i,t);if(3!==s&&4!==s||(i.status=ue),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),Q;if(2===s&&(t===q?G(i):t!==W&&(j(i,0,0,!1),t===Z&&(fe(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),_e(e),0===e.avail_out))return i.last_flush=-1,Q}return t!==X?Q:i.wrap<=0?H:(2===i.wrap?(we(i,255&e.adler),we(i,e.adler>>8&255),we(i,e.adler>>16&255),we(i,e.adler>>24&255),we(i,255&e.total_in),we(i,e.total_in>>8&255),we(i,e.total_in>>16&255),we(i,e.total_in>>24&255)):(ve(i,e.adler>>>16),ve(i,65535&e.adler)),_e(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Q:H)},deflateEnd:e=>{if(Se(e))return Y;const t=e.state.status;return e.state=null,t===de?me(e,J):Q},deflateSetDictionary:(e,t)=>{let i=t.length;if(Se(e))return Y;const s=e.state,r=s.wrap;if(2===r||1===r&&s.status!==he||s.lookahead)return Y;if(1===r&&(e.adler=O(e.adler,t,i,0)),s.wrap=0,i>=s.w_size){0===r&&(fe(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(i-s.w_size,i),0),t=e,i=s.w_size}const n=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Ae(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=ye(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,Ae(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=a,e.avail_in=n,s.wrap=r,Q},deflateInfo:"pako deflate (from Nodeca project)"};const Le=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ze=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Le(i,t)&&(e[t]=i[t])}}return e},Ne=e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,s=0,r=e.length;t<r;t++){let r=e[t];i.set(r,s),s+=r.length}return i};let Re=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Re=!1}const je=new Uint8Array(256);for(let e=0;e<256;e++)je[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;je[254]=je[254]=1;var Ve=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,s,r,n,o=e.length,a=0;for(r=0;r<o;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<o&&(s=e.charCodeAt(r+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(a),n=0,r=0;n<a;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<o&&(s=e.charCodeAt(r+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},Fe=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,r;const n=new Array(2*i);for(r=0,s=0;s<i;){let t=e[s++];if(t<128){n[r++]=t;continue}let o=je[t];if(o>4)n[r++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<i;)t=t<<6|63&e[s++],o--;o>1?n[r++]=65533:t<65536?n[r++]=t:(t-=65536,n[r++]=55296|t>>10&1023,n[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Re)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i})(n,r)},Ge=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+je[e[i]]>t?i:t},$e=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qe=Object.prototype.toString,{Z_NO_FLUSH:Ze,Z_SYNC_FLUSH:Xe,Z_FULL_FLUSH:We,Z_FINISH:Qe,Z_OK:He,Z_STREAM_END:Ye,Z_DEFAULT_COMPRESSION:Je,Z_DEFAULT_STRATEGY:Ke,Z_DEFLATED:et}=N;function tt(e){this.options=ze({level:Je,method:et,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ke},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let i=Ce.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==He)throw new Error(z[i]);if(t.header&&Ce.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ve(t.dictionary):"[object ArrayBuffer]"===qe.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Ce.deflateSetDictionary(this.strm,e),i!==He)throw new Error(z[i]);this._dict_set=!0}}function it(e,t){const i=new tt(t);if(i.push(e,!0),i.err)throw i.msg||z[i.err];return i.result}tt.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize;let r,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Qe:Ze,"string"==typeof e?i.input=Ve(e):"[object ArrayBuffer]"===qe.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(n===Xe||n===We)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=Ce.deflate(i,n),r===Ye)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=Ce.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===He;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},tt.prototype.onData=function(e){this.chunks.push(e)},tt.prototype.onEnd=function(e){e===He&&(this.result=Ne(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var st={Deflate:tt,deflate:it,deflateRaw:function(e,t){return(t=t||{}).raw=!0,it(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,it(e,t)},constants:N};const rt=16209;var nt=function(e,t){let i,s,r,n,o,a,l,c,h,d,u,m,p,f,g,y,_,b,w,v,M,x,A,I;const P=e.state;i=e.next_in,A=e.input,s=i+(e.avail_in-5),r=e.next_out,I=e.output,n=r-(t-e.avail_out),o=r+(e.avail_out-257),a=P.dmax,l=P.wsize,c=P.whave,h=P.wnext,d=P.window,u=P.hold,m=P.bits,p=P.lencode,f=P.distcode,g=(1<<P.lenbits)-1,y=(1<<P.distbits)-1;e:do{m<15&&(u+=A[i++]<<m,m+=8,u+=A[i++]<<m,m+=8),_=p[u&g];t:for(;;){if(b=_>>>24,u>>>=b,m-=b,b=_>>>16&255,0===b)I[r++]=65535&_;else{if(!(16&b)){if(!(64&b)){_=p[(65535&_)+(u&(1<<b)-1)];continue t}if(32&b){P.mode=16191;break e}e.msg="invalid literal/length code",P.mode=rt;break e}w=65535&_,b&=15,b&&(m<b&&(u+=A[i++]<<m,m+=8),w+=u&(1<<b)-1,u>>>=b,m-=b),m<15&&(u+=A[i++]<<m,m+=8,u+=A[i++]<<m,m+=8),_=f[u&y];i:for(;;){if(b=_>>>24,u>>>=b,m-=b,b=_>>>16&255,!(16&b)){if(!(64&b)){_=f[(65535&_)+(u&(1<<b)-1)];continue i}e.msg="invalid distance code",P.mode=rt;break e}if(v=65535&_,b&=15,m<b&&(u+=A[i++]<<m,m+=8,m<b&&(u+=A[i++]<<m,m+=8)),v+=u&(1<<b)-1,v>a){e.msg="invalid distance too far back",P.mode=rt;break e}if(u>>>=b,m-=b,b=r-n,v>b){if(b=v-b,b>c&&P.sane){e.msg="invalid distance too far back",P.mode=rt;break e}if(M=0,x=d,0===h){if(M+=l-b,b<w){w-=b;do{I[r++]=d[M++]}while(--b);M=r-v,x=I}}else if(h<b){if(M+=l+h-b,b-=h,b<w){w-=b;do{I[r++]=d[M++]}while(--b);if(M=0,h<w){b=h,w-=b;do{I[r++]=d[M++]}while(--b);M=r-v,x=I}}}else if(M+=h-b,b<w){w-=b;do{I[r++]=d[M++]}while(--b);M=r-v,x=I}for(;w>2;)I[r++]=x[M++],I[r++]=x[M++],I[r++]=x[M++],w-=3;w&&(I[r++]=x[M++],w>1&&(I[r++]=x[M++]))}else{M=r-v;do{I[r++]=I[M++],I[r++]=I[M++],I[r++]=I[M++],w-=3}while(w>2);w&&(I[r++]=I[M++],w>1&&(I[r++]=I[M++]))}break}}break}}while(i<s&&r<o);w=m>>3,i-=w,m-=w<<3,u&=(1<<m)-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<o?o-r+257:257-(r-o),P.hold=u,P.bits=m};const ot=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),at=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),lt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ct=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ht=(e,t,i,s,r,n,o,a)=>{const l=a.bits;let c,h,d,u,m,p,f=0,g=0,y=0,_=0,b=0,w=0,v=0,M=0,x=0,A=0,I=null;const P=new Uint16Array(16),T=new Uint16Array(16);let k,D,E,S=null;for(f=0;f<=15;f++)P[f]=0;for(g=0;g<s;g++)P[t[i+g]]++;for(b=l,_=15;_>=1&&0===P[_];_--);if(b>_&&(b=_),0===_)return r[n++]=20971520,r[n++]=20971520,a.bits=1,0;for(y=1;y<_&&0===P[y];y++);for(b<y&&(b=y),M=1,f=1;f<=15;f++)if(M<<=1,M-=P[f],M<0)return-1;if(M>0&&(0===e||1!==_))return-1;for(T[1]=0,f=1;f<15;f++)T[f+1]=T[f]+P[f];for(g=0;g<s;g++)0!==t[i+g]&&(o[T[t[i+g]]++]=g);if(0===e?(I=S=o,p=20):1===e?(I=ot,S=at,p=257):(I=lt,S=ct,p=0),A=0,g=0,f=y,m=n,w=b,v=0,d=-1,x=1<<b,u=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){k=f-v,o[g]+1<p?(D=0,E=o[g]):o[g]>=p?(D=S[o[g]-p],E=I[o[g]-p]):(D=96,E=0),c=1<<f-v,h=1<<w,y=h;do{h-=c,r[m+(A>>v)+h]=k<<24|D<<16|E}while(0!==h);for(c=1<<f-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,g++,0==--P[f]){if(f===_)break;f=t[i+o[g]]}if(f>b&&(A&u)!==d){for(0===v&&(v=b),m+=y,w=f-v,M=1<<w;w+v<_&&(M-=P[w+v],!(M<=0));)w++,M<<=1;if(x+=1<<w,1===e&&x>852||2===e&&x>592)return 1;d=A&u,r[d]=b<<24|w<<16|m-n}}return 0!==A&&(r[m+A]=f-v<<24|64<<16),a.bits=b,0};const{Z_FINISH:dt,Z_BLOCK:ut,Z_TREES:mt,Z_OK:pt,Z_STREAM_END:ft,Z_NEED_DICT:gt,Z_STREAM_ERROR:yt,Z_DATA_ERROR:_t,Z_MEM_ERROR:bt,Z_BUF_ERROR:wt,Z_DEFLATED:vt}=N,Mt=16180,xt=16190,At=16191,It=16192,Pt=16194,Tt=16199,kt=16200,Dt=16206,Et=16209,St=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Bt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ut=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Mt||t.mode>16211?1:0},Ot=e=>{if(Ut(e))return yt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Mt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,pt},Ct=e=>{if(Ut(e))return yt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ot(e)},Lt=(e,t)=>{let i;if(Ut(e))return yt;const s=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?yt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,Ct(e))},zt=(e,t)=>{if(!e)return yt;const i=new Bt;e.state=i,i.strm=e,i.window=null,i.mode=Mt;const s=Lt(e,t);return s!==pt&&(e.state=null),s};let Nt,Rt,jt=!0;const Vt=e=>{if(jt){Nt=new Int32Array(512),Rt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ht(1,e.lens,0,288,Nt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ht(2,e.lens,0,32,Rt,0,e.work,{bits:5}),jt=!1}e.lencode=Nt,e.lenbits=9,e.distcode=Rt,e.distbits=5},Ft=(e,t,i,s)=>{let r;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(t.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):(r=n.wsize-n.wnext,r>s&&(r=s),n.window.set(t.subarray(i-s,i-s+r),n.wnext),(s-=r)?(n.window.set(t.subarray(i-s,i),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0};var Gt={inflateReset:Ct,inflateReset2:Lt,inflateResetKeep:Ot,inflateInit:e=>zt(e,15),inflateInit2:zt,inflate:(e,t)=>{let i,s,r,n,o,a,l,c,h,d,u,m,p,f,g,y,_,b,w,v,M,x,A=0;const I=new Uint8Array(4);let P,T;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ut(e)||!e.output||!e.input&&0!==e.avail_in)return yt;i=e.state,i.mode===At&&(i.mode=It),o=e.next_out,r=e.output,l=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,c=i.hold,h=i.bits,d=a,u=l,x=pt;e:for(;;)switch(i.mode){case Mt:if(0===i.wrap){i.mode=It;break}for(;h<16;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(2&i.wrap&&35615===c){0===i.wbits&&(i.wbits=15),i.check=0,I[0]=255&c,I[1]=c>>>8&255,i.check=L(i.check,I,2,0),c=0,h=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=Et;break}if((15&c)!==vt){e.msg="unknown compression method",i.mode=Et;break}if(c>>>=4,h-=4,M=8+(15&c),0===i.wbits&&(i.wbits=M),M>15||M>i.wbits){e.msg="invalid window size",i.mode=Et;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&c?16189:At,c=0,h=0;break;case 16181:for(;h<16;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(i.flags=c,(255&i.flags)!==vt){e.msg="unknown compression method",i.mode=Et;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Et;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&4&i.wrap&&(I[0]=255&c,I[1]=c>>>8&255,i.check=L(i.check,I,2,0)),c=0,h=0,i.mode=16182;case 16182:for(;h<32;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.head&&(i.head.time=c),512&i.flags&&4&i.wrap&&(I[0]=255&c,I[1]=c>>>8&255,I[2]=c>>>16&255,I[3]=c>>>24&255,i.check=L(i.check,I,4,0)),c=0,h=0,i.mode=16183;case 16183:for(;h<16;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&4&i.wrap&&(I[0]=255&c,I[1]=c>>>8&255,i.check=L(i.check,I,2,0)),c=0,h=0,i.mode=16184;case 16184:if(1024&i.flags){for(;h<16;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&4&i.wrap&&(I[0]=255&c,I[1]=c>>>8&255,i.check=L(i.check,I,2,0)),c=0,h=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(m=i.length,m>a&&(m=a),m&&(i.head&&(M=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(n,n+m),M)),512&i.flags&&4&i.wrap&&(i.check=L(i.check,s,m,n)),a-=m,n+=m,i.length-=m),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===a)break e;m=0;do{M=s[n+m++],i.head&&M&&i.length<65536&&(i.head.name+=String.fromCharCode(M))}while(M&&m<a);if(512&i.flags&&4&i.wrap&&(i.check=L(i.check,s,m,n)),a-=m,n+=m,M)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===a)break e;m=0;do{M=s[n+m++],i.head&&M&&i.length<65536&&(i.head.comment+=String.fromCharCode(M))}while(M&&m<a);if(512&i.flags&&4&i.wrap&&(i.check=L(i.check,s,m,n)),a-=m,n+=m,M)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;h<16;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(4&i.wrap&&c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Et;break}c=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=At;break;case 16189:for(;h<32;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}e.adler=i.check=St(c),c=0,h=0,i.mode=xt;case xt:if(0===i.havedict)return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=c,i.bits=h,gt;e.adler=i.check=1,i.mode=At;case At:if(t===ut||t===mt)break e;case It:if(i.last){c>>>=7&h,h-=7&h,i.mode=Dt;break}for(;h<3;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}switch(i.last=1&c,c>>>=1,h-=1,3&c){case 0:i.mode=16193;break;case 1:if(Vt(i),i.mode=Tt,t===mt){c>>>=2,h-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Et}c>>>=2,h-=2;break;case 16193:for(c>>>=7&h,h-=7&h;h<32;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Et;break}if(i.length=65535&c,c=0,h=0,i.mode=Pt,t===mt)break e;case Pt:i.mode=16195;case 16195:if(m=i.length,m){if(m>a&&(m=a),m>l&&(m=l),0===m)break e;r.set(s.subarray(n,n+m),o),a-=m,n+=m,l-=m,o+=m,i.length-=m;break}i.mode=At;break;case 16196:for(;h<14;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(i.nlen=257+(31&c),c>>>=5,h-=5,i.ndist=1+(31&c),c>>>=5,h-=5,i.ncode=4+(15&c),c>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Et;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;h<3;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.lens[k[i.have++]]=7&c,c>>>=3,h-=3}for(;i.have<19;)i.lens[k[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,P={bits:i.lenbits},x=ht(0,i.lens,0,19,i.lencode,0,i.work,P),i.lenbits=P.bits,x){e.msg="invalid code lengths set",i.mode=Et;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;A=i.lencode[c&(1<<i.lenbits)-1],g=A>>>24,y=A>>>16&255,_=65535&A,!(g<=h);){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(_<16)c>>>=g,h-=g,i.lens[i.have++]=_;else{if(16===_){for(T=g+2;h<T;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(c>>>=g,h-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=Et;break}M=i.lens[i.have-1],m=3+(3&c),c>>>=2,h-=2}else if(17===_){for(T=g+3;h<T;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}c>>>=g,h-=g,M=0,m=3+(7&c),c>>>=3,h-=3}else{for(T=g+7;h<T;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}c>>>=g,h-=g,M=0,m=11+(127&c),c>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Et;break}for(;m--;)i.lens[i.have++]=M}}if(i.mode===Et)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Et;break}if(i.lenbits=9,P={bits:i.lenbits},x=ht(1,i.lens,0,i.nlen,i.lencode,0,i.work,P),i.lenbits=P.bits,x){e.msg="invalid literal/lengths set",i.mode=Et;break}if(i.distbits=6,i.distcode=i.distdyn,P={bits:i.distbits},x=ht(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,P),i.distbits=P.bits,x){e.msg="invalid distances set",i.mode=Et;break}if(i.mode=Tt,t===mt)break e;case Tt:i.mode=kt;case kt:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=c,i.bits=h,nt(e,u),o=e.next_out,r=e.output,l=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,c=i.hold,h=i.bits,i.mode===At&&(i.back=-1);break}for(i.back=0;A=i.lencode[c&(1<<i.lenbits)-1],g=A>>>24,y=A>>>16&255,_=65535&A,!(g<=h);){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(y&&!(240&y)){for(b=g,w=y,v=_;A=i.lencode[v+((c&(1<<b+w)-1)>>b)],g=A>>>24,y=A>>>16&255,_=65535&A,!(b+g<=h);){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}c>>>=b,h-=b,i.back+=b}if(c>>>=g,h-=g,i.back+=g,i.length=_,0===y){i.mode=16205;break}if(32&y){i.back=-1,i.mode=At;break}if(64&y){e.msg="invalid literal/length code",i.mode=Et;break}i.extra=15&y,i.mode=16201;case 16201:if(i.extra){for(T=i.extra;h<T;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;A=i.distcode[c&(1<<i.distbits)-1],g=A>>>24,y=A>>>16&255,_=65535&A,!(g<=h);){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(!(240&y)){for(b=g,w=y,v=_;A=i.distcode[v+((c&(1<<b+w)-1)>>b)],g=A>>>24,y=A>>>16&255,_=65535&A,!(b+g<=h);){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}c>>>=b,h-=b,i.back+=b}if(c>>>=g,h-=g,i.back+=g,64&y){e.msg="invalid distance code",i.mode=Et;break}i.offset=_,i.extra=15&y,i.mode=16203;case 16203:if(i.extra){for(T=i.extra;h<T;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Et;break}i.mode=16204;case 16204:if(0===l)break e;if(m=u-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Et;break}m>i.wnext?(m-=i.wnext,p=i.wsize-m):p=i.wnext-m,m>i.length&&(m=i.length),f=i.window}else f=r,p=o-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do{r[o++]=f[p++]}while(--m);0===i.length&&(i.mode=kt);break;case 16205:if(0===l)break e;r[o++]=i.length,l--,i.mode=kt;break;case Dt:if(i.wrap){for(;h<32;){if(0===a)break e;a--,c|=s[n++]<<h,h+=8}if(u-=l,e.total_out+=u,i.total+=u,4&i.wrap&&u&&(e.adler=i.check=i.flags?L(i.check,r,u,o-u):O(i.check,r,u,o-u)),u=l,4&i.wrap&&(i.flags?c:St(c))!==i.check){e.msg="incorrect data check",i.mode=Et;break}c=0,h=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;h<32;){if(0===a)break e;a--,c+=s[n++]<<h,h+=8}if(4&i.wrap&&c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Et;break}c=0,h=0}i.mode=16208;case 16208:x=ft;break e;case Et:x=_t;break e;case 16210:return bt;default:return yt}return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=c,i.bits=h,(i.wsize||u!==e.avail_out&&i.mode<Et&&(i.mode<Dt||t!==dt))&&Ft(e,e.output,e.next_out,u-e.avail_out),d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,i.total+=u,4&i.wrap&&u&&(e.adler=i.check=i.flags?L(i.check,r,u,e.next_out-u):O(i.check,r,u,e.next_out-u)),e.data_type=i.bits+(i.last?64:0)+(i.mode===At?128:0)+(i.mode===Tt||i.mode===Pt?256:0),(0===d&&0===u||t===dt)&&x===pt&&(x=wt),x},inflateEnd:e=>{if(Ut(e))return yt;let t=e.state;return t.window&&(t.window=null),e.state=null,pt},inflateGetHeader:(e,t)=>{if(Ut(e))return yt;const i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,pt):yt},inflateSetDictionary:(e,t)=>{const i=t.length;let s,r,n;return Ut(e)?yt:(s=e.state,0!==s.wrap&&s.mode!==xt?yt:s.mode===xt&&(r=1,r=O(r,t,i,0),r!==s.check)?_t:(n=Ft(e,t,i,i),n?(s.mode=16210,bt):(s.havedict=1,pt)))},inflateInfo:"pako inflate (from Nodeca project)"},$t=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const qt=Object.prototype.toString,{Z_NO_FLUSH:Zt,Z_FINISH:Xt,Z_OK:Wt,Z_STREAM_END:Qt,Z_NEED_DICT:Ht,Z_STREAM_ERROR:Yt,Z_DATA_ERROR:Jt,Z_MEM_ERROR:Kt}=N;function ei(e){this.options=ze({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let i=Gt.inflateInit2(this.strm,t.windowBits);if(i!==Wt)throw new Error(z[i]);if(this.header=new $t,Gt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ve(t.dictionary):"[object ArrayBuffer]"===qt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Gt.inflateSetDictionary(this.strm,t.dictionary),i!==Wt)))throw new Error(z[i])}function ti(e,t){const i=new ei(t);if(i.push(e),i.err)throw i.msg||z[i.err];return i.result}ei.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let n,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Xt:Zt,"[object ArrayBuffer]"===qt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),n=Gt.inflate(i,o),n===Ht&&r&&(n=Gt.inflateSetDictionary(i,r),n===Wt?n=Gt.inflate(i,o):n===Jt&&(n=Ht));i.avail_in>0&&n===Qt&&i.state.wrap>0&&0!==e[i.next_in];)Gt.inflateReset(i),n=Gt.inflate(i,o);switch(n){case Yt:case Jt:case Ht:case Kt:return this.onEnd(n),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||n===Qt))if("string"===this.options.to){let e=Ge(i.output,i.next_out),t=i.next_out-e,r=Fe(i.output,e);i.next_out=t,i.avail_out=s-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==Wt||0!==a){if(n===Qt)return n=Gt.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},ei.prototype.onData=function(e){this.chunks.push(e)},ei.prototype.onEnd=function(e){e===Wt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ne(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ii={Inflate:ei,inflate:ti,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ti(e,t)},ungzip:ti,constants:N};const{Deflate:si,deflate:ri,deflateRaw:ni,gzip:oi}=st,{Inflate:ai,inflate:li,inflateRaw:ci,ungzip:hi}=ii;var di=si,ui=ri,mi=ni,pi=oi,fi=ai,gi=li,yi=ci,_i=hi,bi=N,wi={Deflate:di,deflate:ui,deflateRaw:mi,gzip:pi,Inflate:fi,inflate:gi,inflateRaw:yi,ungzip:_i,constants:bi};e.Deflate=di,e.Inflate=fi,e.constants=bi,e.default=wi,e.deflate=ui,e.deflateRaw=mi,e.gzip=pi,e.inflate=gi,e.inflateRaw=yi,e.ungzip=_i,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?Fe(exports):"function"==typeof define&&define.amd?define(["exports"],Fe):Fe((Ve="undefined"!=typeof globalThis?globalThis:Ve||self).pako={});var Ge=Object.freeze({__proto__:null});let $e=window.pako||Ge;$e.inflate||($e=$e.default);const qe=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Ze={version:1,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}(i),a=function(e){return{positions:new Uint16Array($e.inflate(e.positions).buffer),normals:new Int8Array($e.inflate(e.normals).buffer),indices:new Uint32Array($e.inflate(e.indices).buffer),edgeIndices:new Uint32Array($e.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array($e.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array($e.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array($e.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array($e.inflate(e.meshColors).buffer),entityIDs:$e.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array($e.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array($e.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array($e.inflate(e.positionsDecodeMatrix).buffer)}}(o);!function(e,t,i,s,r,n){n.getNextId(),s.positionsCompression="precompressed",s.normalsCompression="precompressed";const o=i.positions,a=i.normals,l=i.indices,c=i.edgeIndices,h=i.meshPositions,u=i.meshIndices,m=i.meshEdgesIndices,p=i.meshColors,f=JSON.parse(i.entityIDs),g=i.entityMeshes,y=i.entityIsObjects,_=h.length,w=g.length;for(let e=0;e<w;e++){const n=f[e],v=t.globalizeObjectIds?b.globalizeObjectId(s.id,n):n,M=r.getMetaObject(v),x={},A={};if(M){if(t.excludeTypesMap&&M.type&&t.excludeTypesMap[M.type])continue;if(t.includeTypesMap&&M.type&&!t.includeTypesMap[M.type])continue;const e=t.objectDefaults?t.objectDefaults[M.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(x.visible=!1),!1===e.pickable&&(x.pickable=!1),e.colorize&&(A.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(A.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const I=e===w-1,P=[];for(let t=g[e],r=I?g.length:g[e+1];t<r;t++){const e=t===_-1,r=v+".mesh."+t,n=qe(p.subarray(4*t,4*t+3)),f=p[4*t+3]/255;s.createMesh(d.apply(A,{id:r,primitive:"triangles",positionsCompressed:o.subarray(h[t],e?o.length:h[t+1]),normalsCompressed:a.subarray(h[t],e?o.length:h[t+1]),indices:l.subarray(u[t],e?l.length:u[t+1]),edgeIndices:c.subarray(m[t],e?c.length:m[t+1]),positionsDecodeMatrix:i.positionsDecodeMatrix,color:n,opacity:f})),P.push(r)}s.createEntity(d.apply(x,{id:v,isObject:1===y[e],meshIds:P}))}}(0,t,a,s,r,n)}};let Xe=window.pako||Ge;Xe.inflate||(Xe=Xe.default);const We=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Qe={version:2,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}(i),a=function(e){return{positions:new Uint16Array(Xe.inflate(e.positions).buffer),normals:new Int8Array(Xe.inflate(e.normals).buffer),indices:new Uint32Array(Xe.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Xe.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Xe.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Xe.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Xe.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Xe.inflate(e.meshColors).buffer),entityIDs:Xe.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Xe.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Xe.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Xe.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Xe.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Xe.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Xe.inflate(e.entityUsesInstancing).buffer)}}(o);!function(e,t,i,s,r,n){const o=n.getNextId();s.positionsCompression="precompressed",s.normalsCompression="precompressed";const a=i.positions,l=i.normals,c=i.indices,h=i.edgeIndices,u=i.meshPositions,m=i.meshIndices,p=i.meshEdgesIndices,f=i.meshColors,g=JSON.parse(i.entityIDs),y=i.entityMeshes,_=i.entityIsObjects,w=i.entityMeshIds,v=i.entityMatrices,M=i.entityUsesInstancing,x=u.length,A=y.length,I={};for(let e=0;e<A;e++){const P=g[e],T=t.globalizeObjectIds?b.globalizeObjectId(s.id,P):P,k=r.getMetaObject(T),D={},E={},S=v.subarray(16*e,16*e+16);if(k){if(t.excludeTypesMap&&k.type&&t.excludeTypesMap[k.type])continue;if(t.includeTypesMap&&k.type&&!t.includeTypesMap[k.type])continue;const e=t.objectDefaults?t.objectDefaults[k.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(D.visible=!1),!1===e.pickable&&(D.pickable=!1),e.colorize&&(E.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(E.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const B=e===A-1,U=[];for(let t=y[e],r=B?w.length:y[e+1];t<r;t++){const r=w[t],g=r===x-1,y=n.getNextId(),_=We(f.subarray(4*r,4*r+3)),b=f[4*r+3]/255,v=a.subarray(u[r],g?a.length:u[r+1]),A=l.subarray(u[r],g?a.length:u[r+1]),P=c.subarray(m[r],g?c.length:m[r+1]),T=h.subarray(p[r],g?h.length:p[r+1]);if(1===M[e]){const e=`${o}.geometry.${y}.${r}`;e in I||(s.createGeometry({id:e,positionsCompressed:v,normalsCompressed:A,indices:P,edgeIndices:T,primitive:"triangles",positionsDecodeMatrix:i.positionsDecodeMatrix}),I[e]=!0),s.createMesh(d.apply(E,{id:y,color:_,opacity:b,matrix:S,geometryId:e})),U.push(y)}else s.createMesh(d.apply(E,{id:y,primitive:"triangles",positionsCompressed:v,normalsCompressed:A,indices:P,edgeIndices:T,positionsDecodeMatrix:i.positionsDecodeMatrix,color:_,opacity:b})),U.push(y)}U.length&&s.createEntity(d.apply(D,{id:T,isObject:1===_[e],meshIds:U}))}}(0,t,a,s,r,n)}};let He=window.pako||Ge;He.inflate||(He=He.default);const Ye=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Je={version:3,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}(i),a=function(e){return{positions:new Uint16Array(He.inflate(e.positions).buffer),normals:new Int8Array(He.inflate(e.normals).buffer),indices:new Uint32Array(He.inflate(e.indices).buffer),edgeIndices:new Uint32Array(He.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(He.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(He.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(He.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(He.inflate(e.meshColors).buffer),entityIDs:He.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(He.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(He.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(He.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(He.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(He.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(He.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(He.inflate(e.entityUsesInstancing).buffer)}}(o);!function(e,t,i,s,r,n){const o=n.getNextId();s.positionsCompression="precompressed",s.normalsCompression="precompressed";const a=i.positions,l=i.normals,c=i.indices,h=i.edgeIndices,u=i.meshPositions,m=i.meshIndices,p=i.meshEdgesIndices,f=i.meshColors,g=JSON.parse(i.entityIDs),y=i.entityMeshes,_=i.entityIsObjects,w=i.entityMeshIds,v=i.entityMatrices,M=i.entityUsesInstancing,x=u.length,A=y.length,I={};for(let e=0;e<A;e++){const n=g[e],S=t.globalizeObjectIds?b.globalizeObjectId(s.id,n):n,B=r.getMetaObject(S),U={},O={},C=v.subarray(16*e,16*e+16);if(B){if(t.excludeTypesMap&&B.type&&t.excludeTypesMap[B.type])continue;if(t.includeTypesMap&&B.type&&!t.includeTypesMap[B.type])continue;const e=t.objectDefaults?t.objectDefaults[B.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(U.visible=!1),!1===e.pickable&&(U.pickable=!1),e.colorize&&(O.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(O.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const L=e===A-1,z=[];for(let t=y[e],r=L?w.length:y[e+1];t<r;t++){var P=w[t];const r=P===x-1,n=`${o}.${S}.mesh.${P}`,g=Ye(f.subarray(4*P,4*P+3)),y=f[4*P+3]/255;var T=a.subarray(u[P],r?a.length:u[P+1]),k=l.subarray(u[P],r?a.length:u[P+1]),D=c.subarray(m[P],r?c.length:m[P+1]),E=h.subarray(p[P],r?h.length:p[P+1]);if(1===M[e]){const e=`${o}.geometry.${n}.${P}`;e in I||(s.createGeometry({id:e,positionsCompressed:T,normalsCompressed:k,indices:D,edgeIndices:E,primitive:"triangles",positionsDecodeMatrix:i.instancedPositionsDecodeMatrix}),I[e]=!0),s.createMesh(d.apply(O,{id:n,color:g,opacity:y,matrix:C,geometryId:e})),z.push(n)}else s.createMesh(d.apply(O,{id:n,primitive:"triangles",positionsCompressed:T,normalsCompressed:k,indices:D,edgeIndices:E,positionsDecodeMatrix:i.batchedPositionsDecodeMatrix,color:g,opacity:y})),z.push(n)}z.length&&s.createEntity(d.apply(U,{id:S,isObject:1===_[e],meshIds:z}))}}(0,t,a,s,r,n)}};let Ke=window.pako||Ge;Ke.inflate||(Ke=Ke.default);const et=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const tt={version:4,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}(i),a=function(e){return{positions:new Uint16Array(Ke.inflate(e.positions).buffer),normals:new Int8Array(Ke.inflate(e.normals).buffer),indices:new Uint32Array(Ke.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Ke.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(Ke.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(Ke.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Ke.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Ke.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Ke.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(Ke.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(Ke.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Ke.inflate(e.primitiveInstances).buffer),eachEntityId:Ke.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Ke.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Ke.inflate(e.eachEntityMatricesPortion).buffer)}}(o);!function(e,t,i,s,r,n){const o=n.getNextId();s.positionsCompression="precompressed",s.normalsCompression="precompressed";const a=i.positions,l=i.normals,c=i.indices,h=i.edgeIndices,u=i.decodeMatrices,m=i.matrices,p=i.eachPrimitivePositionsAndNormalsPortion,f=i.eachPrimitiveIndicesPortion,g=i.eachPrimitiveEdgeIndicesPortion,y=i.eachPrimitiveDecodeMatricesPortion,_=i.eachPrimitiveColor,b=i.primitiveInstances,w=JSON.parse(i.eachEntityId),v=i.eachEntityPrimitiveInstancesPortion,M=i.eachEntityMatricesPortion,x=p.length,A=b.length,I=new Uint8Array(x),P=new Uint32Array(x),T=w.length;for(let e=0;e<x;e++)P[e]=e;P.sort(((e,t)=>y[e]<y[t]?-1:y[e]>y[t]?1:0));for(let e=0;e<A;e++)I[b[e]]++;const k={};for(let e=0;e<T;e++){const t=T-1,i=e===t,s=v[e],r=i?v[t]:v[e+1];for(let t=s;t<r;t++){const i=b[t];I[i]>1||(k[i]=e)}}for(let e=0;e<x;e++){const t=P[e],i=t===x-1,r=I[t]>1,n=et(_.subarray(4*t,4*t+3)),m=_[4*t+3]/255,b=a.subarray(p[t],i?a.length:p[t+1]),v=l.subarray(p[t],i?l.length:p[t+1]),M=c.subarray(f[t],i?c.length:f[t+1]),A=h.subarray(g[t],i?h.length:g[t+1]),T=u.subarray(y[t],y[t]+16);if(r){const e=`${o}-geometry.${t}`;s.createGeometry({id:e,primitive:"triangles",positionsCompressed:b,normalsCompressed:v,indices:M,edgeIndices:A,positionsDecodeMatrix:T})}else{const e=`${o}-${t}`;w[k[t]];const i={};s.createMesh(d.apply(i,{id:e,primitive:"triangles",positionsCompressed:b,normalsCompressed:v,indices:M,edgeIndices:A,positionsDecodeMatrix:T,color:n,opacity:m}))}}let D=0;for(let e=0;e<T;e++){const t=T-1,i=e===t,r=w[e],n=v[e],a=i?v[t]:v[e+1],l=[];for(let t=n;t<a;t++){const i=b[t];if(I[i]>1){const t={},r=`${o}-instance.${D++}`,n=`${o}-geometry.${i}`,a=16*M[e],c=m.subarray(a,a+16);s.createMesh(d.apply(t,{id:r,geometryId:n,matrix:c})),l.push(r)}else l.push(i)}if(l.length>0){const e={};s.createEntity(d.apply(e,{id:r,isObject:!0,meshIds:l}))}}}(0,0,a,s,0,n)}};let it=window.pako||Ge;it.inflate||(it=it.default);const st=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const rt={version:5,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}(i),a=function(e){return{positions:new Float32Array(it.inflate(e.positions).buffer),normals:new Int8Array(it.inflate(e.normals).buffer),indices:new Uint32Array(it.inflate(e.indices).buffer),edgeIndices:new Uint32Array(it.inflate(e.edgeIndices).buffer),matrices:new Float32Array(it.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(it.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(it.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(it.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(it.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(it.inflate(e.primitiveInstances).buffer),eachEntityId:it.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(it.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(it.inflate(e.eachEntityMatricesPortion).buffer)}}(o);!function(e,t,i,s,r,n){const o=n.getNextId();s.positionsCompression="disabled",s.normalsCompression="precompressed";const a=i.positions,l=i.normals,c=i.indices,h=i.edgeIndices,u=i.matrices,m=i.eachPrimitivePositionsAndNormalsPortion,p=i.eachPrimitiveIndicesPortion,f=i.eachPrimitiveEdgeIndicesPortion,g=i.eachPrimitiveColor,y=i.primitiveInstances,_=JSON.parse(i.eachEntityId),b=i.eachEntityPrimitiveInstancesPortion,w=i.eachEntityMatricesPortion,v=m.length,M=y.length,x=new Uint8Array(v),A=_.length;for(let e=0;e<M;e++)x[y[e]]++;const I={};for(let e=0;e<A;e++){const t=A-1,i=e===t,s=b[e],r=i?b[t]:b[e+1];for(let t=s;t<r;t++){const i=y[t];x[i]>1||(I[i]=e)}}for(let e=0;e<v;e++){const t=e===v-1,i=x[e]>1,r=st(g.subarray(4*e,4*e+3)),n=g[4*e+3]/255,u=a.subarray(m[e],t?a.length:m[e+1]),y=l.subarray(m[e],t?l.length:m[e+1]),b=c.subarray(p[e],t?c.length:p[e+1]),w=h.subarray(f[e],t?h.length:f[e+1]);if(i){const t=`${o}-geometry.${e}`;s.createGeometry({id:t,primitive:"triangles",positionsCompressed:u,normalsCompressed:y,indices:b,edgeIndices:w})}else{const t=e;_[I[e]];const i={};s.createMesh(d.apply(i,{id:t,primitive:"triangles",positionsCompressed:u,normalsCompressed:y,indices:b,edgeIndices:w,color:r,opacity:n}))}}let P=0;for(let e=0;e<A;e++){const t=A-1,i=e===t,r=_[e],n=b[e],o=i?b[t]:b[e+1],a=[];for(let t=n;t<o;t++){const i=y[t];if(x[i]>1){const t={},r="instance."+P++,n="geometry"+i,o=16*w[e],l=u.subarray(o,o+16);s.createMesh(d.apply(t,{id:r,geometryId:n,matrix:l})),a.push(r)}else a.push(i)}if(a.length>0){const e={};s.createEntity(d.apply(e,{id:r,isObject:!0,meshIds:a}))}}}(0,0,a,s,0,n)}};let nt=window.pako||Ge;nt.inflate||(nt=nt.default);const ot=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const at={version:6,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}(i),a=function(e){function t(e,t){return 0===e.length?[]:nt.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:nt.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(o);!function(e,t,i,s,r,n){const o=n.getNextId(),a=i.positions,l=i.normals,c=i.indices,h=i.edgeIndices,u=i.matrices,m=i.reusedPrimitivesDecodeMatrix,p=i.eachPrimitivePositionsAndNormalsPortion,f=i.eachPrimitiveIndicesPortion,g=i.eachPrimitiveEdgeIndicesPortion,y=i.eachPrimitiveColorAndOpacity,_=i.primitiveInstances,w=JSON.parse(i.eachEntityId),v=i.eachEntityPrimitiveInstancesPortion,M=i.eachEntityMatricesPortion,x=i.eachTileAABB,A=i.eachTileEntitiesPortion,I=p.length,P=_.length,T=w.length,k=A.length,D=new Uint32Array(I);for(let e=0;e<P;e++){const t=_[e];void 0!==D[t]?D[t]++:D[t]=1}const E=b.vec3(),S=b.AABB3();for(let e=0;e<k;e++){const i=e===k-1,P=A[e],B=i?T:A[e+1],U=6*e,O=x.subarray(U,U+6);b.getAABB3Center(O,E),S[0]=O[0]-E[0],S[1]=O[1]-E[1],S[2]=O[2]-E[2],S[3]=O[3]-E[0],S[4]=O[4]-E[1],S[5]=O[5]-E[2];const C=fe.createPositionsDecodeMatrix(S),L={};for(let i=P;i<B;i++){const x=w[i],A=t.globalizeObjectIds?b.globalizeObjectId(s.id,x):x,P=M[i],k=u.slice(P,P+16),S=i===T-1,B=v[i],U=S?_.length:v[i+1],O=[],z=r.getMetaObject(A),N={},R={};if(z){if(t.excludeTypesMap&&z.type&&t.excludeTypesMap[z.type])continue;if(t.includeTypesMap&&z.type&&!t.includeTypesMap[z.type])continue;const e=t.objectDefaults?t.objectDefaults[z.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(N.visible=!1),!1===e.pickable&&(N.pickable=!1),e.colorize&&(R.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(R.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(let t=B;t<U;t++){const i=_[t],r=D[i]>1,u=i===I-1,b=a.subarray(p[i],u?a.length:p[i+1]),w=l.subarray(p[i],u?l.length:p[i+1]),v=c.subarray(f[i],u?c.length:f[i+1]),M=h.subarray(g[i],u?h.length:g[i+1]),x=ot(y.subarray(4*i,4*i+3)),A=y[4*i+3]/255,P=n.getNextId();if(r){const t=`${o}-geometry.${e}.${i}`;L[t]||(s.createGeometry({id:t,primitive:"triangles",positionsCompressed:b,indices:v,edgeIndices:M,positionsDecodeMatrix:m}),L[t]=!0),s.createMesh(d.apply(R,{id:P,geometryId:t,origin:E,matrix:k,color:x,opacity:A})),O.push(P)}else s.createMesh(d.apply(R,{id:P,origin:E,primitive:"triangles",positionsCompressed:b,normalsCompressed:w,indices:v,edgeIndices:M,positionsDecodeMatrix:C,color:x,opacity:A})),O.push(P)}O.length>0&&s.createEntity(d.apply(N,{id:A,isObject:!0,meshIds:O}))}}}(0,t,a,s,r,n)}};let lt=window.pako||Ge;lt.inflate||(lt=lt.default);const ct=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function ht(e){const t=[];for(let i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}const dt={version:7,parse:function(e,t,i,s,r,n){const o=function(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}(i),a=function(e){function t(e,t){return 0===e.length?[]:lt.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:lt.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(o);!function(e,t,i,s,r,n){const o=n.getNextId(),a=i.positions,l=i.normals,c=i.colors,h=i.indices,u=i.edgeIndices,m=i.matrices,p=i.reusedGeometriesDecodeMatrix,f=i.eachGeometryPrimitiveType,g=i.eachGeometryPositionsPortion,y=i.eachGeometryNormalsPortion,_=i.eachGeometryColorsPortion,w=i.eachGeometryIndicesPortion,v=i.eachGeometryEdgeIndicesPortion,M=i.eachMeshGeometriesPortion,x=i.eachMeshMatricesPortion,A=i.eachMeshMaterial,I=JSON.parse(i.eachEntityId),P=i.eachEntityMeshesPortion,T=i.eachTileAABB,k=i.eachTileEntitiesPortion,D=g.length,E=M.length,S=I.length,B=k.length,U=new Uint32Array(D);for(let e=0;e<E;e++){const t=M[e];void 0!==U[t]?U[t]++:U[t]=1}const O=b.vec3(),C=b.AABB3();for(let e=0;e<B;e++){const i=e===B-1,E=k[e],L=i?S:k[e+1],z=6*e,N=T.subarray(z,z+6);b.getAABB3Center(N,O),C[0]=N[0]-O[0],C[1]=N[1]-O[1],C[2]=N[2]-O[2],C[3]=N[3]-O[0],C[4]=N[4]-O[1],C[5]=N[5]-O[2];const R=fe.createPositionsDecodeMatrix(C),j={};for(let i=E;i<L;i++){const T=I[i],k=t.globalizeObjectIds?b.globalizeObjectId(s.id,T):T,E=i===S-1,B=P[i],C=E?M.length:P[i+1],L=[],z=r.getMetaObject(k),N={},V={};if(z){if(t.excludeTypesMap&&z.type&&t.excludeTypesMap[z.type])continue;if(t.includeTypesMap&&z.type&&!t.includeTypesMap[z.type])continue;const e=t.objectDefaults?t.objectDefaults[z.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(N.visible=!1),!1===e.pickable&&(N.pickable=!1),e.colorize&&(V.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(V.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(V.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(V.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let t=B;t<C;t++){const i=M[t],r=U[i]>1,b=i===D-1,I=ct(A.subarray(6*t,6*t+3)),P=A[6*t+3]/255,T=A[6*t+4]/255,k=A[6*t+5]/255,E=n.getNextId();if(r){const r=x[t],n=m.slice(r,r+16),M=`${o}-geometry.${e}.${i}`;if(!j[M]){let e,t,r,n,o,d;switch(f[i]){case 0:e="solid",t=a.subarray(g[i],b?a.length:g[i+1]),r=l.subarray(y[i],b?l.length:y[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]),d=u.subarray(v[i],b?u.length:v[i+1]);break;case 1:e="surface",t=a.subarray(g[i],b?a.length:g[i+1]),r=l.subarray(y[i],b?l.length:y[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]),d=u.subarray(v[i],b?u.length:v[i+1]);break;case 2:e="points",t=a.subarray(g[i],b?a.length:g[i+1]),n=ht(c.subarray(_[i],b?c.length:_[i+1]));break;case 3:e="lines",t=a.subarray(g[i],b?a.length:g[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]);break;default:continue}s.createGeometry({id:M,primitive:e,positionsCompressed:t,normalsCompressed:r,colors:n,indices:o,edgeIndices:d,positionsDecodeMatrix:p}),j[M]=!0}s.createMesh(d.apply(V,{id:E,geometryId:M,origin:O,matrix:n,color:I,metallic:T,roughness:k,opacity:P})),L.push(E)}else{let e,t,r,n,o,m;switch(f[i]){case 0:e="solid",t=a.subarray(g[i],b?a.length:g[i+1]),r=l.subarray(y[i],b?l.length:y[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]),m=u.subarray(v[i],b?u.length:v[i+1]);break;case 1:e="surface",t=a.subarray(g[i],b?a.length:g[i+1]),r=l.subarray(y[i],b?l.length:y[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]),m=u.subarray(v[i],b?u.length:v[i+1]);break;case 2:e="points",t=a.subarray(g[i],b?a.length:g[i+1]),n=ht(c.subarray(_[i],b?c.length:_[i+1]));break;case 3:e="lines",t=a.subarray(g[i],b?a.length:g[i+1]),o=h.subarray(w[i],b?h.length:w[i+1]);break;default:continue}s.createMesh(d.apply(V,{id:E,origin:O,primitive:e,positionsCompressed:t,normalsCompressed:r,colors:n,indices:o,edgeIndices:m,positionsDecodeMatrix:R,color:I,metallic:T,roughness:k,opacity:P})),L.push(E)}}L.length>0&&s.createEntity(d.apply(N,{id:k,isObject:!0,meshIds:L}))}}}(0,t,a,s,r,n)}};let ut=window.pako||Ge;ut.inflate||(ut=ut.default);const mt=b.vec4(),pt=b.vec4();const ft=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function gt(e){const t=[];for(let i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}const yt={version:8,parse:function(e,t,i,s,r,n){const o=function(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}(i),a=function(e){function t(e,t){return 0===e.length?[]:ut.inflate(e,t).buffer}return{types:ut.inflate(e.types,{to:"string"}),eachMetaObjectId:ut.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:ut.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(o);!function(e,t,i,s,r,n){const o=n.getNextId(),a=JSON.parse(i.types),l=JSON.parse(i.eachMetaObjectId),c=i.eachMetaObjectType,h=JSON.parse(i.eachMetaObjectName),u=i.eachMetaObjectParent,m=i.positions,p=i.normals,f=i.colors,g=i.indices,y=i.edgeIndices,_=i.matrices,w=i.reusedGeometriesDecodeMatrix,v=i.eachGeometryPrimitiveType,M=i.eachGeometryPositionsPortion,x=i.eachGeometryNormalsPortion,A=i.eachGeometryColorsPortion,I=i.eachGeometryIndicesPortion,P=i.eachGeometryEdgeIndicesPortion,T=i.eachMeshGeometriesPortion,k=i.eachMeshMatricesPortion,D=i.eachMeshMaterial,E=i.eachEntityMetaObject,S=i.eachEntityMeshesPortion,B=i.eachTileAABB,U=i.eachTileEntitiesPortion,O=l.length,C=M.length,L=T.length,z=E.length,N=U.length;if(r){const e={metaObjects:[]};for(let t=0;t<O;t++){const i=l[t],s=a[c[t]]||"default",r=h[t],n=u[t],o=n!==t?l[n]:null;e.metaObjects.push({id:i,type:s,name:r,parent:o})}r.loadData(e,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds})}const R=new Uint32Array(C);for(let e=0;e<L;e++){const t=T[e];void 0!==R[t]?R[t]++:R[t]=1}const j=b.vec3(),V=b.AABB3(),F={};for(let e=0;e<N;e++){const i=e===N-1,a=U[e],c=i?z:U[e+1],h=6*e,u=B.subarray(h,h+6);b.getAABB3Center(u,j),V[0]=u[0]-j[0],V[1]=u[1]-j[1],V[2]=u[2]-j[2],V[3]=u[3]-j[0],V[4]=u[4]-j[1],V[5]=u[5]-j[2];const O=fe.createPositionsDecodeMatrix(V),L={};for(let i=a;i<c;i++){const a=l[E[i]],c=t.globalizeObjectIds?b.globalizeObjectId(s.id,a):a,h=i===z-1,u=S[i],B=h?T.length:S[i+1],U=[],N=r.getMetaObject(c),G={},$={};if(N){if(t.excludeTypesMap&&N.type&&t.excludeTypesMap[N.type])continue;if(t.includeTypesMap&&N.type&&!t.includeTypesMap[N.type])continue;const e=t.objectDefaults?t.objectDefaults[N.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(G.visible=!1),!1===e.pickable&&(G.pickable=!1),e.colorize&&($.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&($.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&($.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&($.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let i=u;i<B;i++){const r=T[i],a=R[r]>1,l=r===C-1,c=ft(D.subarray(6*i,6*i+3)),h=D[6*i+3]/255,u=D[6*i+4]/255,E=D[6*i+5]/255,S=n.getNextId();if(a){const n=k[i],a=_.slice(n,n+16),T=`${o}-geometry.${e}.${r}`;let D=F[T];if(!D){D={batchThisMesh:!t.reuseGeometries};let e=!1;switch(v[r]){case 0:D.primitiveName="solid",D.geometryPositions=m.subarray(M[r],l?m.length:M[r+1]),D.geometryNormals=p.subarray(x[r],l?p.length:x[r+1]),D.geometryIndices=g.subarray(I[r],l?g.length:I[r+1]),D.geometryEdgeIndices=y.subarray(P[r],l?y.length:P[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 1:D.primitiveName="surface",D.geometryPositions=m.subarray(M[r],l?m.length:M[r+1]),D.geometryNormals=p.subarray(x[r],l?p.length:x[r+1]),D.geometryIndices=g.subarray(I[r],l?g.length:I[r+1]),D.geometryEdgeIndices=y.subarray(P[r],l?y.length:P[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 2:D.primitiveName="points",D.geometryPositions=m.subarray(M[r],l?m.length:M[r+1]),D.geometryColors=gt(f.subarray(A[r],l?f.length:A[r+1])),e=D.geometryPositions.length>0;break;case 3:D.primitiveName="lines",D.geometryPositions=m.subarray(M[r],l?m.length:M[r+1]),D.geometryIndices=g.subarray(I[r],l?g.length:I[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;default:continue}if(e||(D=null),D&&(D.geometryPositions.length,D.batchThisMesh)){D.decompressedPositions=new Float32Array(D.geometryPositions.length);const e=D.geometryPositions,t=D.decompressedPositions;for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]*w[0]+w[12],t[i+1]=e[i+1]*w[5]+w[13],t[i+2]=e[i+2]*w[10]+w[14];D.geometryPositions=null,F[T]=D}}if(D)if(D.batchThisMesh){const e=D.decompressedPositions,t=new Uint16Array(e.length);for(let i=0,s=e.length;i<s;i+=3)mt[0]=e[i+0],mt[1]=e[i+1],mt[2]=e[i+2],mt[3]=1,b.transformVec4(a,mt,pt),fe.compressPosition(pt,V,mt),t[i+0]=mt[0],t[i+1]=mt[1],t[i+2]=mt[2];s.createMesh(d.apply($,{id:S,origin:j,primitive:D.primitiveName,positionsCompressed:t,normalsCompressed:D.geometryNormals,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:O,color:c,metallic:u,roughness:E,opacity:h})),U.push(S)}else L[T]||(s.createGeometry({id:T,primitive:D.primitiveName,positionsCompressed:D.geometryPositions,normalsCompressed:D.geometryNormals,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:w}),L[T]=!0),s.createMesh(d.apply($,{id:S,geometryId:T,origin:j,matrix:a,color:c,metallic:u,roughness:E,opacity:h})),U.push(S)}else{let e,t,i,n,o,a,_=!1;switch(v[r]){case 0:e="solid",t=m.subarray(M[r],l?m.length:M[r+1]),i=p.subarray(x[r],l?p.length:x[r+1]),o=g.subarray(I[r],l?g.length:I[r+1]),a=y.subarray(P[r],l?y.length:P[r+1]),_=t.length>0&&o.length>0;break;case 1:e="surface",t=m.subarray(M[r],l?m.length:M[r+1]),i=p.subarray(x[r],l?p.length:x[r+1]),o=g.subarray(I[r],l?g.length:I[r+1]),a=y.subarray(P[r],l?y.length:P[r+1]),_=t.length>0&&o.length>0;break;case 2:e="points",t=m.subarray(M[r],l?m.length:M[r+1]),n=gt(f.subarray(A[r],l?f.length:A[r+1])),_=t.length>0;break;case 3:e="lines",t=m.subarray(M[r],l?m.length:M[r+1]),o=g.subarray(I[r],l?g.length:I[r+1]),_=t.length>0&&o.length>0;break;default:continue}_&&(s.createMesh(d.apply($,{id:S,origin:j,primitive:e,positionsCompressed:t,normalsCompressed:i,colorsCompressed:n,indices:o,edgeIndices:a,positionsDecodeMatrix:O,color:c,metallic:u,roughness:E,opacity:h})),U.push(S))}}U.length>0&&s.createEntity(d.apply(G,{id:c,isObject:!0,meshIds:U}))}}}(0,t,a,s,r,n)}};let _t=window.pako||Ge;_t.inflate||(_t=_t.default);const bt=b.vec4(),wt=b.vec4();const vt=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Mt={version:9,parse:function(e,t,i,s,r,n){const o=function(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}(i),a=function(e){function t(e,t){return 0===e.length?[]:_t.inflate(e,t).buffer}return{metadata:JSON.parse(_t.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(_t.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(o);!function(e,t,i,s,r,n){const o=n.getNextId(),a=i.metadata,l=i.positions,c=i.normals,h=i.colors,u=i.indices,m=i.edgeIndices,p=i.matrices,f=i.reusedGeometriesDecodeMatrix,g=i.eachGeometryPrimitiveType,y=i.eachGeometryPositionsPortion,_=i.eachGeometryNormalsPortion,w=i.eachGeometryColorsPortion,v=i.eachGeometryIndicesPortion,M=i.eachGeometryEdgeIndicesPortion,x=i.eachMeshGeometriesPortion,A=i.eachMeshMatricesPortion,I=i.eachMeshMaterial,P=i.eachEntityId,T=i.eachEntityMeshesPortion,k=i.eachTileAABB,D=i.eachTileEntitiesPortion,E=y.length,S=x.length,B=T.length,U=D.length;r&&r.loadData(a,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});const O=new Uint32Array(E);for(let e=0;e<S;e++){const t=x[e];void 0!==O[t]?O[t]++:O[t]=1}const C=b.vec3(),L=b.AABB3(),z={};for(let e=0;e<U;e++){const i=e===U-1,a=D[e],S=i?B-1:D[e+1]-1,N=6*e,R=k.subarray(N,N+6);b.getAABB3Center(R,C),L[0]=R[0]-C[0],L[1]=R[1]-C[1],L[2]=R[2]-C[2],L[3]=R[3]-C[0],L[4]=R[4]-C[1],L[5]=R[5]-C[2];const j=fe.createPositionsDecodeMatrix(L),V={};for(let i=a;i<=S;i++){const a=P[i],k=t.globalizeObjectIds?b.globalizeObjectId(s.id,a):a,D=i===B-1,S=T[i],U=D?x.length-1:T[i+1]-1,N=[],R=r.getMetaObject(k),F={},G={};if(R){if(t.excludeTypesMap&&R.type&&t.excludeTypesMap[R.type])continue;if(t.includeTypesMap&&R.type&&!t.includeTypesMap[R.type])continue;const e=t.objectDefaults?t.objectDefaults[R.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(F.visible=!1),!1===e.pickable&&(F.pickable=!1),e.colorize&&(G.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(G.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(G.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(G.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let i=S;i<=U;i++){const r=x[i],a=O[r]>1,P=r===E-1,T=vt(I.subarray(6*i,6*i+3)),k=I[6*i+3]/255,D=I[6*i+4]/255,S=I[6*i+5]/255,B=n.getNextId();if(a){const n=A[i],a=p.slice(n,n+16),x=`${o}-geometry.${e}.${r}`;let I=z[x];if(!I){I={batchThisMesh:!t.reuseGeometries};let e=!1;switch(g[r]){case 0:I.primitiveName="solid",I.geometryPositions=l.subarray(y[r],P?l.length:y[r+1]),I.geometryNormals=c.subarray(_[r],P?c.length:_[r+1]),I.geometryIndices=u.subarray(v[r],P?u.length:v[r+1]),I.geometryEdgeIndices=m.subarray(M[r],P?m.length:M[r+1]),e=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 1:I.primitiveName="surface",I.geometryPositions=l.subarray(y[r],P?l.length:y[r+1]),I.geometryNormals=c.subarray(_[r],P?c.length:_[r+1]),I.geometryIndices=u.subarray(v[r],P?u.length:v[r+1]),I.geometryEdgeIndices=m.subarray(M[r],P?m.length:M[r+1]),e=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 2:I.primitiveName="points",I.geometryPositions=l.subarray(y[r],P?l.length:y[r+1]),I.geometryColors=h.subarray(w[r],P?h.length:w[r+1]),e=I.geometryPositions.length>0;break;case 3:I.primitiveName="lines",I.geometryPositions=l.subarray(y[r],P?l.length:y[r+1]),I.geometryIndices=u.subarray(v[r],P?u.length:v[r+1]),e=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;default:continue}if(e||(I=null),I&&(I.geometryPositions.length,I.batchThisMesh)){I.decompressedPositions=new Float32Array(I.geometryPositions.length),I.transformedAndRecompressedPositions=new Uint16Array(I.geometryPositions.length);const e=I.geometryPositions,t=I.decompressedPositions;for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]*f[0]+f[12],t[i+1]=e[i+1]*f[5]+f[13],t[i+2]=e[i+2]*f[10]+f[14];I.geometryPositions=null,z[x]=I}}if(I)if(I.batchThisMesh){const e=I.decompressedPositions,t=I.transformedAndRecompressedPositions;for(let i=0,s=e.length;i<s;i+=3)bt[0]=e[i+0],bt[1]=e[i+1],bt[2]=e[i+2],bt[3]=1,b.transformVec4(a,bt,wt),fe.compressPosition(wt,L,bt),t[i+0]=bt[0],t[i+1]=bt[1],t[i+2]=bt[2];s.createMesh(d.apply(G,{id:B,origin:C,primitive:I.primitiveName,positionsCompressed:t,normalsCompressed:I.geometryNormals,colorsCompressed:I.geometryColors,indices:I.geometryIndices,edgeIndices:I.geometryEdgeIndices,positionsDecodeMatrix:j,color:T,metallic:D,roughness:S,opacity:k})),N.push(B)}else V[x]||(s.createGeometry({id:x,primitive:I.primitiveName,positionsCompressed:I.geometryPositions,normalsCompressed:I.geometryNormals,colorsCompressed:I.geometryColors,indices:I.geometryIndices,edgeIndices:I.geometryEdgeIndices,positionsDecodeMatrix:f}),V[x]=!0),s.createMesh(d.apply(G,{id:B,geometryId:x,origin:C,matrix:a,color:T,metallic:D,roughness:S,opacity:k})),N.push(B)}else{let e,t,i,n,o,a,p=!1;switch(g[r]){case 0:e="solid",t=l.subarray(y[r],P?l.length:y[r+1]),i=c.subarray(_[r],P?c.length:_[r+1]),o=u.subarray(v[r],P?u.length:v[r+1]),a=m.subarray(M[r],P?m.length:M[r+1]),p=t.length>0&&o.length>0;break;case 1:e="surface",t=l.subarray(y[r],P?l.length:y[r+1]),i=c.subarray(_[r],P?c.length:_[r+1]),o=u.subarray(v[r],P?u.length:v[r+1]),a=m.subarray(M[r],P?m.length:M[r+1]),p=t.length>0&&o.length>0;break;case 2:e="points",t=l.subarray(y[r],P?l.length:y[r+1]),n=h.subarray(w[r],P?h.length:w[r+1]),p=t.length>0;break;case 3:e="lines",t=l.subarray(y[r],P?l.length:y[r+1]),o=u.subarray(v[r],P?u.length:v[r+1]),p=t.length>0&&o.length>0;break;default:continue}p&&(s.createMesh(d.apply(G,{id:B,origin:C,primitive:e,positionsCompressed:t,normalsCompressed:i,colorsCompressed:n,indices:o,edgeIndices:a,positionsDecodeMatrix:j,color:T,metallic:D,roughness:S,opacity:k})),N.push(B))}}N.length>0&&s.createEntity(d.apply(F,{id:k,isObject:!0,meshIds:N}))}}}(0,t,a,s,r,n)}};let xt=window.pako||Ge;xt.inflate||(xt=xt.default);const At=b.vec4(),It=b.vec4();const Pt=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function Tt(e,t){const i=[];if(t.length>1)for(let e=0,s=t.length-1;e<s;e++)i.push(t[e]),i.push(t[e+1]);else if(e.length>1)for(let t=0,s=e.length/3-1;t<s;t++)i.push(t),i.push(t+1);return i}!function(){const e=document.createElement("canvas"),t=e.getContext("2d")}();const kt={version:10,parse:function(e,t,i,s,r,n){const o=function(e){let t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(i),a=function(e){function t(e,t){return 0===e.length?[]:xt.inflate(e,t).buffer}return{metadata:JSON.parse(xt.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(xt.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(o);!function(e,t,i,s,r,n){const o=n.getNextId(),a=i.metadata,l=i.textureData,c=i.eachTextureDataPortion,h=i.eachTextureAttributes,u=i.positions,m=i.normals,p=i.colors,f=i.uvs,g=i.indices,y=i.edgeIndices,_=i.eachTextureSetTextures,w=i.matrices,v=i.reusedGeometriesDecodeMatrix,M=i.eachGeometryPrimitiveType,x=i.eachGeometryPositionsPortion,A=i.eachGeometryNormalsPortion,I=i.eachGeometryColorsPortion,P=i.eachGeometryUVsPortion,T=i.eachGeometryIndicesPortion,k=i.eachGeometryEdgeIndicesPortion,D=i.eachMeshGeometriesPortion,E=i.eachMeshMatricesPortion,S=i.eachMeshTextureSet,B=i.eachMeshMaterialAttributes,U=i.eachEntityId,O=i.eachEntityMeshesPortion,C=i.eachTileAABB,L=i.eachTileEntitiesPortion,z=c.length,N=_.length/5,R=x.length,j=D.length,V=O.length,F=L.length;r&&r.loadData(a,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(let e=0;e<z;e++){const t=e===z-1,i=c[e],r=t?l.length:c[e+1],n=r-i>0,a=9*e,d=1===h[a+0],u=h[a+1];h[a+2],h[a+3];const m=h[a+4],p=h[a+5],f=h[a+6],g=h[a+7],y=h[a+8];if(n){const t=new Uint8Array(l.subarray(i,r)).buffer,n=`${o}-texture-${e}`;if(d)s.createTexture({id:n,buffers:[t],minFilter:m,magFilter:p,wrapS:f,wrapT:g,wrapR:y});else{const e=new Blob([t],{type:10001===u?"image/jpeg":10002===u?"image/png":"image/gif"}),i=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("img");r.src=i,s.createTexture({id:n,image:r,minFilter:m,magFilter:p,wrapS:f,wrapT:g,wrapR:y})}}}for(let e=0;e<N;e++){const t=5*e,i=`${o}-textureSet-${e}`,r=_[t+0],n=_[t+1],a=_[t+2],l=_[t+3],c=_[t+4];s.createTextureSet({id:i,colorTextureId:r>=0?`${o}-texture-${r}`:null,normalsTextureId:a>=0?`${o}-texture-${a}`:null,metallicRoughnessTextureId:n>=0?`${o}-texture-${n}`:null,emissiveTextureId:l>=0?`${o}-texture-${l}`:null,occlusionTextureId:c>=0?`${o}-texture-${c}`:null})}const G=new Uint32Array(R);for(let e=0;e<j;e++){const t=D[e];void 0!==G[t]?G[t]++:G[t]=1}const $=b.vec3(),q=b.AABB3(),Z={};for(let e=0;e<F;e++){const i=e===F-1,a=L[e],l=i?V-1:L[e+1]-1,c=6*e,h=C.subarray(c,c+6);b.getAABB3Center(h,$),q[0]=h[0]-$[0],q[1]=h[1]-$[1],q[2]=h[2]-$[2],q[3]=h[3]-$[0],q[4]=h[4]-$[1],q[5]=h[5]-$[2];const _=fe.createPositionsDecodeMatrix(q),z={};for(let i=a;i<=l;i++){const a=U[i],l=t.globalizeObjectIds?b.globalizeObjectId(s.id,a):a,c=i===V-1,h=O[i],C=c?D.length-1:O[i+1]-1,L=[],N=r.getMetaObject(l),j={},F={};if(N){if(t.excludeTypesMap&&N.type&&t.excludeTypesMap[N.type])continue;if(t.includeTypesMap&&N.type&&!t.includeTypesMap[N.type])continue;const e=t.objectDefaults?t.objectDefaults[N.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(j.visible=!1),!1===e.pickable&&(j.pickable=!1),e.colorize&&(F.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(F.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(F.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(F.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let i=h;i<=C;i++){const r=D[i],a=G[r]>1,l=r===R-1,c=S[i],h=c>=0?`${o}-textureSet-${c}`:null,U=Pt(B.subarray(6*i,6*i+3)),O=B[6*i+3]/255,C=B[6*i+4]/255,N=B[6*i+5]/255,j=n.getNextId();if(a){const n=E[i],a=w.slice(n,n+16),c=`${o}-geometry.${e}.${r}`;let D=Z[c];if(!D){D={batchThisMesh:!t.reuseGeometries};let e=!1;switch(M[r]){case 0:D.primitiveName="solid",D.geometryPositions=u.subarray(x[r],l?u.length:x[r+1]),D.geometryNormals=m.subarray(A[r],l?m.length:A[r+1]),D.geometryUVs=f.subarray(P[r],l?f.length:P[r+1]),D.geometryIndices=g.subarray(T[r],l?g.length:T[r+1]),D.geometryEdgeIndices=y.subarray(k[r],l?y.length:k[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 1:D.primitiveName="surface",D.geometryPositions=u.subarray(x[r],l?u.length:x[r+1]),D.geometryNormals=m.subarray(A[r],l?m.length:A[r+1]),D.geometryUVs=f.subarray(P[r],l?f.length:P[r+1]),D.geometryIndices=g.subarray(T[r],l?g.length:T[r+1]),D.geometryEdgeIndices=y.subarray(k[r],l?y.length:k[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 2:D.primitiveName="points",D.geometryPositions=u.subarray(x[r],l?u.length:x[r+1]),D.geometryColors=p.subarray(I[r],l?p.length:I[r+1]),e=D.geometryPositions.length>0;break;case 3:D.primitiveName="lines",D.geometryPositions=u.subarray(x[r],l?u.length:x[r+1]),D.geometryIndices=g.subarray(T[r],l?g.length:T[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 4:D.primitiveName="lines",D.geometryPositions=u.subarray(x[r],l?u.length:x[r+1]),D.geometryIndices=Tt(D.geometryPositions,g.subarray(T[r],l?g.length:T[r+1])),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;default:continue}if(e||(D=null),D&&(D.geometryPositions.length,D.batchThisMesh)){D.decompressedPositions=new Float32Array(D.geometryPositions.length),D.transformedAndRecompressedPositions=new Uint16Array(D.geometryPositions.length);const e=D.geometryPositions,t=D.decompressedPositions;for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]*v[0]+v[12],t[i+1]=e[i+1]*v[5]+v[13],t[i+2]=e[i+2]*v[10]+v[14];D.geometryPositions=null,Z[c]=D}}if(D)if(D.batchThisMesh){const e=D.decompressedPositions,t=D.transformedAndRecompressedPositions;for(let i=0,s=e.length;i<s;i+=3)At[0]=e[i+0],At[1]=e[i+1],At[2]=e[i+2],At[3]=1,b.transformVec4(a,At,It),fe.compressPosition(It,q,At),t[i+0]=At[0],t[i+1]=At[1],t[i+2]=At[2];s.createMesh(d.apply(F,{id:j,textureSetId:h,origin:$,primitive:D.primitiveName,positionsCompressed:t,normalsCompressed:D.geometryNormals,uv:D.geometryUVs,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:_,color:U,metallic:C,roughness:N,opacity:O})),L.push(j)}else z[c]||(s.createGeometry({id:c,primitive:D.primitiveName,positionsCompressed:D.geometryPositions,normalsCompressed:D.geometryNormals,uv:D.geometryUVs,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:v}),z[c]=!0),s.createMesh(d.apply(F,{id:j,geometryId:c,textureSetId:h,matrix:a,color:U,metallic:C,roughness:N,opacity:O,origin:$})),L.push(j)}else{let e,t,i,n,o,a,c,b=!1;switch(M[r]){case 0:e="solid",t=u.subarray(x[r],l?u.length:x[r+1]),i=m.subarray(A[r],l?m.length:A[r+1]),n=f.subarray(P[r],l?f.length:P[r+1]),a=g.subarray(T[r],l?g.length:T[r+1]),c=y.subarray(k[r],l?y.length:k[r+1]),b=t.length>0&&a.length>0;break;case 1:e="surface",t=u.subarray(x[r],l?u.length:x[r+1]),i=m.subarray(A[r],l?m.length:A[r+1]),n=f.subarray(P[r],l?f.length:P[r+1]),a=g.subarray(T[r],l?g.length:T[r+1]),c=y.subarray(k[r],l?y.length:k[r+1]),b=t.length>0&&a.length>0;break;case 2:e="points",t=u.subarray(x[r],l?u.length:x[r+1]),o=p.subarray(I[r],l?p.length:I[r+1]),b=t.length>0;break;case 3:e="lines",t=u.subarray(x[r],l?u.length:x[r+1]),a=g.subarray(T[r],l?g.length:T[r+1]),b=t.length>0&&a.length>0;break;case 4:e="lines",t=u.subarray(x[r],l?u.length:x[r+1]),a=Tt(t,g.subarray(T[r],l?g.length:T[r+1])),b=t.length>0&&a.length>0;break;default:continue}b&&(s.createMesh(d.apply(F,{id:j,textureSetId:h,origin:$,primitive:e,positionsCompressed:t,normalsCompressed:i,uv:n&&n.length>0?n:null,colorsCompressed:o,indices:a,edgeIndices:c,positionsDecodeMatrix:_,color:U,metallic:C,roughness:N,opacity:O})),L.push(j))}}L.length>0&&s.createEntity(d.apply(j,{id:l,isObject:!0,meshIds:L}))}}}(0,t,a,s,r,n)}},Dt={};Dt[Ze.version]=Ze,Dt[Qe.version]=Qe,Dt[Je.version]=Je,Dt[tt.version]=tt,Dt[rt.version]=rt,Dt[at.version]=at,Dt[dt.version]=dt,Dt[yt.version]=yt,Dt[Mt.version]=Mt,Dt[kt.version]=kt;return class extends Ne{constructor(e={}){super("XKTLoader",void 0,e),this._maxGeometryBatchSize=e.maxGeometryBatchSize,this.textureTranscoder=e.textureTranscoder,this.dataSource=e.dataSource,this.objectDefaults=e.objectDefaults,this.includeTypes=e.includeTypes,this.excludeTypes=e.excludeTypes,this.excludeUnclassifiedObjects=e.excludeUnclassifiedObjects,this.reuseGeometries=e.reuseGeometries}get supportedVersions(){return Object.keys(Dt)}get textureTranscoder(){return this._textureTranscoder}set textureTranscoder(e){this._textureTranscoder=e}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new Re}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||je}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}get reuseGeometries(){return this._reuseGeometries}set reuseGeometries(e){this._reuseGeometries=!1!==e}load(e={},t,i){if(!(e.src||e.xkt||e.manifestSrc||e.manifest))return this.error("load() param expected: src, xkt, manifestSrc or manifestData"),a;const s={},r=e.includeTypes||this._includeTypes,n=e.excludeTypes||this._excludeTypes,o=e.objectDefaults||this._objectDefaults;if(s.reuseGeometries=null!==e.reuseGeometries&&void 0!==e.reuseGeometries?e.reuseGeometries:!1!==this._reuseGeometries,r){s.includeTypesMap={};for(let e=0,t=r.length;e<t;e++)s.includeTypesMap[r[e]]=!0}if(n){s.excludeTypesMap={};for(let e=0,t=n.length;e<t;e++)s.excludeTypesMap[n[e]]=!0}o&&(s.objectDefaults=o),s.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==e.globalizeObjectIds&&null!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds;const a=new Be(d.apply(e,{isModel:!0,textureTranscoder:this._textureTranscoder,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:e.origin,disableVertexWelding:e.disableVertexWelding||!1,disableIndexRebucketing:e.disableIndexRebucketing||!1,dtxEnabled:e.dtxEnabled})),l=a.id,c=new ze({id:l}),h=()=>{a.finalize(),c.finalize(),a.once("destroyed",(()=>{c.destroy()})),this.scheduleTask((()=>{a.destroyed||(a.fire("loaded",!0,!1),"function"==typeof t&&t(a,c))}))},u=e=>{this.error(e),a.fire("error",e),"function"==typeof i&&i(e)};let m=0;const p={getNextId:()=>`${l}.${m++}`};if(e.metaModelSrc||e.metaModelData)if(e.metaModelSrc){const t=e.metaModelSrc;this._dataSource.getMetaModel(t,(t=>{a.destroyed||(c.loadData(t,{includeTypes:r,excludeTypes:n,globalizeObjectIds:s.globalizeObjectIds}),e.src?this._loadModel(e.src,e,s,a,null,p,h,u):(this._parseModel(e.xkt,e,s,a,null,p),h()))}),(e=>{u(`load(): Failed to load model metadata for model '${l} from  '${t}' - ${e}`)}))}else e.metaModelData&&(c.loadData(e.metaModelData,{includeTypes:r,excludeTypes:n,globalizeObjectIds:s.globalizeObjectIds}),e.src?this._loadModel(e.src,e,s,a,null,p,h,u):(this._parseModel(e.xkt,e,s,a,null,p),h()));else if(e.src)this._loadModel(e.src,e,s,a,c,p,h,u);else if(e.xkt)this._parseModel(e.xkt,e,s,a,c,p),h();else if(e.manifestSrc||e.manifest){const t=e.manifestSrc?function(e){const t=e.split("/");return t.pop(),t.join("/")+"/"}(e.manifestSrc):"",i=(e,i,o)=>{let a=0;const l=()=>{a>=e.length?i():this._dataSource.getMetaModel(`${t}${e[a]}`,(e=>{c.loadData(e,{includeTypes:r,excludeTypes:n,globalizeObjectIds:s.globalizeObjectIds}),a++,this.scheduleTask(l,100)}),o)};l()},o=(i,r,n)=>{let o=0;const l=()=>{o>=i.length?r():this._dataSource.getXKT(`${t}${i[o]}`,(t=>{this._parseModel(t,e,s,a,null,p),o++,this.scheduleTask(l,100)}),n)};l()},l=(i,r,n)=>{let o=0;const l=()=>{o>=i.length?r():this._dataSource.getXKT(`${t}${i[o]}`,(t=>{this._parseModel(t,e,s,a,c,p),o++,this.scheduleTask(l,100)}),n)};l()};if(e.manifest){const t=e.manifest,s=t.xktFiles;if(!s||0===s.length)return void u("load(): Failed to load model manifest - manifest not valid");const r=t.metaModelFiles;r?i(r,(()=>{o(s,h,u)}),u):l(s,h,u)}else this._dataSource.getManifest(e.manifestSrc,(e=>{if(a.destroyed)return;const t=e.xktFiles;if(!t||0===t.length)return void u("load(): Failed to load model manifest - manifest not valid");const s=e.metaModelFiles;s?i(s,(()=>{o(t,h,u)}),u):l(t,h,u)}),u)}return a}_loadModel(e,t,i,s,r,n,o,a){this._dataSource.getXKT(t.src,(e=>{this._parseModel(e,t,i,s,r,n),o()}),a)}_parseModel(e,t,i,s,r,n){if(s.destroyed)return;const o=new DataView(e),a=new Uint8Array(e),l=o.getUint32(0,!0),c=Dt[l];if(!c)return void this.error("Unsupported .XKT file version: "+l+" - this XKTLoaderPlugin supports versions "+Object.keys(Dt));this.log("Loading .xkt V"+l);const h=o.getUint32(4,!0),d=[];let u=4*(h+2);for(let e=0;e<h;e++){const t=o.getUint32(4*(e+2),!0);d.push(a.subarray(u,u+t)),u+=t}c.parse(this.viewer,i,d,s,r,n)}}}));
